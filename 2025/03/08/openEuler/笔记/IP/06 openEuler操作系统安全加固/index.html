<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>06 openEuler操作系统安全加固 | XBCID's BLOG</title><meta name="keywords" content="Linux,openEuler,Huawei,HCIP"><meta name="author" content="XBCID"><meta name="copyright" content="XBCID"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="06 openEuler操作系统安全加固"><meta name="application-name" content="06 openEuler操作系统安全加固"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="06 openEuler操作系统安全加固"><meta property="og:url" content="http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/index.html"><meta property="og:site_name" content="XBCID's BLOG"><meta property="og:description" content="操作系统是互联网不可或缺的基础设施之一，也是生产、处理和存储价值数据的实体。同时openEuler作为Linux发行版系统，具有开源、免费的特点，拥有丰富健康的生态环境和社区支持。正因如此，保障其安全的重要性不言而喻。本章节以操作系统安全为主线，主要讲述安全加固策略，网络安全以及SELinux访问控"><meta property="og:locale" content="zh"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="XBCID"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="操作系统是互联网不可或缺的基础设施之一，也是生产、处理和存储价值数据的实体。同时openEuler作为Linux发行版系统，具有开源、免费的特点，拥有丰富健康的生态环境和社区支持。正因如此，保障其安全的重要性不言而喻。本章节以操作系统安全为主线，主要讲述安全加固策略，网络安全以及SELinux访问控"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XBCID","link":"链接: ","source":"来源: XBCID's BLOG","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'XBCID's BLOG',
  title: '06 openEuler操作系统安全加固',
  postAI: '',
  pageFillDescription: '0x01 操作系统安全加固, 1.1 操作系统面临的主要威胁, 1.2 操作系统对于安全的要求, 1.3 安全加固概述, 1.4 内核参数简介, 1.5 内核参数配置工具 - systcl, 1.6 内核参数加固策略, 1.7 授权认证系统加固方案, 1.7.1 授权认证 - 网络远程登录的警告信息, 1.7.2 授权认证 - 通过Ctrl+Alt+Del重启系统, 1.7.3 授权认证  - 终端的自动退出时间, 1.7.4 授权认证 - 设置用户的默认umask值为077, 1.7.5 授权认证 - GRUB2加密口令, 1.7.6 其他授权认证加固方式, 1.8 单用户模式下重置root密码, 1.9 账户口令系统加固方案, 1.9.1 屏蔽系统账户和限制使用su命令的帐户, 1.9.2 账户口令复杂度, 1.9.2.1 帐户口令复杂度案例, 1.9.3 帐户口令有效期, 1.9.4 账户口令的加密算法, 1.9.5 登录失败超过三次后锁定, 1.10 文件的基本权限, 1.11 加固su命令, 1.12 文件权限系统加固方案, 1.12.1 设置文件的权限和属主, 1.12.2 删除无主文件, 1.12.3 处理空链接文件, 1.12.4 设置守护进程的umask值, 1.12.5 为全局可写目录添加粘滞位属性, 1.12.6 删除非授权文件的全局可写属性, 1.12.7 限制at命令的使用权限, 1.12.8 限制cron命令的使用权限, 1.12.9 限制sudo命令的使用权限, 1.13 加固SSH服务, 0x02 操作系统网络安全, 2.1 操作系统网络安全概述, 2.2 Netfilter介绍, 2.2.1 Netfilter生态工具, 2.2.2 Netfilter简介, 2.2.3 Netfilter原理, 2.2.4 数据包过滤流程, 2.3 Iptables详述, 2.3.1 Iptables的表、链和规则, 2.3.2 Iptables中的五表, 2.3.3 Iptables中的五链, 2.3.4 Iptables工作原理, 2.3.5 Iptables的表链关系, 2.3.6 Iptables中的连接追踪机制, 2.3.7 Iptables中的会话机制, 2.3.8 Iptables语法规则, 2.3.8.1 COMMAND, 2.3.8.2 MATCH, 2.3.8.3 Targetsx2FJumps, 2.3.9 Iptables规则集的保存与恢复, 2.3.10 Iptables配置案例 - 访问控制, 2.3.11 Iptables配置案例 - NAT地址转换, 2.4 Firewalld详述, 2.4.1 Firewalld架构简述, 2.4.2 Firewalld策略, 2.4.3 Firewalld区域概念, 2.4.4 Firewalld其他重要必知, 2.4.5 Firewalld配置方法 - firewall-cmd, 2.4.6 Firewalld配置方法 - xml修改, 2.4.7 Firewalld富规则配置, 0x03 SELinux强制访问控制, 3.1 SELinux简介, 3.2 SELinux模式的查看及转换, 3.3 SELinux的安全上下文, 3.3.1 SELinux的安全上下文查看, 3.3.2 SELinux中文件的安全上下文管理, 3.3.3 SELinux的布尔值, 3.4 SELinux日志服务操作系统是互联网不可或缺的基础设施之一也是生产处理和存储价值数据的实体同时作为发行版系统具有开源免费的特点拥有丰富健康的生态环境和社区支持正因如此保障其安全的重要性不言而喻本章节以操作系统安全为主线主要讲述安全加固策略网络安全以及访问控制学完本课程后您将能够掌握系统加固策略熟悉架构和原理掌握的语法规则掌握的语法规则熟悉强制访问控制策略操作系统安全加固操作系统面临的主要威胁地震雷雨失火等自然灾害和硬件故障都属于破坏物理安全的例子它们直接破坏了信息的可用性导致业务中断无法继续向合法授权用户提供服务社会工程是一种针对受害者本能反应好奇心信任贪婪等心理弱点进行欺骗和伤害等社会工程攻击在近年来的一些网络入侵事件中起到了很大的作用对企业信息安全有很大的威胁性内部人员威胁往往是误操作或者恶意利用职权而导致的信息泄露和破坏内部人员造成威胁的个人因素主要有出于贪婪或经济利益的需要因工作原因对公司和上级领导心怀不满个人生活不如意而导致工作行为异常黑客们往往会利用系统漏洞和进行攻击也可能会辅助以社会工程的方式进行攻击在入侵渗透完成后黑客们会在系统中植入木马或病毒来进行隐秘的长期控制非法泄露和恶意篡改操作系统上的信息实施拒绝服务攻击包括其高级形式分布式拒绝服务攻击让信息系统无法正常工作提供服务以达到其不可告人的目的操作系统对于安全的要求操作系统安全就是要确保操作系统自身是安全的它可由操作系统自身安全配置相关安全软件以及第三方安全设备实现信息安全技术操作系统安全技术要求规定安全加固概述安全加固本质上是根据过往总结出的安全风险经验通过对操作系统配置项进行优化的手段达到提前消除部分风险的措施通过对操作系统进行安全加固构建动态完整的安全体系增强产品的安全性提升产品的竞争力系统加固内容主要包含以下五个部分内核参数授权认证帐户口令文件权限系统服务安全加固本质上是根据过往总结出的安全风险经验通过对操作系统配置项进行优化的手段达到提前消除部分风险的措施内核参数简介内核参数决定配置和应用特权的状态内核提供用户可配置的系统控制这一系统控制可微调或配置该功能特性可通过控制各种可配置的内核参数来提高操作系统的安全特性内核参数可通过命令进行读取及临时修改这些参数位于目录下永久保留内核参数可通过修改文件实现内核参数配置工具使用命令可在系统运行时读或写内核参数命令语法命令选项查看所有内核参数临时修改指定内核参数从文件中加载内核参数默认从加载显示内核参数的值显示内核参数名称忽略未知参数错误内核参数加固策略常用网络加固策略避免放大攻击占用目标系统的可用带宽并导致合法通信的服务被拒绝在一个网卡收到数据包后把源地址和目标地址对调后查找反向路由出口再根据反向路由出口来过滤数据包当的值为时要求反向路由的出口必须与数据包的入口网卡是同一块否则就会丢弃数据包当的值为时要求反向路由必须是可达的如果反向路由不可达则会丢弃数据包减少攻击校验数据包的反向路径如果反向路径不合适则直接丢弃数据包避免过多的无效连接消耗系统资源数据包转发功能源路由信息指明了数据包的传输路径攻击者可以伪造一些合法的地址而蒙混进入网络重定向信息是路由器向主机提供实时的路由信息当一个主机收到重定向信息时它就会根据这个信息来更新自己的路由表由于缺乏必要的合法性检查如果一个黑客想要被攻击的主机修改它的路由表黑客就会发送重定向信息给被攻击的主机让该主机按照黑客的要求来修改路由表如果黑客要求该主机将网关修改为黑客自己的机器就使得该主机在发送数据包时都会被黑客获取进一步实现中间人攻击或者攻击节省大量的硬盘空间是一种通过占用系统资源迫使系统重启的攻击加固策略为开启保护该选项决定内核是否对线程进行自动分组调度开启后调度组之间互相竞争时间片调度组内的线程再竞争调度组分配到的时间片加固策略为不启用该项避免由于直接发送命令到内核对系统造成影响增强内核安全性授权认证系统加固方案通过授权认证进行系统加固常用的方式包括设置网络远程登录的警告信息禁止通过重启系统设置终端的自动退出时间设置用户的默认值为设置加密口令安全单用户模式禁止交互式启动授权认证网络远程登录的警告信息设置网络远程登录的警告信息用于在登录进入系统之前向用户提示警告信息明示非法侵入系统可能受到的惩罚吓阻潜在的攻击者同时也可以隐藏系统架构及其他系统信息避免招致对系统的目标性攻击可以通过修改文件的内容实现默认已设置授权认证通过重启系统操作系统默认能够通过进行重启建议禁止该项特性防止因为误操作而导致数据丢失具体操作如下删除两个文件参考命令如下修改文件将修改为重启使修改生效参考命令如下授权认证终端的自动退出时间无人看管的终端容易被侦听或被攻击可能会危及系统安全因此建议设置终端在停止运行一段时间后能够自动退出自动退出时间由文件的字段单位为秒控制在的尾部添加如下配置授权认证设置用户的默认值为值用于为用户新创建的文件和目录设置缺省权限如果的值设置过小会使群组用户或其他用户的权限过大给系统带来安全威胁因此设置所有用户默认的值为即用户创建的目录默认权限为文件的默认权限为具体实现方法如下分别在文件和目录下的所有文件中加入设置文件和目录下所有文件的属主为群组为授权认证加密口令即它是一个操作系统启动管理器用来引导不同系统如是的升级版系统启动时可以通过界面修改系统的启动参数为了确保系统的启动参数不被任意修改需要对界面进行加密仅在输入正确的口令时才能修改启动参数的默认口令为使用命令生成新的加密口令使用工具打开的开始位置追加如下字段默认设置的口令为建议用户首次登录时修改默认密码并定期更新避免密码泄露后启动选项被篡改导致系统启动异常不同模式下文件所在路径不同架构的模式下路径为模式下路径为架构下路径为字段用于设置的超级管理员的帐户名字段后的参数第个参数为的帐户名第个为该帐户的加密口令其他授权认证加固方式安全单用户模式单用户模式是以权限进入系统如不设置密码将存在较大安全隐患该设置可以通过修改文件内容实现将选项配置为禁止交互式启动使用交互式引导控制台用户可以禁用审计防火墙或其他服务削弱了系统安全性用户可以禁止使用交互式引导提升安全性该设置可以通过修改文件内容实现将选项配置为单用户模式下重置密码当管理员丢失密码无法进行操作系统时可在单用户模式下进行密码重置具体操作如下系统启动前按对启动条目进行编辑在指定内核所在的行末添加输入使系统继续启动进入命令行后执行以读写方式挂载具体命令为将设置为真正的具体命令为使用命令重置密码其中为新密码为文件重新添加标签具体命令为输入两次退出并重启系统的启动过程系统固件运行进行开机自检系统固件按照顺序选择可启动设备并开始搜索所有设备的主启动记录系统固件读取设备上的并将系统控制全交给它根据选择启动的内核并将内核及加载到内存中将系统权限转交给内核内核从中搜索硬件驱动并初始化硬件启动并将磁盘中的文件系统挂载到上内核将根文件系统从切换到中的根文件系统随后就使用磁盘中安装的来重新执行最终找到默认的启动目标完成本次启动账户口令系统加固方案通过账户口令进行系统加固常用的方式包括屏蔽系统帐户限制使用命令的帐户设置口令复杂度设置口令有效期设置口令的加密算法登录失败超过三次后锁定加固命令屏蔽系统账户和限制使用命令的帐户屏蔽系统帐户除了用户帐户外其他账号称为系统帐户系统帐户仅系统内部使用禁止用于登录系统或其他操作因此屏蔽系统帐户例如将系统帐户的修改为限制使用命令的帐户命令用于在不同帐户之间切换为了增强系统安全性有必要对命令的使用权进行控制只允许和群组的帐户使用命令限制其他帐户使用命令的使用控制通过修改文件实现配置如下帐户口令指系统帐户基于当前帐户的账户口令复杂度用户可以通过修改对应配置文件设置口令的复杂度要求建议用户根据实际情况设置口令复杂度口令复杂度通过和文件中的和模块实现用户可以通过修改这两个模块中的配置项修改口令复杂度要求用户可以通过修改对应配置文件设置口令的复杂度要求建议用户根据实际情况设置口令复杂度帐户口令复杂度案例需求为了保证操作系统安全管理要求用户在设置密码时需满足以下要求口令长度至少个字符口令必须包含如下至少种字符的组合至少一个小写字母至少一个大写字母至少一个数字至少一个特殊字符和空格口令不能和帐号或者帐号的倒写一样不能修改为过去次使用过的旧口令帐户口令有效期出于系统安全性考虑建议设置口令有效期限且口令到期前通知用户更改口令口令有效期的设置通过修改文件实现是设置用户帐号限制的文件可配置口令的最大过期天数最大长度约束等该文件里的配置对用户无效如果文件里有相同的选项则以配置为准口令过期后用户重新登录时提示口令过期并强制要求修改不修改则无法进入系统出于系统安全性考虑建议设置口令有效期限且口令到期前通知用户更改口令是设置用户帐号限制的文件可配置口令的最大过期天数最大长度约束等该文件里的配置对用户无效如果文件里有相同的选项则以配置为准即的配置优先级高于口令过期后用户重新登录时提示口令过期并强制要求修改不修改则无法进入系统账户口令的加密算法出于系统安全考虑口令不允许明文存储在系统中应该加密保护在不需要还原口令的场景必须使用不可逆算法加密设置口令的加密算法为默认已设置通过上述设置可以有效防范口令泄露保证口令安全口令的加密算法设置通过修改和实现添加如下配置其中表示使用算法对口令进行加密出于系统安全考虑口令不允许明文存储在系统中应该加密保护在不需要还原口令的场景必须使用不可逆算法加密用户锁定期间任何输入被判定为无效锁定时间不因用户的再次输入而重新计时解锁后用户的错误输入记录被清空通过上述设置可以有效防范口令被暴力破解增强系统的安全性登录失败超过三次后锁定为了保障用户系统的安全建议用户设置口令出错次数的阈值建议次以及由于口令尝试被锁定用户的自动解锁时间建议秒用户锁定期间任何输入被判定为无效锁定时间不因用户的再次输入而重新计时解锁后用户的错误输入记录被清空通过上述设置可以有效防范口令被暴力破解增强系统的安全性具体配置实现方式如下文件的基本权限将所有对象都当作文件来处理即使一个目录也被看作是包含有多个其他文件的大文件因此中最重要的就是文件和目录的安全性文件和目录的安全性主要通过权限和属主来保证默认对系统中的常用目录可执行文件和配置文件设置了权限和属主用户可以通过和来修改文件的权限属主和属组修改文件权限例如将目录权限设置为修改文件属主例如将目录的拥有者和群组设置为加固命令为了增强系统安全性防止使用切换用户时将当前用户环境变量带入其他环境默认已做配置总是在使用切换用户时初始化通过修改实现配置如下文件权限系统加固方案通过设置文件权限进行系统加固常用的方式包括设置文件的权限和属主删除无主文件处理空链接文件设置守护进程的值为全局可写目录添加粘滞位属性删除非授权文件的全局可写属性限制命令的使用权限限制命令的使用权限限制命令的使用权限设置文件的权限和属主将所有对象都当作文件来处理即使一个目录也被看作是包含有多个其他文件的大文件因此中最重要的就是文件和目录的安全性文件和目录的安全性主要通过权限和属主来保证默认对系统中的常用目录可执行文件和配置文件设置了权限和属主需求将目录权限设置为并将其所属组和所属用户设置为删除无主文件系统管理员在删除用户群组时存在着忘记删除该用户该群组所拥有文件的问题如果后续新创建的用户群组与被删除的用户群组同名则新用户新群组会拥有部分不属于其权限的文件建议将此类文件删除查找并删除用户不存在的文件删除用户不存在的文件删除群组不存在的文件为搜索目录的名称通常需要关注系统关键目录等系统安装完成后可能存在空链接文件这些空链接文件可能有对应用途有些空链接文件是预制的会被其他组件依赖请用户根据实际环境进行处理如果命令遇到符号链接文件就跟踪至链接所指向的文件处理空链接文件无指向的空链接文件可能会被恶意用户利用影响系统安全性建议用户删除无效的空链接文件提高系统安全性删除用户不存在的文件系统安装完成后可能存在空链接文件这些空链接文件可能有对应用途有些空链接文件是预制的会被其他组件依赖请用户根据实际环境进行处理处理方式如下使用以下命令查找系统中的空链接文件如果此类文件无实际作用可通过以下命令删除设置守护进程的值值用来为新创建的文件和目录设置缺省权限如果没有设定值则生成的文件具有全局可写权限存在一定的风险守护进程负责系统上某个服务让系统可以接受来自用户或者是网络客户的要求为了提高守护进程所创建文件和目录的安全性建议设置其值为默认已设置守护进程的值为设置文件值可通过在文件中新增一行来实现为全局可写目录添加粘滞位属性任意用户可以删除修改全局可写目录中的文件和目录为了确保全局可写目录中的文件和目录不会被任意删除需要为全局可写目录添加粘滞位属性具体实现如下搜索全局可写目录为全局可写目录添加粘滞位属性为实际查找到的目录名删除非授权文件的全局可写属性全局可写文件可被系统中的任意用户修改影响系统完整性具体实现方式如下列举系统中所有的全局可写文件查看上步中列举的所有文件粘滞位位的文件和目录可以排除在外删除文件或去掉其全局可写权限使用以下命令去掉权限其中为对应文件名可通过如下命令确定对应文件或目录是否设置了粘滞位若回显中包含标记则为粘滞位文件或目录命令中的为需要查询文件或目录的名称粘滞位目前只对目录有效拥有粘滞位的目录除用户可以删除所有的文件普通用户只能删除自己创建的文件而不能删除其他用户的创建的文件首位表示特殊权限按照文件权限来查找文件限制命令的使用权限命令用于创建在指定时间自动执行的任务为避免任意用户通过命令安排工作造成系统易受攻击需要指定可使用该命令的用户具体实现如下删除文件的文件属主改为控制的文件权限仅可操作限制命令的使用权限命令用于创建例行性任务为避免任意用户通过命令安排工作造成系统易受攻击需要指定可使用该命令的用户具体实现如下所示删除文件的文件属主改为控制的文件权限仅可操作限制命令的使用权限命令用于普通用户以权限执行命令为了增强系统安全性有必要对命令的使用权进行控制只允许使用命令限制其他帐户使用默认未限制非用户使用命令的权限具体实现如下所示命令的使用控制通过修改文件实现需要注释掉如下配置行加固服务是专为远程登录会话和其他网络服务提供安全性保障的协议利用协议可以有效防止远程管理过程中的信息泄露问题透过可以对所有传输的数据进行加密并防止欺骗和欺骗是协议的免费开源实现加固服务是指修改服务中的配置来设置系统使用协议时的算法认证等参数从而提高系统的安全性服务加固可通过修改文件内容实常用加固策略服务器发出请求后客户端没有响应的次数达到一定值连接自动断开表示无限制默认值是秒算法加固策略其他安全建议出于安全考虑建议用户在使用服务时仅在必需的上进行绑定侦听而不是侦听操作系统网络安全操作系统网络安全概述网络安全加固是基于内核态的数据包过滤框架依据用户预先设定的规则在网络层对数据包进行匹配并作出相应的动作从而达到对网络流量的控制常用的用户命令行工具有和基于区域的概念依据用户自定义的安全策略动态地管理网络连接和接口可为服务或应用程序制定丰富的防火墙规则介绍生态工具每个进入网络系统的包在经过协议栈时都会触发这些程序可以通过注册函数的方式在一些关键路径上处理网络流量面向系统管理员用于管理数据包过滤规则集的用户命令行工具基于特定的网络虚拟设备和全新的内核数据包分类框架的用户命令行工具重用了现有的子系统拥有更多灵活可扩展和高性能的数据包分类旨在取代目前的利用防火墙的区域概念动态地管理网络连接或接口的安全策略可为服务或应用程序直接添加防火墙规则即时生效曾使用命令来直接配置目前使用的来管理防火墙规则简介是内核中的一个数据包过滤软件它具备以下特性无状态数据包过滤有状态数据包过滤网络地址和端口转换灵活和易扩展的架构提供可支持第三方扩展的多层接口参考信息原理是通过内核中内置的个来实现对网络层数据包的控制是内核中的一个框架它允许内核模块在网络栈的不同位置注册回调函数这些函数会对穿过网络栈各个钩子的数据包进行过滤在数据包进入网络栈后路由决策前触发此在路由判断包是发送到本机时触发此在路由判断包需要转发给其他主机时触发此在本机进程产生包时被送到网络栈前触发此在数据包经过路由判断后即将发送到网络前触发此数据包过滤流程以本地为目标的包从本地发出的包从本机转发的包详述是使用很广泛的防火墙之一它基于内核的包过滤框架面向系统管理员用于管理数据包过滤规则集的用户命令行工具实验手册的表链和规则使用表来分类规则每张表的内部规则又被链串联起来这边表非常清晰的向我们展示了表链和规则之间的逻辑关系纵向看每张表都包含了具体的链而每条链又包含了具体的规则表赋予了链的功能而链给出了实现这些功能的具体操作也就是我们所说规则横向看同一条链出现在不同的表里前面我们也介绍了每条链的主要功能这里我们也能猜测每条链的附属功能总结来说链就是将多个规则串起来的一个集合单位表具有相同功能的规则的集合表与表串联起来就对应了不同数据包的处理流程中的五表表具有相同功能规则的集合表与表的串联对应了不同数据包的处理流程表中使用最广泛的表作用是进行过滤即由表来决定一个数据包是否继续发往它的目的地址或被拒绝丢弃表用于网络地址转换依据规则改变数据包的源地址或者目的地址即将本地网络映射到公网用于对外提供服务和用于局域网共享一个公网也就是充当网关设备会使用表用于改变数据包的头部信息如表为提供了一种不经过连接追踪的机制在大流量对外业务的服务器上使用这个表可以避免连接追踪带来的性能问题表提供在数据包中加入特性的功能根据介绍表的顺序也可以看出表的实际使用频率也是从上至下的中的五链链将多个规则串联起来的一个集合每个经过这个关卡的报文都要将这条链上的所有规则匹配一遍如果有符合条件的报文则执行规则对应的动作如果没有则执行默认的动作中的链是由中的钩子实现的当数据包经过网络栈的时候这些钩子上注册的内核模块依次被触发由钩子触发由钩子触发由触发由触发由触发中的五链就像五个关卡每个经过这个关卡的包都会将这条链上的规则匹配一遍如果有符合条件的数据包则执行规则对应的动作如果没有则执行默认的动作这五条链就像长途高速公路的五个收费站依次处理过往的车流量符合规定的车辆放行不符合规定的车辆则扣留这里文档对五表五链的具体规则并未做出详细介绍可以参考链位置数据包刚进入防火墙还未进行路由判断时就会进入该链功能主要用于目的地址转换和修改数据包的目的地址常见应用场景是端口转发即把外部对特定和端口的访问转发到内部网络的其他主机和端口上此外表和表也会在这个阶段对数据包进行相应处理比如修改数据包的首部信息或者决定是否进行状态跟踪链位置当数据包经过路由判断确定是要进入本地主机时就会进入该链功能对进入本地主机的数据包进行过滤决定是否允许这些数据包进入本地主机这是保障本地主机安全的重要防线可以根据源地址端口协议等条件来制定过滤规则阻止恶意攻击和非法访问链位置当数据包经过路由判断确定该数据包不是要进入本地主机而是要经过本地主机转发到其他主机时会进入此链功能对经过本地主机转发的数据包进行过滤只有通过链规则检查的数据包才会被转发出去这个链常用于路由器或者网关设备确保转发的数据包符合安全策略链位置当本地主机产生要发送出去的数据包时数据包会先进入该链功能对本地主机发出的数据包进行过滤和处理决定是否允许这些数据包从本地主机发出可以根据目的地址端口协议等条件来制定规则防止本地主机向外发送非法或者不安全的数据包链位置数据包即将离开防火墙之前会进入该链功能主要用于源地址转换和修改数据包的源地址常见的应用场景是让内部网络的主机共享一个公共地址访问外部网络即把内部主机的私有地址转换为公共地址工作原理表赋予了链的功能而链给出了实现这些功能的具体操作也就是我们所说规则的表链关系表格展示了表和链的关系横向是链纵向是表表示表里有链所有状态的改变和计算都是在表中的链和链里完成的除了本地产生的包由链处理外所有连接追踪都是在链里进行处理的被细分成了修改目的地址和修改源地址以更方便地展示他们的优先级内核在注册处理函数时提供了优先级以便触发时能按照优先级高低调用处理函数同时使得多个模块可以在同一点注册并且有确定的处理顺序中的连接追踪机制防火墙是有状态的对每个包进行判断的时候是依赖已经判断过的包建立在之上的连接跟踪特性使得将包看作会话的一部分而不是一个由独立不相关的包组成的流数据包到达网络接口之后很快就会有连接跟踪逻辑判断现在我们介绍的连接追踪机制防火墙是有状态的对每个包进行判断的时候是依赖已经判断过的包建立在之上的连接跟踪特性使得将包看作已有的连接或会话的一部分而不是一个由独立不相关的包组成的流数据包到达网络接口之后很快就会被打上相应的状态标记概要来说连接追踪系统在一个内存数据结构中记录了连接的状态这些信息包括源目的双方端口号对和协议类型状态和超时信息等有了这些信息我们可以设置更灵活的过滤策略中的会话机制会将属于同一连接的所有报文作为一个整体的数据流会话来对待会话表是用来记录等协议连接状态的表项是转发报文的重要依据防火墙采用了基于状态的报文控制机制只对首包或者少量报文进行检测就确定一条连接的状态大量报文直接根据所属连接的状态进行控制这种状态检测机制迅速提高了防火墙的检测和转发效率会话表就是为了记录连接的状态而存在的设备在转发和报文时都需要查询会话表来判断该报文所属的连接并采取相应的处理措施语法规则规则就是指向标在一条链上对不同的连接和数据包阻塞或允许它们去向何处插入链的每一行都是一条规则在内核看来规则就是决定如何处理一个包的语句如果一个包符合所有的条件就是符合语句我们就运行或命令语法格式指定操作的表默认情况下是表指定表中对应的链去处理规则指定对我们提交的规则要做什么样的操作匹配规则决定符合条件的包到何处去以下是可用的默认是对表操作可借助给出简短的语法说明默认策略只有两种和删除用户自定义链时链规则必须清空后才允许删除链内有两个计数器记录了匹配到了多少个包以及多少个字节描述包的详细特点以匹配规则来执行的动作可分为通用匹配和扩展匹配通用匹配适用所有规则没有前提条件可直接使用扩展匹配分为显示匹配和隐含匹配显式匹配必须用或装载目前可用的模块有和下面列举部分常用的选项隐含匹配操作是自动地或隐含地装载入内核的现在有三种隐含的匹配针对三种不同的协议即和它们分别包括一套只适用于相应协议的判别标准显式匹配必须用或装载目前可用的模块有和下面列举部分常用的选项和对应或连接状态跟踪支持的常见状态新发起的连接已建立的连接与已有连接相关的连接如数据传输决定符合条件的包到何处去语法是或将符合条件的包放行丢弃将符合条件的包拒绝并向发送者返回错误信息目的网络地址转换当包被匹配时会被路由到正确的主机和网络源网络地址转换把所有从本地网络出去的包的源地址改为连接的地址源网络地址转换但不需要指定源地址自动获取网络接口的地址转发主机内部的包到另一个端口且本地生成的包都会被映射到记录有关包的信息这个功能是通过内核的日志工具完成的一般是使包返回上一层顺序是子链父链缺省策略规则集的保存与恢复提供了两个很有用的工具用来处理大规则集它们把规则存入一个特殊格式的文件中或从中恢复规则把当前规则存入文件保存包和字节计数器的值重启防火墙而不中断统计记数程序默认不使用指定要保存的表默认是保存所有的表装载由保存的规则集装载包和字节计数器不覆盖已有的表或表内的规则默认情况是清除所有已存的规则使用和的一个最重要的原因是它们能在相当程度上提高装载保存规则的速度如果你的工作对象是一组巨大的规则这两个工具是明显的选择配置案例访问控制允许所有来源的访问本机端口允许本机其他主机拒绝来源的访问端口保存的规则配置案例地址转换源地址转换通过上外网在互联网上看到的源地址是的外网上执行以下命令目的地址转换外部用户需要直接访问无外网提供的服务上执行以下命令详述架构简述一共分为核心层和顶部的层核心层负责处理各种配置文件和后端组件如和等接口是更改和创建防火墙配置的主要方法该界面由所有提供的工具使用如和不与通信而是直接使用核心和处理程序更改和创建配置文件防火墙脱机可以在运行时使用但不建议这样做因为它只能在大约五秒钟后更改防火墙中可见的永久配置策略的基本作用是对进出网络的访问行为进行控制保护特定网络免受不信任网络的攻击但同时还必须允许两个网络之间可以进行合法的通信一般通过安全策略实现以上功能最基本的设计原则一般是没有明确允许的流量默认都会被禁止这样能够确保一旦接入网络就能保护网络的安全安全策略匹配过程如下是通过策略来对进出网络的访问行为进行控制默认拒绝所有流量流量的返回路径默认是允许的由于防火墙的连接追踪机制区域概念区域定义连接接口或源地址的信任级别这是一对多关系这意味着连接接口或源地址只能是一个区域的一部分但一个区域可用于多个连接接口或源地址预定义的区域其他重要必知支持四种配置方法控制界面图形界面命令行修改文件的配置文件如下系统默认防火墙配置文件不建议修改自定义的配置文件如果该目录下没有对应的配置文件防火墙就会使用默认的配置分为运行态和永久态运行态修改规则后立刻生效但不会保存到永久配置中在重启后生效建议用于规则测试永久态配置完成后需重新加载方生效永久配置存储在配置文件中配置方法语法配置方法修改规则对应的文件存放在中该目录默认为空永久配置了的规则会自动生成对应的文件对其他区域进行操作后会自动生成对应的文件修改后需要对服务执行配置才会生效富规则配置的富规则可以进行更复杂更精细的规则案例一允许主机的所有流量案例二允许主机对本主机进行案例三允许对本主机进行案例四将来自访问本主机端口的流量转发至的端口案例五为进行转发强制访问控制简介自主访问控制基于用户组和其他权限决定一个资源是否能被访问的因素是某个资源是否拥有对应用户的权限它不能使系统管理员创建全面和细粒度的安全策略是内核的一个模块也是的一个安全子系统的实现了强制访问控制每个进程和系统资源都有一个特殊的安全标签资源能否被访问除了规定的原则外还需要判断每一类进程是否拥有对某一类资源的访问权限默认使用提升系统安全性分为三种模式仅打印告警而不强制执行安全策略被强制执行不加载安全策略模式的查看及转换查看当前的模式使用命令临时修改模式命令为表示切换为表示切换为永久修改模式需修改配置文件并需在修改后重启才能生效的安全上下文在视角下所有文件端口及进程都是具备安全标签这类标签被称为安全上下文安全上下文有五个元素组成分别是表示登录系统的用户类型用于定义文件端口及进程的用途用于定义数据类型用于定义安全级别用于区分特定组织当策略为时仅需关注即可的安全上下文查看的安全上下文可分为实际上下文和默认上下文实际上下文不存放在文件系统中默认上下文存放在二进制的策略库中实际上下文使用选项查看查看进程的实际安全上下文查看文件的实际安全上下文查看端口的实际安全上下文查看默认上下文使用命令命令中文件的安全上下文管理命令用于修改文件的实际安全上下文命令语法为为具体的上下文为指定的文件为指定的目录命令用于修改文件的默认安全上下文命令语法为常用选项有添加安全上下文删除安全上下文指定文件的上下文类型列出文件的安全上下文命令用于还原默认命令语法为常用的选项有查看详细信息递归修改目录可通过标记网络端口来控制网络流量当进程希望监听某个端口时将检查是否允许该进程相关的标签绑定该端口标签如果在非标准端口上运行某个服务会对服务进行拦截需修改该端口的安全上下文使其和服务的进程进行匹配修改端口的安全上下文命令为命令语法为常用选项有添加安全上下文删除安全上下文指定文件的上下文类型列出文件的安全上下文的布尔值布尔值用于更改策略行为它可以启用或禁用规则来有效的调整策略将布尔值设置为表示开启对应的规则设置为则表示禁用对应的规则使用以下命令进行布尔值的相关操作用于查看所有的布尔值用于查看当前所有生效的布尔值用于设置布尔值的启用或禁用其中表示对应的规则日志服务默认使用服务来记录拒绝的信息日志路径文件类型不正确是拒绝访问的常见原因例如以下关于服务器的拒绝消息示例代码是参考书给的代码截图是之前访问被拒绝百思不得其解查了的日志没查到的在中查到了拒绝的权限源进程正在尝试读取目标文件的状态信息进程的名称和进程试图访问的对象拒绝操作的进程上下文进程访问对象的上下文当前模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-19 03:44:19',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">XBCID's BLOG</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/HCIA/" style="font-size: 1.05rem;">HCIA<sup>9</sup></a><a href="/tags/HCIP/" style="font-size: 1.05rem;">HCIP<sup>6</sup></a><a href="/tags/Huawei/" style="font-size: 1.05rem;">Huawei<sup>15</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>18</sup></a><a href="/tags/openEuler/" style="font-size: 1.05rem;">openEuler<sup>18</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">May 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">23</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">March 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">February 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/openEuler/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>openEuler</span></a><a class="article-meta__tags" href="/tags/Huawei/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Huawei</span></a><a class="article-meta__tags" href="/tags/HCIP/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>HCIP</span></a></span></div></div><h1 class="post-title" itemprop="name headline">06 openEuler操作系统安全加固</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-08T09:24:00.000Z" title="发表于 2025-03-08 17:24:00">2025-03-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-05-18T19:44:19.114Z" title="更新于 2025-05-19 03:44:19">2025-05-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/"><header><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/openEuler/" tabindex="-1" itemprop="url">openEuler</a><a href="/tags/Huawei/" tabindex="-1" itemprop="url">Huawei</a><a href="/tags/HCIP/" tabindex="-1" itemprop="url">HCIP</a><h1 id="CrawlerTitle" itemprop="name headline">06 openEuler操作系统安全加固</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XBCID</span><time itemprop="dateCreated datePublished" datetime="2025-03-08T09:24:00.000Z" title="发表于 2025-03-08 17:24:00">2025-03-08</time><time itemprop="dateCreated datePublished" datetime="2025-05-18T19:44:19.114Z" title="更新于 2025-05-19 03:44:19">2025-05-19</time></header><p>操作系统是互联网不可或缺的基础设施之一，也是生产、处理和存储价值数据的实体。同时openEuler作为Linux发行版系统，具有开源、免费的特点，拥有丰富健康的生态环境和社区支持。正因如此，保障其安全的重要性不言而喻。本章节以操作系统安全为主线，主要讲述安全加固策略，网络安全以及SELinux访问控制。</p>
<p>学完本课程后，您将能够:</p>
<ul>
<li>掌握openEuler系统加固策略</li>
<li>熟悉netfilter架构和原理</li>
<li>掌握iptables的语法规则</li>
<li>掌握firewalld的语法规则</li>
<li>熟悉SELinux强制访问控制策略</li>
</ul>
<h2 id="0x01-操作系统安全加固"><a href="#0x01-操作系统安全加固" class="headerlink" title="0x01 操作系统安全加固"></a>0x01 操作系统安全加固</h2><h3 id="1-1-操作系统面临的主要威胁"><a href="#1-1-操作系统面临的主要威胁" class="headerlink" title="1.1 操作系统面临的主要威胁"></a>1.1 操作系统面临的主要威胁</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308172554459.png"></p>
<ul>
<li>地震、雷雨、失火等自然灾害和硬件故障都属于破坏物理安全的例子，它们直接破坏了信息的可用性，导致业务中断，无法继续向合法授权用户提供服务。社会工程是一种针对受害者本能反应、好奇心、信任、贪婪等心理弱点进行欺骗和伤害等。社会工程攻击在近年来的一些网络入侵事件中起到了很大的作用，对企业信息安全有很大的威胁性。</li>
<li>内部人员威胁往往是误操作或者恶意利用职权而导致的信息泄露和破坏。内部人员造成威胁的个人因素主要有：<ul>
<li>出于贪婪或经济利益的需要。</li>
<li>因工作原因对公司和上级领导心怀不满。</li>
<li>个人生活不如意而导致工作行为异常。</li>
</ul>
</li>
<li>黑客们往往会利用系统漏洞和Bug进行攻击，也可能会辅助以社会工程的方式进行攻击。在入侵渗透完成后，黑客们会在系统中植入木马或病毒，来进行隐秘的长期控制，非法泄露和恶意篡改操作系统上的信息。</li>
<li>实施拒绝服务（Denial of Service）攻击，包括其高级形式——分布式拒绝服务（Distributed Denial of Service，DDoS）攻击，让信息系统无法正常工作提供服务，以达到其不可告人的目的。</li>
</ul>
<h3 id="1-2-操作系统对于安全的要求"><a href="#1-2-操作系统对于安全的要求" class="headerlink" title="1.2 操作系统对于安全的要求"></a>1.2 操作系统对于安全的要求</h3><ul>
<li>操作系统安全就是要确保操作系统自身是安全的，它可由操作系统自身安全配置、相关安全软件以及第三方安全设备实现</li>
<li>GB&#x2F;T 20272-2019 《信息安全技术-操作系统安全技术要求》规定：</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308172726224.png"></li>
<li><a target="_blank" rel="noopener" href="http://c.gb688.cn/bzgk/gb/showGb?type=online&hcno=C372DE6A16690EDB2A8F1A014DA221D6">http://c.gb688.cn/bzgk/gb/showGb?type=online&amp;hcno=C372DE6A16690EDB2A8F1A014DA221D6</a></li>
</ul>
<h3 id="1-3-安全加固概述"><a href="#1-3-安全加固概述" class="headerlink" title="1.3 安全加固概述"></a>1.3 安全加固概述</h3><ul>
<li><p>安全加固本质上是根据过往总结出的安全风险经验，通过对操作系统配置项进行优化的手段，达到提前消除部分风险的措施。通过对操作系统进行安全加固，构建动态、完整的安全体系，增强产品的安全性，提升产品的竞争力</p>
</li>
<li><p>openEuler系统加固内容主要包含以下五个部分：<br>  ➢ 内核参数<br>  ➢ 授权认证<br>  ➢ 帐户口令<br>  ➢ 文件权限<br>  ➢ 系统服务</p>
</li>
<li><p>安全加固本质上是根据过往总结出的安全风险经验，通过<strong>对操作系统配置项进行优化</strong>的手段，达到<strong>提前消除部分风险</strong>的措施。</p>
</li>
</ul>
<h3 id="1-4-内核参数简介"><a href="#1-4-内核参数简介" class="headerlink" title="1.4 内核参数简介"></a>1.4 内核参数简介</h3><ul>
<li>内核参数决定<strong>配置和应用特权</strong>的状态。内核提供用户可配置的系统控制，这一系统控制可微调或配置，该功能特性可通过控制各种可配置的内核参数，来提高操作系统的安全特性。</li>
<li>内核参数可通过sysctl命令进行读取及临时修改，这些参数位于<code>/proc/sys</code>目录下</li>
<li>永久保留内核参数可通过修改<code>/etc/sysctl.conf</code>文件实现</li>
</ul>
<h3 id="1-5-内核参数配置工具-systcl"><a href="#1-5-内核参数配置工具-systcl" class="headerlink" title="1.5 内核参数配置工具 - systcl"></a>1.5 内核参数配置工具 - systcl</h3><ul>
<li>使用sysctl命令<strong>可在系统运行时读或写内核参数</strong></li>
<li>命令语法：<ul>
<li><code>sysctl [options] [variable[=value]] [...]</code></li>
</ul>
</li>
<li>命令选项<ul>
<li><code>-a, --all</code>：查看所有内核参数</li>
<li><code>-w, --write</code>：临时修改指定内核参数</li>
<li><code>-p [FILE]</code>：从文件中加载内核参数，默认从&#x2F;etc&#x2F;sysctl.conf加载</li>
<li><code>-n, --values</code>：显示内核参数的值</li>
<li><code>-N, --names</code>：显示内核参数名称</li>
<li><code>-e, --ignore</code>：忽略未知参数错误<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308175135098.png"></li>
</ul>
</li>
</ul>
<h3 id="1-6-内核参数加固策略"><a href="#1-6-内核参数加固策略" class="headerlink" title="1.6 内核参数加固策略"></a>1.6 内核参数加固策略</h3><p>常用网络加固策略<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308175248758.png"></p>
<ul>
<li><code>icmp_echo_ignore_broadcasts</code>：避免ICMP放大攻击，占用目标系统的可用带宽并导致合法通信的服务被拒绝。</li>
<li><code>rp_filter</code>：在一个网卡收到数据包后，把源地址和目标地址对调后查找反向路由出口，再根据反向路由出口来过滤数据包。当rp_filter的值为1时，要求反向路由的出口必须与数据包的入口网卡是同一块，否则就会丢弃数据包。当rp_filter的值为2时，要求反向路由必须是可达的，如果反向路由不可达，则会丢弃数据包。减少DDoS：攻击校验数据包的反向路径，如果反向路径不合适，则直接丢弃数据包，避免过多的无效连接消耗系统资源。</li>
<li>ip_forward：数据包转发功能</li>
<li>accept_source_route：源路由信息指明了数据包的传输路径。攻击者可以伪造一些合法的IP地址，而蒙混进入网络。</li>
<li>accept_redirects：<strong>ICMP重定向信息</strong>是路由器向主机提供实时的路由信息，当一个主机收到ICMP重定向信息时，它就会根据这个信息来更新自己的路由表。由于缺乏必要的合法性检查，如果一个黑客想要被攻击的主机修改它的路由表，黑客就会发送ICMP重定向信息给被攻击的主机，让该主机按照黑客的要求来修改路由表，如果黑客要求该主机将网关修改为黑客自己的机器，就使得该主机在发送数据包时，都会被黑客获取，进一步实现中间人攻击或者DOS攻击。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308175632218.png"></p>
<ul>
<li>net.ipv4.icmp_ignore_bogus_error_responses：节省大量的硬盘空间。</li>
<li>net.ipv4.tcp_syncookies：SYN Attack是一种通过占用系统资源迫使系统重启的DoS攻击。加固策略为开启TCP-SYN cookie保护。</li>
<li>kernel.sched_autogroup_enabled：该选项决定内核是否对线程进行自动分组调度。开启后调度组之间互相竞争时间片，调度组内的线程再竞争调度组分配到的时间片。加固策略为不启用该项。</li>
<li>kernel.sysrq：避免由于直接发送命令到内核对系统造成影响，增强内核安全性。</li>
</ul>
<h3 id="1-7-授权认证系统加固方案"><a href="#1-7-授权认证系统加固方案" class="headerlink" title="1.7 授权认证系统加固方案"></a>1.7 授权认证系统加固方案</h3><p>通过授权认证进行系统加固常用的方式包括：</p>
<ul>
<li>设置网络远程登录的警告信息</li>
<li>禁止通过”Ctrl+Alt+Del”重启系统</li>
<li>设置终端的自动退出时间</li>
<li>设置用户的默认umask值为077</li>
<li>设置GRUB2加密口令</li>
<li>安全单用户模式</li>
<li>禁止交互式启动</li>
</ul>
<h4 id="1-7-1-授权认证-网络远程登录的警告信息"><a href="#1-7-1-授权认证-网络远程登录的警告信息" class="headerlink" title="1.7.1 授权认证 - 网络远程登录的警告信息"></a>1.7.1 授权认证 - 网络远程登录的警告信息</h4><ul>
<li>设置网络远程登录的警告信息，用于在登录进入系统之前向用户提示警告信息，明示非法侵入系统可能受到的惩罚，吓阻潜在的攻击者。同时也可以隐藏系统架构及其他系统信息，避免招致对系统的目标性攻击</li>
<li>可以通过修改&#x2F;etc&#x2F;issue.net文件的内容实现（openEuler默认已设置）</li>
<li>Authorized users only. All activities may be monitored and reported.</li>
</ul>
<h4 id="1-7-2-授权认证-通过”Ctrl-Alt-Del”重启系统"><a href="#1-7-2-授权认证-通过”Ctrl-Alt-Del”重启系统" class="headerlink" title="1.7.2 授权认证 - 通过”Ctrl+Alt+Del”重启系统"></a>1.7.2 授权认证 - 通过”Ctrl+Alt+Del”重启系统</h4><p>操作系统默认能够通过“Ctrl+Alt+Del”进行重启，建议禁止该项特性，防止因为误操作而导致数据丢失<br>具体操作如下：<br>删除两个ctrl-alt-del.target文件，参考命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/systemd/system/ctrl-alt-del.target</span><br><span class="line">rm -f /usr/lib/systemd/system/ctrl-alt-del.target</span><br></pre></td></tr></table></figure>
<p>修改&#x2F;etc&#x2F;systemd&#x2F;system.conf文件，将<code>#CtrlAltDelBurstAction=reboot-force</code>修改为<br><code>CtrlAltDelBurstAction=none</code><br>重启systemd，使修改生效，参考命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reexec</span><br></pre></td></tr></table></figure>

<h4 id="1-7-3-授权认证-终端的自动退出时间"><a href="#1-7-3-授权认证-终端的自动退出时间" class="headerlink" title="1.7.3 授权认证  - 终端的自动退出时间"></a>1.7.3 授权认证  - 终端的自动退出时间</h4><ul>
<li>无人看管的终端容易被侦听或被攻击，可能会危及系统安全。因此建议设置终端在停止运行一段时间后能够自动退出</li>
<li>自动退出时间由&#x2F;etc&#x2F;profile文件的TMOUT字段（单位为秒）控制，在&#x2F;etc&#x2F;profile的尾部添加如下配置：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export TMOUT=300</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-7-4-授权认证-设置用户的默认umask值为077"><a href="#1-7-4-授权认证-设置用户的默认umask值为077" class="headerlink" title="1.7.4 授权认证 - 设置用户的默认umask值为077"></a>1.7.4 授权认证 - 设置用户的默认umask值为077</h4><ul>
<li>umask值用于为用户新创建的文件和目录设置缺省权限。如果umask的值设置过小，会使群组用户或其他用户的权限过大，给系统带来安全威胁。因此设置所有用户默认的umask值为0077，即用户创建的目录默认权限为700，文件的默认权限为600</li>
<li>具体实现方法如下：<ul>
<li>分别在&#x2F;etc&#x2F;bashrc文件和&#x2F;etc&#x2F;profile.d&#x2F;目录下的所有文件中加入“umask 0077”</li>
<li><code>echo &quot;umask 0077&quot; &gt;&gt; $FILE</code></li>
</ul>
</li>
<li>设置&#x2F;etc&#x2F;bashrc文件和&#x2F;etc&#x2F;profile.d&#x2F;目录下所有文件的属主为root，群组为root<ul>
<li><code>chown root.root $FILE</code></li>
</ul>
</li>
</ul>
<h4 id="1-7-5-授权认证-GRUB2加密口令"><a href="#1-7-5-授权认证-GRUB2加密口令" class="headerlink" title="1.7.5 授权认证 - GRUB2加密口令"></a>1.7.5 授权认证 - GRUB2加密口令</h4><ul>
<li>GRUB 即GRand Unified Bootloader ，它 是 一个 操 作系 统 启动 管 理器 ， 用来 引 导不 同 系统 （ 如Windows 、Linux），GRUB2是GRUB的升级版</li>
<li>系统启动时，可以通过GRUB2界面修改系统的启动参数。为了确保系统的启动参数不被任意修改，需要对GRUB2界面进行加密，仅在输入正确的GRUB2口令时才能修改启动参数</li>
<li>GRUB2的默认口令为<code>openEuler#12</code>，使用<code>grub2-mkpasswd-pbkdf2</code>命令生成新的加密口令：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@openEuler ~]grub2-mkpasswd-pbkdf2</span><br><span class="line">Enter password:</span><br><span class="line">Reenter password:</span><br><span class="line">PBKDF2 hash of your password is</span><br><span class="line">grub.pbkdf2.sha512.10000.5A45748D892672FDA02DD3B6F7AE390AC6E6D532A600D4AC477D25C7D087644697D8A0894DFED9D86DC2A27F4E01D925C46417</span><br><span class="line">A225FC099C12DBD3D7D49A7425.2BD2F5BF4907DCC389CC5D165DB85CC3E2C94C8F9A30B01DACAA9CD552B731BA1DD3B7CC2C765704D55B8CD962D2AEF</span><br><span class="line">19A753CBE9B8464E2B1EB39A3BB4EAB08</span><br></pre></td></tr></table></figure></li>
</ul>
<p>使用vi工具打开grub.cfg的开始位置追加如下字段：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set superusers=&quot;root&quot;</span><br><span class="line">password_pbkdf2 root</span><br><span class="line">grub.pbkdf2.sha512.10000.5A45748D892672FDA02DD3B6F7AE390AC6E6D532A600D4AC477D25C7D087644697D8A0894DFED9D86DC2A27F4E01D925C46417A225FC099C12DBD3D7D49A7425.2BD2F5BF4907DCC389CC5D165DB85CC3E2C94C8F9A30B01DACAA9CD552B731BA1DD3B7CC2C765704D55B8CD962D2AEF19A753CBE9B8464E2B1EB39A3BB4EAB08</span><br></pre></td></tr></table></figure>

<ul>
<li>GRUB2默认设置的口令为openEuler#12，建议用户首次登录时修改默认密码并定期更新，避免密码泄露后，启动选项被篡改，导致系统启动异常。</li>
<li>不同模式下grub.cfg文件所在路径不同：x86架构的UEFI模式下路径为&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler&#x2F;grub.cfg，legacy BIOS模式下路径为&#x2F;boot&#x2F;grub2&#x2F;grub.cfg；aarch64架构下路径为&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler&#x2F;grub.cfg。<ul>
<li>superusers字段用于设置GRUB2的超级管理员的帐户名</li>
<li>password_pbkdf2字段后的参数，第1个参数为GRUB2的帐户名，第2个为该帐户的加密口令</li>
</ul>
</li>
</ul>
<h4 id="1-7-6-其他授权认证加固方式"><a href="#1-7-6-其他授权认证加固方式" class="headerlink" title="1.7.6 其他授权认证加固方式"></a>1.7.6 其他授权认证加固方式</h4><ul>
<li>安全单用户模式<ul>
<li>单用户模式是以root权限进入系统，如不设置密码，将存在较大安全隐患</li>
<li>该设置可以通过修改&#x2F;etc&#x2F;sysconfig&#x2F;init文件内容实现。将SINGLE选项配置为SINGLE&#x3D;&#x2F;sbin&#x2F;sulogin</li>
</ul>
</li>
<li>禁止交互式启动<ul>
<li>使用交互式引导，控制台用户可以禁用审计、防火墙或其他服务，削弱了系统安全性。用户可以禁止使用交互式引导，提升安全性</li>
<li>该设置可以通过修改&#x2F;etc&#x2F;sysconfig&#x2F;init文件内容实现。将PROMPT选项配置为PROMPT&#x3D;no</li>
</ul>
</li>
</ul>
<h3 id="1-8-单用户模式下重置root密码"><a href="#1-8-单用户模式下重置root密码" class="headerlink" title="1.8 单用户模式下重置root密码"></a>1.8 单用户模式下重置root密码</h3><ul>
<li>当管理员丢失root密码无法进行操作系统时，可在单用户模式下进行root密码重置，具体操作如下：</li>
<li>系统启动前，按“e”对启动条目进行编辑，在指定内核所在的行末添加“rd.break”<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308184352343.png"></li>
<li>输入“ctrl+x”使系统继续启动</li>
<li>进入shell命令行后执行以读写方式挂载&#x2F;sysroot，具体命令为“<code>mount -o remount, rw /sysroot</code>”</li>
<li>将&#x2F;sysroot设置为真正的&#x2F;，具体命令为“chroot &#x2F;sysroot”</li>
<li>使用命令“<code>echo “Huawei@123” | passwd –stdin root</code>”重置密码，其中“<code>Huawei@123</code>”为新密码</li>
<li>为文件重新添加标签，具体命令为“<code>touch /.autorelabel</code>”</li>
<li>输入两次“exit”退出，并重启系统</li>
</ul>
<p>openEuler的启动过程：</p>
<ul>
<li>系统固件运行，进行开机自检</li>
<li>系统固件按照顺序选择可启动设备，并开始搜索所有设备的主启动记录</li>
<li>系统固件读取设备上的boot loader，并将系统控制全交给它</li>
<li>Boot loader根据grub.cfg选择启动的内核，并将内核及initramfs加载到内存中</li>
<li>Boot loader将系统权限转交给内核，内核从initramfs中搜索硬件驱动，并初始化硬件</li>
<li>Systemd启动，并将磁盘中的root文件系统挂载到&#x2F;sysroot上</li>
<li>内核将根文件系统从initramfs切换到&#x2F;sysroot中的根文件系统，systemd随后就使用磁盘中安装的systemd来重新执行</li>
<li>systemd最终找到默认的启动目标，完成本次启动</li>
</ul>
<h3 id="1-9-账户口令系统加固方案"><a href="#1-9-账户口令系统加固方案" class="headerlink" title="1.9 账户口令系统加固方案"></a>1.9 账户口令系统加固方案</h3><p>通过账户口令进行系统加固常用的方式包括：</p>
<ul>
<li>屏蔽系统帐户</li>
<li>限制使用su命令的帐户</li>
<li>设置口令复杂度</li>
<li>设置口令有效期</li>
<li>设置口令的加密算法</li>
<li>登录失败超过三次后锁定</li>
<li>加固su命令</li>
</ul>
<h4 id="1-9-1-屏蔽系统账户和限制使用su命令的帐户"><a href="#1-9-1-屏蔽系统账户和限制使用su命令的帐户" class="headerlink" title="1.9.1 屏蔽系统账户和限制使用su命令的帐户"></a>1.9.1 屏蔽系统账户和限制使用su命令的帐户</h4><ul>
<li><p>屏蔽系统帐户</p>
<ul>
<li>除了用户帐户外，其他账号称为系统帐户。系统帐户仅系统内部使用，禁止用于登录系统或其他操作，因此屏蔽系统帐户</li>
<li>例如将系统帐户的Shell修改为&#x2F;sbin&#x2F;nologin<ul>
<li><code>usermod -L -s /sbin/nologin systemaccount</code></li>
</ul>
</li>
</ul>
</li>
<li><p>限制使用su命令的帐户</p>
<ul>
<li>su命令用于在不同帐户之间切换。为了增强系统安全性，有必要对su命令的使用权进行控制，只允许root和wheel群组的帐户使用su命令，限制其他帐户使用</li>
<li>su命令的使用控制通过修改&#x2F;etc&#x2F;pam.d&#x2F;su文件实现，配置如下：<ul>
<li><code>auth required pam_wheel.so use_uid</code></li>
</ul>
</li>
</ul>
</li>
<li><p>帐户口令</p>
</li>
<li><p>systemaccount 指系统帐户。（daemon、dhcpd、httpd）</p>
</li>
<li><p>use_uid：基于当前帐户的uid。</p>
</li>
</ul>
<h4 id="1-9-2-账户口令复杂度"><a href="#1-9-2-账户口令复杂度" class="headerlink" title="1.9.2 账户口令复杂度"></a>1.9.2 账户口令复杂度</h4><ul>
<li>用户可以通过修改对应配置文件设置口令的复杂度要求，建议用户根据实际情况设置口令复杂度</li>
<li>口 令 复 杂 度 通 过 <code>/etc/pam.d/password-auth 和/etc/pam.d/system-auth</code> 文 件 中 的<code>pam_pwquality.so</code>和<code>pam_pwhistory.so</code>模块实现。用户可以通过修改这两个模块中的配置项修改口令复杂度要求</li>
<li>用户可以通过修改对应配置文件设置口令的复杂度要求，建议用户根据实际情况设置口令复杂度。</li>
</ul>
<h5 id="1-9-2-1-帐户口令复杂度案例"><a href="#1-9-2-1-帐户口令复杂度案例" class="headerlink" title="1.9.2.1 帐户口令复杂度案例"></a>1.9.2.1 帐户口令复杂度案例</h5><p>需求：为了保证操作系统安全，管理要求用户在</p>
<ul>
<li>设置密码时需满足以下要求：</li>
<li>口令长度至少8个字符</li>
<li>口令必须包含如下至少3种字符的组合：<ul>
<li>至少一个小写字母</li>
<li>至少一个大写字母</li>
<li>至少一个数字</li>
<li>至少一个特殊字符：&#96;&#96;~!@#$%^&amp;*()-_&#x3D;+|[{}];:’”,&lt;.&gt;&#x2F;?&#96;和空格</li>
</ul>
</li>
<li>口令不能和帐号或者帐号的倒写一样</li>
<li>不能修改为过去5次使用过的旧口令</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308185142262.png"></p>
<h4 id="1-9-3-帐户口令有效期"><a href="#1-9-3-帐户口令有效期" class="headerlink" title="1.9.3 帐户口令有效期"></a>1.9.3 帐户口令有效期</h4><ul>
<li><p>出于系统安全性考虑，建议设置口令有效期限，且口令到期前通知用户更改口令</p>
</li>
<li><p>口令有效期的设置通过修改&#x2F;etc&#x2F;login.defs文件实现</p>
</li>
<li><p>login.defs是设置用户帐号限制的文件，可配置口令的最大过期天数、最大长度约束等，该文件里的配置对root用户无效。如果&#x2F;etc&#x2F;shadow文件里有相同的选项，则以&#x2F;etc&#x2F;shadow配置为准</p>
</li>
<li><p>口令过期后用户重新登录时，提示口令过期并强制要求修改，不修改则无法进入系统<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308185230380.png"></p>
</li>
<li><p>出于系统安全性考虑，建议设置口令有效期限，且口令到期前通知用户更改口令。</p>
</li>
<li><p>login.defs是设置用户帐号限制的文件，可配置口令的最大过期天数、最大长度约束等。该文件里的配置对root用户无效。如果&#x2F;etc&#x2F;shadow文件里有相同的选项，则以&#x2F;etc&#x2F;shadow配置为准，即&#x2F;etc&#x2F;shadow的配置优先级<strong>高于</strong>&#x2F;etc&#x2F;login.defs。口令过期后用户重新登录时，提示口令过期并强制要求修改，不修改则无法进入系统。</p>
</li>
</ul>
<h4 id="1-9-4-账户口令的加密算法"><a href="#1-9-4-账户口令的加密算法" class="headerlink" title="1.9.4 账户口令的加密算法"></a>1.9.4 账户口令的加密算法</h4><ul>
<li>出于系统安全考虑，口令不允许明文存储在系统中，应该加密保护。在不需要还原口令的场景，必须使用<strong>不可逆算法加密</strong>。设置口令的加密算法为sha512，openEuler默认已设置。通过上述设置可以有效防范口令泄露，保证口令安全</li>
<li>口令的加密算法设置通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth实现，添加如下配置：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br></pre></td></tr></table></figure></li>
<li>其中sha512表示使用sha512算法对口令进行加密</li>
<li>出于系统安全考虑，口令不允许明文存储在系统中，应该加密保护。在不需要还原口令的场景，必须使用不可逆算法加密。</li>
<li>用户锁定期间，任何输入被判定为无效，锁定时间不因用户的再次输入而重新计时；解锁后，用户的错误输入记录被清空。通过上述设置可以有效防范口令被暴力破解，增强系统的安全性。</li>
</ul>
<h4 id="1-9-5-登录失败超过三次后锁定"><a href="#1-9-5-登录失败超过三次后锁定" class="headerlink" title="1.9.5 登录失败超过三次后锁定"></a>1.9.5 登录失败超过三次后锁定</h4><ul>
<li>为了保障用户系统的安全，建议用户设置口令出错次数的阈值（建议3次），以及由于口令尝试被锁定用户的自动解锁时间（建议300秒）</li>
<li>用户锁定期间，任何输入被判定为无效，锁定时间不因用户的再次输入而重新计时；解锁后，用户的错误输入记录被清空。通过上述设置可以有效防范口令被暴力破解，增强系统的安全性</li>
<li>具体配置实现方式如下：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auth required pam_faillock.so preauth audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth [default=die] pam_faillock.so authfail audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth sufficient pam_faillock.so authsucc audit deny=3 even_deny_root unlock_time=300</span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250308185739995.png"></li>
</ul>
<h3 id="1-10-文件的基本权限"><a href="#1-10-文件的基本权限" class="headerlink" title="1.10 文件的基本权限"></a>1.10 文件的基本权限</h3><ul>
<li>Linux将所有对象都当作文件来处理，即使一个目录也被看作是包含有多个其他文件的大文件。因此，Linux中最重要的就是文件和目录的安全性。文件和目录的安全性主要通过权限和属主来保证</li>
<li>openEuler默认对系统中的常用目录、可执行文件和配置文件设置了权限和属主</li>
<li>用户可以通过chmod和chown来修改文件的权限、属主和属组修改文件权限。例如将&#x2F;bin目录权限设置为755</li>
<li><code>chmod 755 /bin</code></li>
<li>修改文件属主。例如将&#x2F;bin目录的拥有者和群组设置为root:root</li>
<li><code>chown root:root /bin</code></li>
</ul>
<h3 id="1-11-加固su命令"><a href="#1-11-加固su命令" class="headerlink" title="1.11 加固su命令"></a>1.11 加固su命令</h3><ul>
<li>为了增强系统安全性，防止使用”su”切换用户时将当前用户环境变量带入其他环境，openEuler默认已做配置。总是在使用su切换用户时初始化PATH</li>
<li>通过修改&#x2F;etc&#x2F;login.defs实现，配置如下：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALWAYS_SET_PATH=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-12-文件权限系统加固方案"><a href="#1-12-文件权限系统加固方案" class="headerlink" title="1.12 文件权限系统加固方案"></a>1.12 文件权限系统加固方案</h3><p>通过设置文件权限进行系统加固常用的方式包括：</p>
<ul>
<li>设置文件的权限和属主</li>
<li>删除无主文件</li>
<li>处理空链接文件</li>
<li>设置守护进程的umask值</li>
<li>为全局可写目录添加粘滞位属性</li>
<li>删除非授权文件的全局可写属性</li>
<li>限制at命令的使用权限</li>
<li>限制cron命令的使用权限</li>
<li>限制sudo命令的使用权限</li>
</ul>
<h4 id="1-12-1-设置文件的权限和属主"><a href="#1-12-1-设置文件的权限和属主" class="headerlink" title="1.12.1 设置文件的权限和属主"></a>1.12.1 设置文件的权限和属主</h4><ul>
<li>Linux将所有对象都当作文件来处理，即使一个目录也被看作是包含有多个其他文件的大文件。因此，Linux中最重要的就是文件和目录的安全性。文件和目录的安全性主要通过权限和属主来保证</li>
<li>openEuler默认对系统中的常用目录、可执行文件和配置文件设置了权限和属主</li>
<li>需求：将&#x2F;bin目录权限设置为755，并将其所属组和所属用户设置为root</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /bin</span><br><span class="line">chown root:root /bin</span><br></pre></td></tr></table></figure>


<h4 id="1-12-2-删除无主文件"><a href="#1-12-2-删除无主文件" class="headerlink" title="1.12.2 删除无主文件"></a>1.12.2 删除无主文件</h4><ul>
<li>系统管理员在删除用户&#x2F;群组时，存在着忘记删除该用户&#x2F;该群组所拥有文件的问题。如果后续新创建的用户&#x2F;群组与被删除的用户&#x2F;群组同名，则新用户&#x2F;新群组会拥有部分不属于其权限的文件，建议将此类文件删除查找并删除用户ID不存在的文件</li>
<li>删除用户ID不存在的文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -nouser</span><br><span class="line">rm -f filename</span><br></pre></td></tr></table></figure></li>
<li>删除群组ID不存在的文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -nogroup</span><br><span class="line">rm -f filename</span><br></pre></td></tr></table></figure></li>
<li>dirname为搜索目录的名称，通常需要关注系统关键目录：&#x2F;bin、&#x2F;boot、&#x2F;usr、&#x2F;lib64、&#x2F;lib、&#x2F;var等。</li>
<li>openEuler系统安装完成后，可能存在空链接文件，这些空链接文件可能有对应用途（有些空链接文件是预制的，会被其他组件依赖），请用户根据实际环境进行处理。</li>
<li>-follow：如果find命令遇到符号链接文件，就跟踪至链接所指向的文件。</li>
</ul>
<h4 id="1-12-3-处理空链接文件"><a href="#1-12-3-处理空链接文件" class="headerlink" title="1.12.3 处理空链接文件"></a>1.12.3 处理空链接文件</h4><ul>
<li>无指向的空链接文件，可能会被恶意用户利用，影响系统安全性。建议用户删除无效的空链接文件，提高系统安全性删除用户ID不存在的文件</li>
<li>openEuler系统安装完成后，可能存在空链接文件，这些空链接文件可能有对应用途（有些空链接文件是预制的，会被其他组件依赖）。请用户根据实际环境进行处理，处理方式如下：<ul>
<li><p>使用以下命令查找系统中的空链接文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find dirname -type l -follow 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果此类文件无实际作用，可通过以下命令删除</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find dirname -type l -follow 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h4 id="1-12-4-设置守护进程的umask值"><a href="#1-12-4-设置守护进程的umask值" class="headerlink" title="1.12.4 设置守护进程的umask值"></a>1.12.4 设置守护进程的umask值</h4><ul>
<li>Umask值用来为新创建的文件和目录设置缺省权限。如果没有设定umask值，则生成的文件具有全局可写权限，存在一定的风险。守护进程负责系统上某个服务，让系统可以接受来自用户或者是网络客户的要求。为了提高守护进程所创建文件和目录的安全性，建议设置其umask值为0027</li>
<li>openEuler默认已设置守护进程的umask值为0022</li>
<li>设置文件umask值可通过在文件&#x2F;etc&#x2F;sysconfig&#x2F;init中新增一行“umask 0027”来实现</li>
</ul>
<h4 id="1-12-5-为全局可写目录添加粘滞位属性"><a href="#1-12-5-为全局可写目录添加粘滞位属性" class="headerlink" title="1.12.5 为全局可写目录添加粘滞位属性"></a>1.12.5 为全局可写目录添加粘滞位属性</h4><ul>
<li>任意用户可以删除、修改全局可写目录中的文件和目录，为了确保全局可写目录中的文件和目录不会被任意删除，需要为全局可写目录添加粘滞位属性，具体实现如下：</li>
<li>搜索全局可写目录<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ind / -type d -perm -0002 ! -perm -1000 -ls | grep -v proc</span><br></pre></td></tr></table></figure>
为全局可写目录添加粘滞位属性。dirname 为实际查找到的目录名<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +t dirname</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-12-6-删除非授权文件的全局可写属性"><a href="#1-12-6-删除非授权文件的全局可写属性" class="headerlink" title="1.12.6 删除非授权文件的全局可写属性"></a>1.12.6 删除非授权文件的全局可写属性</h4><ul>
<li>全局可写文件可被系统中的任意用户修改，影响系统完整性，具体实现方式如下：<ul>
<li>列举系统中所有的全局可写文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -type d ( -perm -o+w ) | grep -v proc</span><br><span class="line">find / -type f ( -perm -o+w ) | grep -v proc</span><br></pre></td></tr></table></figure>
查看上步中列举的所有文件(粘滞位位的文件和目录可以排除在外)，删除文件或去掉其全局可写权限。使用以下命令去掉权限，其中filename为对应文件名<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod o-w filename</span><br></pre></td></tr></table></figure>
可通过如下命令确定对应文件或目录是否设置了粘滞位，若回显中包含T标记，则为粘滞位文件或目录。命令中的filename为需要查询文件或目录的名称<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l filename</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>粘滞位t目前只对目录有效，拥有粘滞位的目录，除root用户可以删除所有的文件，普通用户只能删除自己创建的文件，而不能删除其他用户的创建的文件。</li>
<li>SetUID&#x3D;4,SetGID&#x3D;2,t&#x3D;1,首位表示特殊权限：7000</li>
<li>-perm：按照文件权限来查找文件</li>
</ul>
<h4 id="1-12-7-限制at命令的使用权限"><a href="#1-12-7-限制at命令的使用权限" class="headerlink" title="1.12.7 限制at命令的使用权限"></a>1.12.7 限制at命令的使用权限</h4><ul>
<li>at命令用于创建在指定时间自动执行的任务。为避免任意用户通过at命令安排工作，造成系统易受攻击，需要指定可使用该命令的用户，具体实现如下：</li>
<li>删除&#x2F;etc&#x2F;at.deny文件<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /etc/at.deny</span><br></pre></td></tr></table></figure>
&#x2F;etc&#x2F;at.allow的文件属主改为root:root<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> root:root /etc/at.allow</span><br></pre></td></tr></table></figure>
控制&#x2F;etc&#x2F;at.allow的文件权限，仅root可操作<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> og-rwx /etc/at.allow</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-12-8-限制cron命令的使用权限"><a href="#1-12-8-限制cron命令的使用权限" class="headerlink" title="1.12.8 限制cron命令的使用权限"></a>1.12.8 限制cron命令的使用权限</h4><ul>
<li>cron命令用于创建例行性任务。为避免任意用户通过cron命令安排工作，造成系统易受攻击，需要指定可使用该命令的用户，具体实现如下所示：<br>删除&#x2F;etc&#x2F;at.deny文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/at.deny</span><br></pre></td></tr></table></figure>
etc&#x2F;at.allow的文件属主改为root:root<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> root:root /etc/at.allow</span><br></pre></td></tr></table></figure>
控制&#x2F;etc&#x2F;at.allow的文件权限，仅root可操作<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> og-rwx /etc/at.allow</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-12-9-限制sudo命令的使用权限"><a href="#1-12-9-限制sudo命令的使用权限" class="headerlink" title="1.12.9 限制sudo命令的使用权限"></a>1.12.9 限制sudo命令的使用权限</h4><ul>
<li>sudo命令用于普通用户以root权限执行命令。为了增强系统安全性，有必要对sudo命令的使用权进行控制，只允许root使用sudo命令，限制其他帐户使用。openEuler默认未限制非root用户使用sudo命令的权限，具体实现如下所示：</li>
<li>sudo命令的使用控制通过修改&#x2F;etc&#x2F;sudoers文件实现，需要注释掉如下配置行<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#%wheel ALL=(ALL) ALL</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-13-加固SSH服务"><a href="#1-13-加固SSH服务" class="headerlink" title="1.13 加固SSH服务"></a>1.13 加固SSH服务</h3><ul>
<li><p>SSH是专为远程登录会话和其他网络服务提供安全性保障的协议。利用SSH协议可以有效防止远程管理过程中的信息泄露问题。透过SSH可以对所有传输的数据进行加密，并防止DNS欺骗和IP欺骗。OpenSSH是SSH协议的免费开源实现</p>
</li>
<li><p>加固SSH服务，是指修改SSH服务中的配置来设置系统使用OpenSSH协议时的算法、认证等参数，从而提高系统的安全性</p>
</li>
<li><p>SSH服务加固可通过修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件内容实</p>
</li>
<li><p>常用加固策略<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514210006068.png"></p>
</li>
<li><p>ClientAliveCountMax：服务器发出请求后，客户端没有响应的次数达到一定值，连接自动断开</p>
</li>
<li><p>LoginGraceTime：0 表示无限制。默认值是 120 秒。</p>
</li>
<li><p>算法加固策略<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514210040026.png"></p>
</li>
<li><p>其他安全建议<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514210051932.png"></p>
</li>
<li><p>ListenAddress：出于安全考虑，建议用户在使用SSH服务时，仅在必需的IP上进行绑定侦听，而不是侦听0.0.0.0。</p>
</li>
</ul>
<h2 id="0x02-操作系统网络安全"><a href="#0x02-操作系统网络安全" class="headerlink" title="0x02 操作系统网络安全"></a>0x02 操作系统网络安全</h2><h3 id="2-1-操作系统网络安全概述"><a href="#2-1-操作系统网络安全概述" class="headerlink" title="2.1 操作系统网络安全概述"></a>2.1 操作系统网络安全概述</h3><ul>
<li>网络安全加固是基于内核态的netfilter数据包过滤框架，依据用户预先设定的规则，在<strong>网络层</strong>对数据包进行匹配，并作出相应的动作，从而达到对网络流量的控制</li>
<li>常用的用户命令行工具有iptables和firewalld</li>
<li>Firewalld基于“区域”的概念，依据用户自定义的安全策略，动态地管理网络连接和接口，可为服务或应用程序制定丰富的防火墙规则</li>
</ul>
<h3 id="2-2-Netfilter介绍"><a href="#2-2-Netfilter介绍" class="headerlink" title="2.2 Netfilter介绍"></a>2.2 Netfilter介绍</h3><h4 id="2-2-1-Netfilter生态工具"><a href="#2-2-1-Netfilter生态工具" class="headerlink" title="2.2.1 Netfilter生态工具"></a>2.2.1 Netfilter生态工具</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514210514489.png"></p>
<ul>
<li>每个进入网络系统的包在经过协议栈时都会触发这些hook，程序可以通过注册hook函数的方式在一些关键路径上处理网络流量。</li>
<li>Iptables：面向系统管理员，用于管理linux数据包过滤规则集的用户命令行工具。</li>
<li>Nftables：基于特定的网络虚拟设备和全新的内核数据包分类框架的nft用户命令行工具。nftables重用了现有的netfilter子系统，拥有更多灵活、可扩展和高性能的数据包分类，旨在取代目前的{IP，IP6，ARP，EB}tables。</li>
<li>Firewalld：利用防火墙的“区域”概念，动态地管理网络连接或接口的安全策略，可为服务或应用程序直接添加防火墙规则，即时生效。</li>
<li>Firewalld曾使用iptables命令来直接配置iptables，目前使用的nfs来管理防火墙规则</li>
</ul>
<h4 id="2-2-2-Netfilter简介"><a href="#2-2-2-Netfilter简介" class="headerlink" title="2.2.2 Netfilter简介"></a>2.2.2 Netfilter简介</h4><ul>
<li>Netfilter是Linux内核中的一个数据包过滤软件，它具备以下特性：<ul>
<li>无状态数据包过滤</li>
<li>有状态数据包过滤</li>
<li>网络地址和端口转换</li>
<li>灵活和易扩展的架构</li>
<li>提供可支持第三方扩展的多层API接口</li>
</ul>
</li>
<li>参考信息： <a target="_blank" rel="noopener" href="https://www.netfilter.org/index.html">https://www.netfilter.org/index.html</a></li>
</ul>
<h4 id="2-2-3-Netfilter原理"><a href="#2-2-3-Netfilter原理" class="headerlink" title="2.2.3 Netfilter原理"></a>2.2.3 Netfilter原理</h4><ul>
<li>Netfilter是通过linux内核中内置的5个hooks来实现对网络层数据包的控制</li>
<li>Netfilter hooks是Liunx内核中的一个框架，它允许内核模块在Linux网络栈的不同位置注册回调函数，这些函数会对穿过Linux网络栈各个钩子的数据包进行过滤<ul>
<li><code>NF_IP_PRE_ROUTING</code>： 在数据包进入网络栈后，路由决策前触发此hook</li>
<li><code>NF_IP_LOCAL_IN</code>：      在路由判断包是发送到本机时触发此hook</li>
<li><code>NF_IP_FORWARD</code>：        在路由判断包需要转发给其他主机时触发此hook</li>
<li><code>NF_IP_LOCAL_OUT</code>：     在本机进程产生包时，被送到网络栈前触发此hook</li>
<li><code>NF_IP_POST_ROUTING</code>：在数据包经过路由判断后，即将发送到网络前触发此hook</li>
</ul>
</li>
</ul>
<h4 id="2-2-4-数据包过滤流程"><a href="#2-2-4-数据包过滤流程" class="headerlink" title="2.2.4 数据包过滤流程"></a>2.2.4 数据包过滤流程</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514211057867.png"></p>
<ul>
<li>以本地为目标的包<ul>
<li>PRE_ROUTING -&gt; ROUTE -&gt; LOCAL_IN</li>
</ul>
</li>
<li>从本地发出的包<ul>
<li>LACAL_OUT -&gt; POST_ROUTING</li>
</ul>
</li>
<li>从本机转发的包<ul>
<li>PRE_ROUTING -&gt; ROUTE -&gt; FORWARD -&gt; POST_ROUTING</li>
</ul>
</li>
</ul>
<h3 id="2-3-Iptables详述"><a href="#2-3-Iptables详述" class="headerlink" title="2.3 Iptables详述"></a>2.3 Iptables详述</h3><ul>
<li>IPtables是使用很广泛的Linux防火墙之一，它基于内核的包过滤框架（packet filtering framework）netfilter，面向系统管理员，用于管理Linux数据包过滤规则集的用户命令行工具</li>
</ul>
<p><strong>实验手册P287</strong></p>
<h4 id="2-3-1-Iptables的表、链和规则"><a href="#2-3-1-Iptables的表、链和规则" class="headerlink" title="2.3.1 Iptables的表、链和规则"></a>2.3.1 Iptables的表、链和规则</h4><ul>
<li>IPtables使用表来分类规则，每张表的内部规则又被链串联起来<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250514211316536.png"></li>
<li>这边表非常清晰的向我们展示了表、链和规则之间的逻辑关系</li>
<li>纵向看：每张表都包含了具体的链，而每条链又包含了具体的规则。</li>
<li>表赋予了链的功能，而链给出了实现这些功能的具体操作，也就是我们所说规则。</li>
<li>横向看：同一条链出现在不同的表里，前面我们也介绍了每条链的主要功能，这里我们也能猜测每条链的附属功能。</li>
<li>总结来说，链就是将多个规则串起来的一个集合单位；表(table)：具有相同功能的规则的集合，表与表串联起来就对应了不同数据包的处理流程。</li>
</ul>
<h4 id="2-3-2-Iptables中的五表"><a href="#2-3-2-Iptables中的五表" class="headerlink" title="2.3.2 Iptables中的五表"></a>2.3.2 Iptables中的五表</h4><ul>
<li>表（table）：具有相同功能规则的集合，表与表的串联对应了不同数据包的处理流程<ul>
<li>Filter表： iptables中使用最广泛的表，作用是进行过滤，即由filter表来决定一个数据包是否继续发往它的目的地址或被拒绝丢弃</li>
<li>Nat表：用于网络地址转换，依据规则改变数据包的源地址或者目的地址，即DNAT（将本地网络映射到公网IP，用于对外提供服务）和SNAT（用于局域网共享一个公网IP，也就是充当网关设备会使用）</li>
<li>Mangle表：用于改变数据包的头部信息，如TTL</li>
<li>Raw表：为iptables提供了一种不经过连接追踪的机制，在大流量对外业务的服务器上使用这个表可以避免连接追踪带来的性能问题</li>
<li>Security表：提供在数据包中加入SELinux特性的功能</li>
<li>根据介绍表的顺序也可以看出，表的实际使用频率也是从上至下的。</li>
</ul>
</li>
</ul>
<h4 id="2-3-3-Iptables中的五链"><a href="#2-3-3-Iptables中的五链" class="headerlink" title="2.3.3 Iptables中的五链"></a>2.3.3 Iptables中的五链</h4><ul>
<li><p>链（chain）：将多个规则串联起来的一个集合，每个经过这个“关卡”的报文，都要将这条链”上的所有规则匹配一遍，如果有符合条件的报文，则执行规则对应的动作，如果没有则执行默认的动作</p>
</li>
<li><p>Iptables中的“链”是由netfilter中的钩子（hook）实现的，当数据包经过网络栈的时候，这些钩子上注册的内核模块依次被触发</p>
<ul>
<li>PREROUTING：由NF_IP_PRE_ROUTING钩子触发</li>
<li>INPUT： 由NF_IP_LOCAL_IN钩子触发</li>
<li>FORWARD： 由NF_IP_FORWARD触发</li>
<li>OUTPUT： 由NF_IP_LOCAL_OUT触发</li>
<li>POSTROUTING： 由NF_IP_POST_ROUTING触发</li>
</ul>
</li>
<li><p>Iptables中的五链就像五个关卡，每个经过这个关卡的包，都会将这条链上的规则匹配一遍，如果有符合条件的数据包，则执行规则对应的动作，如果没有则执行默认的动作。</p>
</li>
<li><p>这五条链就像长途高速公路的五个收费站，依次处理过往的车流量，符合规定的车辆放行，不符合规定的车辆则扣留。</p>
</li>
<li><p>这里文档对五表五链的具体规则并未做出详细介绍，可以参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/xyz_dream/article/details/147224441">https://blog.csdn.net/xyz_dream/article/details/147224441</a></p>
</li>
</ul>
<ol>
<li>PREROUTING 链<br>位置：数据包刚进入防火墙，还未进行路由判断时就会进入该链。<br>功能：主要用于目的地址转换（DNAT）和修改数据包的目的地址。常见应用场景是端口转发，即把外部对特定 IP 和端口的访问转发到内部网络的其他主机和端口上。此外，mangle表和raw表也会在这个阶段对数据包进行相应处理，比如修改数据包的 IP 首部信息或者决定是否进行状态跟踪。</li>
<li>INPUT 链<br>位置：当数据包经过路由判断，确定是要进入本地主机时，就会进入该链。<br>功能：对进入本地主机的数据包进行过滤，决定是否允许这些数据包进入本地主机。这是保障本地主机安全的重要防线，可以根据源 IP 地址、端口、协议等条件来制定过滤规则，阻止恶意攻击和非法访问。</li>
<li>FORWARD 链<br>位置：当数据包经过路由判断，确定该数据包不是要进入本地主机，而是要经过本地主机转发到其他主机时，会进入此链。<br>功能：对经过本地主机转发的数据包进行过滤，只有通过FORWARD链规则检查的数据包才会被转发出去。这个链常用于路由器或者网关设备，确保转发的数据包符合安全策略。</li>
<li>OUTPUT 链<br>位置：当本地主机产生要发送出去的数据包时，数据包会先进入该链。<br>功能：对本地主机发出的数据包进行过滤和处理，决定是否允许这些数据包从本地主机发出。可以根据目的 IP 地址、端口、协议等条件来制定规则，防止本地主机向外发送非法或者不安全的数据包。</li>
<li>POSTROUTING 链<br>位置：数据包即将离开防火墙之前会进入该链。<br>功能：<strong>主要用于源地址转换（SNAT）和修改数据包的源地址</strong>。常见的应用场景是让内部网络的主机共享一个公共 IP 地址访问外部网络，即把内部主机的私有 IP 地址转换为公共 IP 地址。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250517161936270.png"></p>
<h4 id="2-3-4-Iptables工作原理"><a href="#2-3-4-Iptables工作原理" class="headerlink" title="2.3.4 Iptables工作原理"></a>2.3.4 Iptables工作原理</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250515234120650.png"></p>
<ul>
<li>表赋予了链的功能，而链给出了实现这些功能的具体操作，也就是我们所说规则。</li>
</ul>
<h4 id="2-3-5-Iptables的表链关系"><a href="#2-3-5-Iptables的表链关系" class="headerlink" title="2.3.5 Iptables的表链关系"></a>2.3.5 Iptables的表链关系</h4><ul>
<li>表格展示了表和链的关系，横向是链，纵向是表，Y表示表里有链<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250515234220388.png"></li>
<li>所有状态的改变和计算都是在nat表中的PREROUTING链和OUTPUT链里完成的。除了本地产生的包由OUTPUT链处理外，所有连接追踪都是在PREROUTING链里进行处理的。</li>
<li>nat table被细分成了DNAT（修改目的地址）和SNAT（修改源地址），以更方便地展示他们的优先级。</li>
<li>内核在注册处理函数时提供了优先级，以便hook触发时能按照优先级高低调用处理函数。同时使得多个模块可以在同一hook点注册，并且有确定的处理顺序。</li>
</ul>
<h4 id="2-3-6-Iptables中的连接追踪机制"><a href="#2-3-6-Iptables中的连接追踪机制" class="headerlink" title="2.3.6 Iptables中的连接追踪机制"></a>2.3.6 Iptables中的连接追踪机制</h4><ul>
<li>Iptables防火墙是有状态的，对每个包进行判断的时候是依赖已经判断过的包</li>
<li>建立在netfilter之上的连接跟踪（connection tracking）特性使得iptables将包看作会话的一部分，而不是一个由独立、不相关的包组成的流。数据包到达网络接口之后很快就会有连接跟踪逻辑判断<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250515234451964.png"></li>
<li>现在我们介绍iptables的连接追踪机制。</li>
<li>iptables 防火墙是有状态的：对每个包进行判断的时候是依赖已经判断过的包。</li>
<li>建立在netfilter之上的连接跟踪（connection tracking）特性使得iptables将包看作已有的连接或会话的一部分，而不是一个由独立、不相关的包组成的流。 数据包到达网络接口之后很快就会被打上相应的状态标记</li>
<li>概要来说，连接追踪系统在一个内存数据结构中记录了连接的状态，这些信息包括源IP、目的IP、双方端口号（对TCP和UDP）、协议类型、状态和超时信息等。有了这些信息，我们可以设置更灵活的过滤策略。</li>
</ul>
<h4 id="2-3-7-Iptables中的会话机制"><a href="#2-3-7-Iptables中的会话机制" class="headerlink" title="2.3.7 Iptables中的会话机制"></a>2.3.7 Iptables中的会话机制</h4><ul>
<li>Iptables会将属于同一连接的所有报文作为一个整体的数据流（会话）来对待。会话表是用来记录TCP、UDP、ICMP等协议连接状态的表项，是iptables转发报文的重要依据<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250515234719929.png"></li>
<li>防火墙采用了基于“状态”的报文控制机制：只对首包或者少量报文进行检测就确定一条连接的状态，大量报文直接根据所属连接的状态进行控制。这种状态检测机制迅速提高了防火墙的检测和转发效率。会话表就是为了记录连接的状态而存在的。设备在转发TCP、UDP和ICMP报文时都需要查询会话表，来判断该报文所属的连接并采取相应的处理措施。</li>
</ul>
<h4 id="2-3-8-Iptables语法规则"><a href="#2-3-8-Iptables语法规则" class="headerlink" title="2.3.8 Iptables语法规则"></a>2.3.8 Iptables语法规则</h4><ul>
<li>规则就是指向标，在一条链上，对不同的连接和数据包阻塞或允许它们去向何处。插入链的每一行都是一条规则</li>
<li>在内核看来，规则就是决定如何处理一个包的语句。如果一个包符合所有的条件（就是符合match语句），我们就运行target或jump命令</li>
<li>语法格式：<ul>
<li><code>iptables [-t table] CHAIN command [match] [target/jump]</code><ul>
<li><code>[-t table]</code>：指定操作的表，默认情况下是filter表</li>
<li><code>CHAIN</code>：指定表中对应的链去处理规则</li>
<li><code>[COMMAND]</code>：指定iptables对我们提交的规则要做什么样的操作</li>
<li><code>[match]</code>：匹配规则</li>
<li><code>[target/jump]</code>：决定符合条件的包到何处去</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-3-8-1-COMMAND"><a href="#2-3-8-1-COMMAND" class="headerlink" title="2.3.8.1 COMMAND"></a>2.3.8.1 COMMAND</h5><ul>
<li>以下是iptables可用的command，默认是对filter表操作，可借助-h给出简短的语法说明<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250516151255903.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250516151407597.png"></li>
<li>-P 默认策略只有两种，ACCEPT和DROP</li>
<li>-X 删除用户自定义链时，链规则必须清空后才允许删除</li>
<li>-Z 链内有两个计数器，记录了匹配到了多少个包以及多少个字节</li>
</ul>
<h5 id="2-3-8-2-MATCH"><a href="#2-3-8-2-MATCH" class="headerlink" title="2.3.8.2 MATCH"></a>2.3.8.2 MATCH</h5><ul>
<li><p>MATCH：描述包的详细特点，以匹配规则来执行的动作，可分为通用匹配和扩展匹配</p>
</li>
<li><p>通用匹配：适用所有规则，没有前提条件，可直接使用</p>
</li>
<li><p>扩展匹配：分为显示匹配和隐含匹配</p>
</li>
<li><p>显式匹配必须用-m或–match装载，目前可用的模块有Limit、MAC、Multiport、Owner、State和TTL，下面列举部分常用的选项<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250516151553665.png"></p>
</li>
<li><p>隐含匹配操作是自动地或隐含地装载入内核的。现在有三种隐含的匹配针对三种不同的协议，即TCP matches，UDP matches和 ICMP matches，它们分别包括一套只适用于相应协议的判别标准<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250516151619188.png"></p>
</li>
<li><p>显式匹配必须用-m或–match装载，目前可用的模块有Limit、MAC、Multiport、Owner、State和TTL，下面列举部分常用的选项<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/file-20250516151646621.png"></p>
</li>
<li><p><code>--state</code>和<code>--ctstate</code>:<br>对应<code>-m state</code> 或 <code>-m conntrack</code>（连接状态跟踪）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li>
<li><p><code>--ctstate</code> 支持的常见状态：</p>
<ul>
<li><code>NEW</code>：新发起的连接。</li>
<li><code>ESTABLISHED</code>：已建立的连接。</li>
<li><code>RELATED</code>：与已有连接相关的连接（如 FTP 数据传输）。</li>
</ul>
</li>
</ul>
<h5 id="2-3-8-3-Targets-Jumps"><a href="#2-3-8-3-Targets-Jumps" class="headerlink" title="2.3.8.3 Targets&#x2F;Jumps"></a>2.3.8.3 Targets&#x2F;Jumps</h5><ul>
<li>target&#x2F;jump决定符合条件的包到何处去，语法是–jump target或-j target<ul>
<li>ACCEPT&#x2F;DROP target：将符合条件的包放行&#x2F;丢弃</li>
<li>REJECT target：将符合条件的包拒绝，并向发送者返回错误信息</li>
<li>DNAT target：目的网络地址转换，当包被匹配时，会被路由到正确的主机和网络</li>
<li>SNAT target：源网络地址转换，把所有从本地网络出去的包的源地址改为Internet连接的地址</li>
<li>MASQUERADE target：源网络地址转换，但不需要指定源地址，自动获取网络接口的IP地址</li>
<li>REDIRECT target：转发主机内部的包到另一个端口，且本地生成的包都会被映射到127.0.0.1</li>
<li>LOG target：记录有关包的信息，这个功能是通过内核的日志工具完成的，一般是syslogd</li>
<li>RETURN target：使包返回上一层，顺序是子链—&gt;父链—&gt;缺省策略</li>
</ul>
</li>
</ul>
<h4 id="2-3-9-Iptables规则集的保存与恢复"><a href="#2-3-9-Iptables规则集的保存与恢复" class="headerlink" title="2.3.9 Iptables规则集的保存与恢复"></a>2.3.9 Iptables规则集的保存与恢复</h4><ul>
<li>iptables提供了两个很有用的工具用来处理大规则集，它们把规则存入一个特殊格式的文件中，或从中恢复规则<ul>
<li><code>iptables-save [-c] [-t table]</code>：把当前规则存入文件<ul>
<li>-c：保存包和字节计数器的值，重启防火墙而不中断统计记数程序，默认不使用</li>
<li>-t：指定要保存的表，默认是保存所有的表</li>
</ul>
</li>
<li><code>iptables-restore [-c] [-n]</code>：装载由iptables-save保存的规则集<ul>
<li>-c，–counters：装载包和字节计数器</li>
<li>-n，–noflush：不覆盖已有的表或表内的规则，默认情况是清除所有已存的规则</li>
</ul>
</li>
</ul>
</li>
<li>使用iptables-save和iptables-restore的一个最重要的原因是，它们能在相当程度上提高装载、保存规则的速度。</li>
<li>如果你的工作对象是一组巨大的规则，这两个工具是明显的选择。</li>
</ul>
<h4 id="2-3-10-Iptables配置案例-访问控制"><a href="#2-3-10-Iptables配置案例-访问控制" class="headerlink" title="2.3.10 Iptables配置案例 - 访问控制"></a>2.3.10 Iptables配置案例 - 访问控制</h4><ul>
<li>允许所有来源的IP访问本机TCP 22端口<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22  --ctstate NEW,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li>
<li>允许本机ping其他主机<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p icmp  --icmp-type echo-request -j ACCEPT</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT</span><br></pre></td></tr></table></figure></li>
<li>拒绝104.224.147.43来源的IP访问TCP 80端口<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -s 104.224.147.43 --dport 80 -j REJECT</span><br></pre></td></tr></table></figure></li>
<li>保存iptables的规则<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-11-Iptables配置案例-NAT地址转换"><a href="#2-3-11-Iptables配置案例-NAT地址转换" class="headerlink" title="2.3.11 Iptables配置案例 - NAT地址转换"></a>2.3.11 Iptables配置案例 - NAT地址转换</h4><ul>
<li>源地址转换（SNAT）：Server02通过Server01上外网，在互联网上看到的源地址是Server01的外网IP<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Server01上执行以下命令</span><br><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to 192.168.0.48</span><br></pre></td></tr></table></figure></li>
<li>目的地址转换：外部用户需要直接访问无外网IPServer02提供的服务<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Server01上执行以下命令</span><br><span class="line">iptables -t nat -A PREROUTING -d 192.168.0.48 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.0.49:80</span><br><span class="line">iptables -t nat -A POSTROUTING -d 192.168.0.48 -p tcp -m tcp --dport 80 -j SNAT --to-source</span><br><span class="line">192.168.0.49</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-4-Firewalld详述"><a href="#2-4-Firewalld详述" class="headerlink" title="2.4 Firewalld详述"></a>2.4 Firewalld详述</h3><h4 id="2-4-1-Firewalld架构简述"><a href="#2-4-1-Firewalld架构简述" class="headerlink" title="2.4.1 Firewalld架构简述"></a>2.4.1 Firewalld架构简述</h4><ul>
<li>Firewalld一共分为核心层和顶部的D-Bus层<ul>
<li>核心层负责处理各种配置文件（.xml）和后端组件，如iptables、ip6tables、ebtables和modules等</li>
<li>D-Bus接口是更改和创建防火墙配置的主要方法，该界面由所有firewalld提供的工具使用，如firewall-cmd、firewall-config、firewall-applet和firewall-offine-cmd<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516160959584.png"></li>
</ul>
</li>
<li>firewall-offline-cmd不与firewalld通信，而是直接使用 firewalld 核心和 IO 处理程序更改和创建 firewalld 配置文件。防火墙-脱机-cmd 可以在 firewalld 运行时使用，但不建议这样做，因为它只能在大约五秒钟后更改防火墙中可见的永久配置。</li>
</ul>
<h4 id="2-4-2-Firewalld策略"><a href="#2-4-2-Firewalld策略" class="headerlink" title="2.4.2 Firewalld策略"></a>2.4.2 Firewalld策略</h4><ul>
<li><p>Firewalld的基本作用是对进出网络的访问行为进行控制，保护特定网络免受“不信任”网络的攻击，但同时还必须允许两个网络之间可以进行合法的通信。Firewalld一般通过安全策略实现以上功能</p>
</li>
<li><p>最基本的设计原则一般是没有明确允许的流量默认都会被禁止，这样能够确保Firewalld一旦接入网络就能保护网络的安全</p>
</li>
<li><p>安全策略匹配过程如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516161347031.png"></p>
</li>
<li><p>Firewalld是通过策略来对进出网络的访问行为进行控制，默认拒绝所有流量。</p>
</li>
<li><p>流量的返回路径默认是允许的，由于防火墙的连接追踪机制</p>
</li>
</ul>
<h4 id="2-4-3-Firewalld区域概念"><a href="#2-4-3-Firewalld区域概念" class="headerlink" title="2.4.3 Firewalld区域概念"></a>2.4.3 Firewalld区域概念</h4><ul>
<li>Firewalld区域定义连接、接口或源地址的信任级别，这是一对多关系，这意味着连接、接口或源地址只能是一个区域的一部分，但一个区域可用于多个连接、接口或源地址</li>
<li>预定义的区域：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516161543657.png"></li>
</ul>
<h4 id="2-4-4-Firewalld其他重要必知"><a href="#2-4-4-Firewalld其他重要必知" class="headerlink" title="2.4.4 Firewalld其他重要必知"></a>2.4.4 Firewalld其他重要必知</h4><ul>
<li>Firewalld支持四种配置方法：<ul>
<li>Web控制界面</li>
<li>Firewall-config图形界面</li>
<li>Firewall-cmd命令行</li>
<li>修改xml文件</li>
</ul>
</li>
<li>FIrewalld的配置文件如下：<ul>
<li>&#x2F;usr&#x2F;lib&#x2F;firewalld：系统默认防火墙配置文件，不建议修改</li>
<li>&#x2F;etc&#x2F;firewalld：自定义的配置文件，如果该目录下没有对应的配置文件，防火墙就会使用默认的配置</li>
</ul>
</li>
<li>Firewalld分为运行态和永久态<ul>
<li>运行态（runtime）：修改规则后立刻生效，但不会保存到永久配置中，在firewalld重启后生效，建议用于规则测试</li>
<li>永久态（permanent）：配置完成后需重新加载（reload）firewalld方生效，永久配置存储在配置文件中</li>
</ul>
</li>
</ul>
<h4 id="2-4-5-Firewalld配置方法-firewall-cmd"><a href="#2-4-5-Firewalld配置方法-firewall-cmd" class="headerlink" title="2.4.5 Firewalld配置方法 - firewall-cmd"></a>2.4.5 Firewalld配置方法 - firewall-cmd</h4><ul>
<li>语法：<code>firewall-cmd [option]</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516162515658.png"></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516162613207.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516162723882.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250516162939054.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-<span class="keyword">default</span>-zone</span><br><span class="line"><span class="keyword">public</span></span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --set-<span class="keyword">default</span>-zone=home</span><br><span class="line">success</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-<span class="keyword">default</span>-zone</span><br><span class="line">home</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-active-zones</span><br><span class="line">home</span><br><span class="line">interfaces: ens3</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-services</span><br><span class="line">RH-Satellite-<span class="number">6</span> RH-Satellite-<span class="number">6</span>-capsule amanda-client amanda-k5-</span><br><span class="line">client amqp amqps……</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-zone-of-interface=ens3</span><br><span class="line">home</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-zone-of-source=<span class="number">10.0</span><span class="number">.0</span><span class="number">.101</span></span><br><span class="line">no zone</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --info-zone=home</span><br><span class="line"><span class="title function_">home</span> <span class="params">(active)</span></span><br><span class="line">target: <span class="keyword">default</span></span><br><span class="line">icmp-block-inversion: no</span><br><span class="line">interfaces: ens3</span><br><span class="line">………</span><br><span class="line"></span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --get-policies</span><br><span class="line">allow-host-ipv6</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --info-policy=allow-host-ipv6</span><br><span class="line">allow-host-ipv6 (active)</span><br><span class="line">priority: -<span class="number">15000</span></span><br><span class="line">target: CONTINUE</span><br><span class="line">ingress-zones: ANY</span><br><span class="line">egress-zones: HOST</span><br><span class="line">services:</span><br><span class="line">ports:</span><br><span class="line">protocols:</span><br><span class="line">masquerade: no</span><br><span class="line">forward-ports:</span><br><span class="line">source-ports:</span><br><span class="line">icmp-blocks:</span><br><span class="line">rich rules:</span><br><span class="line">rule family=<span class="string">&quot;ipv6&quot;</span> icmp-type name=<span class="string">&quot;neighbour-advertisement&quot;</span> accept</span><br><span class="line">rule family=<span class="string">&quot;ipv6&quot;</span> icmp-type name=<span class="string">&quot;neighbour-solicitation&quot;</span> accept</span><br><span class="line">rule family=<span class="string">&quot;ipv6&quot;</span> icmp-type name=<span class="string">&quot;router-advertisement&quot;</span> accept</span><br><span class="line">rule family=<span class="string">&quot;ipv6&quot;</span> icmp-type name=<span class="string">&quot;redirect&quot;</span> accept</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --list-all</span><br><span class="line"><span class="title function_">public</span> <span class="params">(active)</span></span><br><span class="line">target: <span class="keyword">default</span></span><br><span class="line">icmp-block-inversion: no</span><br><span class="line">interfaces: ens3</span><br><span class="line">…….</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --change-interface=ens3 --</span><br><span class="line">zone=home</span><br><span class="line">success</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --add-service=http --</span><br><span class="line">zone=<span class="keyword">public</span></span><br><span class="line">success</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --list-all | grep http</span><br><span class="line">services: dhcpv6-client http mdns ssh</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --add-port=<span class="number">8080</span>/tcp --</span><br><span class="line">zone=<span class="keyword">public</span></span><br><span class="line">success</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --list-all | grep <span class="number">8080</span></span><br><span class="line">ports: <span class="number">8080</span>/tcp</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --add-port=<span class="number">8080</span>/tcp --</span><br><span class="line">zone=<span class="keyword">public</span> --permanent</span><br><span class="line">success</span><br><span class="line">[root<span class="meta">@firewalld</span> ~]# firewall-cmd --reload</span><br><span class="line">succes</span><br></pre></td></tr></table></figure>


<h4 id="2-4-6-Firewalld配置方法-xml修改"><a href="#2-4-6-Firewalld配置方法-xml修改" class="headerlink" title="2.4.6 Firewalld配置方法 - xml修改"></a>2.4.6 Firewalld配置方法 - xml修改</h4><ul>
<li>Firewalld规则对应的xml文件存放在&#x2F;etc&#x2F;firewalld&#x2F;zones中，该目录默认为空，永久配置了的规则会自动生成对应的文件</li>
<li>对其他区域进行操作后，会自动生成对应的xml文件</li>
<li>修改xml后，需要对firewalld服务执行“–reload”配置才会生效<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@firewalld</span> zones]# ls /etc/firewalld/zones</span><br><span class="line"><span class="keyword">public</span>.xml</span><br><span class="line">[root<span class="meta">@firewalld</span> zones]# cat <span class="keyword">public</span>.xml</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;zone&gt;</span><br><span class="line">&lt;<span class="type">short</span>&gt;Public&lt;/<span class="type">short</span>&gt;</span><br><span class="line">&lt;description&gt;For use in <span class="keyword">public</span> areas. You <span class="keyword">do</span> not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt;</span><br><span class="line">&lt;service name=<span class="string">&quot;ssh&quot;</span>/&gt;</span><br><span class="line">&lt;service name=<span class="string">&quot;mdns&quot;</span>/&gt;</span><br><span class="line">&lt;service name=<span class="string">&quot;dhcpv6-client&quot;</span>/&gt;</span><br><span class="line">&lt;port port=<span class="string">&quot;8080&quot;</span> protocol=<span class="string">&quot;tcp&quot;</span>/&gt;</span><br><span class="line">&lt;forward/&gt;</span><br><span class="line">&lt;/zone&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-4-7-Firewalld富规则配置"><a href="#2-4-7-Firewalld富规则配置" class="headerlink" title="2.4.7 Firewalld富规则配置"></a>2.4.7 Firewalld富规则配置</h4><ul>
<li>Firewalld的富规则可以进行更复杂更精细的规则</li>
<li>案例一：允许192.168.1.100主机的所有流量<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd -add-rich-rule=<span class="string">&quot;rule family=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>192.168.1.100<span class="string">&quot; accept&quot;</span></span><br></pre></td></tr></table></figure>
案例二：允许192.168.1.100主机对本主机进行ping<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-rich-rule=<span class="string">&quot;rule famliy=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>192.168.1.100<span class="string">&quot; protocol value=&quot;</span>icmp<span class="string">&quot; accept&quot;</span></span><br></pre></td></tr></table></figure>
案例三：允许192.168.1.100对本主机进行ssh<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-rich-rule=<span class="string">&quot;rule family=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>192.168.1.100<span class="string">&quot; port protocol=&quot;</span>tcp<span class="string">&quot; port=22 accept&quot;</span></span><br></pre></td></tr></table></figure>
案例四：将来自192.168.1.100访问本主机80端口的流量转发至192.168.1.101的8080端口<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-rich-rule=<span class="string">&quot;rule family=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>192.168.1.100<span class="string">&quot; forward-port port=80 protocol=tcp to-port=8080 to-addr=192.168.1.101&quot;</span></span><br></pre></td></tr></table></figure>
案例五：为192.168.1.0&#x2F;24进行NAT转发<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-rich-rule=<span class="string">&quot;rule family=&quot;</span>ipv4<span class="string">&quot; source address=&quot;</span>192.168.1.0/24<span class="string">&quot; masquerade&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="0x03-SELinux强制访问控制"><a href="#0x03-SELinux强制访问控制" class="headerlink" title="0x03 SELinux强制访问控制"></a>0x03 SELinux强制访问控制</h2><h3 id="3-1-SELinux简介"><a href="#3-1-SELinux简介" class="headerlink" title="3.1 SELinux简介"></a>3.1 SELinux简介</h3><ul>
<li>自主访问控制DAC（Discretionary Access Control）基于用户、组和其他权限，决定一个资源是否能被访问的因素是某个资源是否拥有对应用户的权限，它不能使系统管理员创建全面和细粒度的安全策略。SELinux（Security-Enhanced Linux）是<strong>Linux内核的一个模块</strong>，也是<strong>Linux的一个安全子系统</strong>。SELinux的实现了强制访问控制MAC（Mandatory Access Control），每个进程和系统资源都有一个特殊的安全标签，<strong>资源能否被访问</strong>除了DAC规定的原则外，还需要判断<strong>每一类进程是否拥有对某一类资源的访问权限</strong></li>
<li>openEuler默认使用SELinux提升系统安全性。SELinux分为三种模式：<ul>
<li>Permissive：SELinux仅打印告警而不强制执行</li>
<li>Enforcing：SELinux安全策略被强制执行</li>
<li>Disabled：不加载SELinux安全策略</li>
</ul>
</li>
</ul>
<h3 id="3-2-SELinux模式的查看及转换"><a href="#3-2-SELinux模式的查看及转换" class="headerlink" title="3.2 SELinux模式的查看及转换"></a>3.2 SELinux模式的查看及转换</h3><ul>
<li>查看当前SELinux的模式使用命令getenforce<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br></pre></td></tr></table></figure></li>
<li>临时修改SELinux模式命令为setenforce，0表示切换为permissive，1表示切换为enforce<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@first</span>-day-<span class="number">01</span> ~]# setenforce <span class="number">0</span></span><br><span class="line">[root<span class="meta">@first</span>-day-<span class="number">01</span> ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line">[root<span class="meta">@first</span>-day-<span class="number">01</span> ~]# setenforce <span class="number">1</span></span><br><span class="line">[root<span class="meta">@first</span>-day-<span class="number">01</span> ~]# getenforce</span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure></li>
<li>永久修改SELinux模式需修改配置文件&#x2F;etc&#x2F;selinux&#x2F;config，并需在修改后重启才能生效<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment"># enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment"># permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment"># disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=enforcing</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-3-SELinux的安全上下文"><a href="#3-3-SELinux的安全上下文" class="headerlink" title="3.3 SELinux的安全上下文"></a>3.3 SELinux的安全上下文</h3><ul>
<li>在SELinux视角下，所有文件、端口及进程都是具备安全标签，这类标签被称为安全上下文</li>
<li>安全上下文有五个元素组成，分别是user:role:type:sensitivity:category<ul>
<li>User表示登录系统的用户类型</li>
<li>Role用于定义文件、端口及进程的用途</li>
<li>Type用于定义数据类型</li>
<li>Sensitivity用于定义安全级别</li>
<li>Category用于区分特定组织</li>
</ul>
</li>
<li>当SELinux策略为targeted时，仅需关注type即可</li>
</ul>
<h4 id="3-3-1-SELinux的安全上下文查看"><a href="#3-3-1-SELinux的安全上下文查看" class="headerlink" title="3.3.1 SELinux的安全上下文查看"></a>3.3.1 SELinux的安全上下文查看</h4><ul>
<li>SELinux的安全上下文可分为实际上下文和默认上下文，实际上下文不存放在文件系统中，默认上下文存放在二进制的SELinux策略库中</li>
<li>实际上下文使用”-Z”选项查看</li>
<li>查看进程的实际安全上下文<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps axZ</span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250517021846759.png"></li>
<li>查看文件的实际安全上下文<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -Z /etc/ssh</span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250517021921527.png"></li>
<li>查看端口的实际安全上下文<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -lnpZ|grep 22</span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250517022014301.png"></li>
<li>查看默认上下文使用命令semanage命令<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semanage fcontext -l|grep www</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-3-2-SELinux中文件的安全上下文管理"><a href="#3-3-2-SELinux中文件的安全上下文管理" class="headerlink" title="3.3.2 SELinux中文件的安全上下文管理"></a>3.3.2 SELinux中文件的安全上下文管理</h4><ul>
<li>命令<code>chcon</code>用于修改文件的实际安全上下文，命令语法为：<code>chcon -t TYPE file/directory</code>，TYPE为具体的上下文，file为指定的文件，directory为指定的目录</li>
<li>命令<code>semanage fcontext</code> 用于修改文件的默认安全上下文 ，命令语法为： <code>semanage fcontext -option file/directory</code>，常用选项有：<ul>
<li>-a：添加安全上下文</li>
<li>-d：删除安全上下文</li>
<li>-t：指定文件的上下文类型</li>
<li>-l：列出文件的安全上下文</li>
</ul>
</li>
<li>命令<code>restorecon</code>用于还原默认，命令语法为：<code>restorecon -option file/directory</code>，常用的选项有：<ul>
<li>-v：查看详细信息</li>
<li>-R：递归修改目录</li>
</ul>
</li>
<li>SELinux可通过标记网络端口来控制网络流量，当进程希望监听某个端口时，SELinux将检查是否允许该进程相关的标签绑定该端口标签</li>
<li>如果在非标准端口上运行某个服务，SELinux会对服务进行拦截，需修改该端口的安全上下文，使其和服务的进程进行匹配</li>
<li>修改端口的安全上下文命令为semanage port，命令语法为：<code>semanage port -option port</code>，常用选项有：<ul>
<li>-a：添加安全上下文</li>
<li>-d：删除安全上下文</li>
<li>-t：指定文件的上下文类型</li>
<li>-l：列出文件的安全上下文</li>
</ul>
</li>
</ul>
<h4 id="3-3-3-SELinux的布尔值"><a href="#3-3-3-SELinux的布尔值" class="headerlink" title="3.3.3 SELinux的布尔值"></a>3.3.3 SELinux的布尔值</h4><ul>
<li>SELinux布尔值用于更改SELinux策略行为，它可以启用或禁用规则来有效的调整SELinux策略</li>
<li>将SELinix布尔值设置为on，表示开启对应的SELinux规则，设置为off，则表示禁用对应的规则</li>
<li>使用以下命令进行SELinux布尔值的相关操作：<ul>
<li><code>semanage boolean -l</code>用于查看所有的SELinux布尔值</li>
<li><code>getsebool -a</code>用于查看当前所有生效的布尔值</li>
<li><code>setsebool -P rule on/off</code>用于设置布尔值的启用或禁用，其中rule表示对应的规则</li>
</ul>
</li>
</ul>
<h3 id="3-4-SELinux日志服务"><a href="#3-4-SELinux日志服务" class="headerlink" title="3.4 SELinux日志服务"></a>3.4 SELinux日志服务</h3><ul>
<li>SELinux默认使用<code>auditd</code>服务来记录拒绝的信息<ul>
<li>日志路径：<code>/var/log/audidt/audit.log</code></li>
</ul>
</li>
<li>文件类型不正确是SELinux拒绝访问的常见原因，例如以下关于Apache HTTP服务器的拒绝消息，示例代码是参考书给的代码，截图是之前访问被拒绝百思不得其解查了httpd的日志没查到的，在SELinux中查到了</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/file-20250517023632215.png"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type=AVC msg=audit(1684289873.780:191): avc: denied &#123; getattr &#125; for pid=1958 comm=&quot;httpd&quot; path=&quot;/mywebsite/index.html&quot;dev=&quot;sda2&quot; ino=1048579 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:default_t:s0 tclass=file permissive=0</span><br></pre></td></tr></table></figure></li>
<li><code>avc: denied &#123; getattr &#125;</code> ：拒绝的权限，源进程正在尝试读取目标文件的状态信息</li>
<li><code>pid=1958 comm=&quot;httpd&quot;</code>：进程的名称和ID</li>
<li><code>path=&quot;/mywebsite/index.html&quot;</code>：进程试图访问的对象</li>
<li><code>scontext=system_u:system_r:httpd_t:s0</code>：拒绝操作的进程上下文</li>
<li><code>tcontext=unconfined_u:object_r:default_t:s0</code>：进程访问对象的上下文</li>
<li><code>permissive=0</code>：SELinux当前模式</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XBCID</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/')">06 openEuler操作系统安全加固</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=06 openEuler操作系统安全加固&amp;url=http://example.com/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">XBCID's BLOG</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">18</span></a><a class="post-meta__box__tags" href="/tags/openEuler/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>openEuler<span class="tagsPageCount">18</span></a><a class="post-meta__box__tags" href="/tags/Huawei/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Huawei<span class="tagsPageCount">15</span></a><a class="post-meta__box__tags" href="/tags/HCIP/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>HCIP<span class="tagsPageCount">6</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/06/openEuler/%E7%AC%94%E8%AE%B0/IP/05%20shell%E8%84%9A%E6%9C%AC%E8%BF%9B%E9%98%B6/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">05 shell脚本进阶</div></div></a></div><div class="next-post pull-right"><a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IP/03%20openEuler%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">03 openEuler存储管理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IP/01%20openEuler%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" title="01 openEuler操作系统入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-14</div><div class="title">01 openEuler操作系统入门</div></div></a></div><div><a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IP/03%20openEuler%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" title="03 openEuler存储管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-19</div><div class="title">03 openEuler存储管理</div></div></a></div><div><a href="/2025/03/06/openEuler/%E7%AC%94%E8%AE%B0/IP/05%20shell%E8%84%9A%E6%9C%AC%E8%BF%9B%E9%98%B6/" title="05 shell脚本进阶"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-06</div><div class="title">05 shell脚本进阶</div></div></a></div><div><a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IP/04%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/" title="04 自动化管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-14</div><div class="title">04 自动化管理</div></div></a></div><div><a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IA/01%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8/" title="01 openEuler操作系统入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-14</div><div class="title">01 openEuler操作系统入门</div></div></a></div><div><a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IA/02%20%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C%E5%9F%BA%E7%A1%80/" title="02 命令行操作基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-14</div><div class="title">02 命令行操作基础</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA"><span class="toc-number">1.</span> <span class="toc-text">0x01 操作系统安全加固</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A2%E4%B8%B4%E7%9A%84%E4%B8%BB%E8%A6%81%E5%A8%81%E8%83%81"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 操作系统面临的主要威胁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AF%B9%E4%BA%8E%E5%AE%89%E5%85%A8%E7%9A%84%E8%A6%81%E6%B1%82"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 操作系统对于安全的要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 安全加固概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E7%AE%80%E4%BB%8B"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 内核参数简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%B7%A5%E5%85%B7-systcl"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 内核参数配置工具 - systcl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E5%8A%A0%E5%9B%BA%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 内核参数加固策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.</span> <span class="toc-text">1.7 授权认证系统加固方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-1-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81-%E7%BD%91%E7%BB%9C%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E7%9A%84%E8%AD%A6%E5%91%8A%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.1.</span> <span class="toc-text">1.7.1 授权认证 - 网络远程登录的警告信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-2-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81-%E9%80%9A%E8%BF%87%E2%80%9DCtrl-Alt-Del%E2%80%9D%E9%87%8D%E5%90%AF%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.2.</span> <span class="toc-text">1.7.2 授权认证 - 通过”Ctrl+Alt+Del”重启系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-3-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81-%E7%BB%88%E7%AB%AF%E7%9A%84%E8%87%AA%E5%8A%A8%E9%80%80%E5%87%BA%E6%97%B6%E9%97%B4"><span class="toc-number">1.7.3.</span> <span class="toc-text">1.7.3 授权认证  - 终端的自动退出时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-4-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81-%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E7%9A%84%E9%BB%98%E8%AE%A4umask%E5%80%BC%E4%B8%BA077"><span class="toc-number">1.7.4.</span> <span class="toc-text">1.7.4 授权认证 - 设置用户的默认umask值为077</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-5-%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81-GRUB2%E5%8A%A0%E5%AF%86%E5%8F%A3%E4%BB%A4"><span class="toc-number">1.7.5.</span> <span class="toc-text">1.7.5 授权认证 - GRUB2加密口令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7-6-%E5%85%B6%E4%BB%96%E6%8E%88%E6%9D%83%E8%AE%A4%E8%AF%81%E5%8A%A0%E5%9B%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.6.</span> <span class="toc-text">1.7.6 其他授权认证加固方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E5%8D%95%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%E4%B8%8B%E9%87%8D%E7%BD%AEroot%E5%AF%86%E7%A0%81"><span class="toc-number">1.8.</span> <span class="toc-text">1.8 单用户模式下重置root密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-%E8%B4%A6%E6%88%B7%E5%8F%A3%E4%BB%A4%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.</span> <span class="toc-text">1.9 账户口令系统加固方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-9-1-%E5%B1%8F%E8%94%BD%E7%B3%BB%E7%BB%9F%E8%B4%A6%E6%88%B7%E5%92%8C%E9%99%90%E5%88%B6%E4%BD%BF%E7%94%A8su%E5%91%BD%E4%BB%A4%E7%9A%84%E5%B8%90%E6%88%B7"><span class="toc-number">1.9.1.</span> <span class="toc-text">1.9.1 屏蔽系统账户和限制使用su命令的帐户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-9-2-%E8%B4%A6%E6%88%B7%E5%8F%A3%E4%BB%A4%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">1.9.2.</span> <span class="toc-text">1.9.2 账户口令复杂度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-9-2-1-%E5%B8%90%E6%88%B7%E5%8F%A3%E4%BB%A4%E5%A4%8D%E6%9D%82%E5%BA%A6%E6%A1%88%E4%BE%8B"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">1.9.2.1 帐户口令复杂度案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-9-3-%E5%B8%90%E6%88%B7%E5%8F%A3%E4%BB%A4%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-number">1.9.3.</span> <span class="toc-text">1.9.3 帐户口令有效期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-9-4-%E8%B4%A6%E6%88%B7%E5%8F%A3%E4%BB%A4%E7%9A%84%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">1.9.4.</span> <span class="toc-text">1.9.4 账户口令的加密算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-9-5-%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E8%B6%85%E8%BF%87%E4%B8%89%E6%AC%A1%E5%90%8E%E9%94%81%E5%AE%9A"><span class="toc-number">1.9.5.</span> <span class="toc-text">1.9.5 登录失败超过三次后锁定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-10-%E6%96%87%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%9D%83%E9%99%90"><span class="toc-number">1.10.</span> <span class="toc-text">1.10 文件的基本权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-11-%E5%8A%A0%E5%9B%BAsu%E5%91%BD%E4%BB%A4"><span class="toc-number">1.11.</span> <span class="toc-text">1.11 加固su命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-12-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA%E6%96%B9%E6%A1%88"><span class="toc-number">1.12.</span> <span class="toc-text">1.12 文件权限系统加固方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-1-%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90%E5%92%8C%E5%B1%9E%E4%B8%BB"><span class="toc-number">1.12.1.</span> <span class="toc-text">1.12.1 设置文件的权限和属主</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-2-%E5%88%A0%E9%99%A4%E6%97%A0%E4%B8%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.12.2.</span> <span class="toc-text">1.12.2 删除无主文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-3-%E5%A4%84%E7%90%86%E7%A9%BA%E9%93%BE%E6%8E%A5%E6%96%87%E4%BB%B6"><span class="toc-number">1.12.3.</span> <span class="toc-text">1.12.3 处理空链接文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-4-%E8%AE%BE%E7%BD%AE%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84umask%E5%80%BC"><span class="toc-number">1.12.4.</span> <span class="toc-text">1.12.4 设置守护进程的umask值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-5-%E4%B8%BA%E5%85%A8%E5%B1%80%E5%8F%AF%E5%86%99%E7%9B%AE%E5%BD%95%E6%B7%BB%E5%8A%A0%E7%B2%98%E6%BB%9E%E4%BD%8D%E5%B1%9E%E6%80%A7"><span class="toc-number">1.12.5.</span> <span class="toc-text">1.12.5 为全局可写目录添加粘滞位属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-6-%E5%88%A0%E9%99%A4%E9%9D%9E%E6%8E%88%E6%9D%83%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%A8%E5%B1%80%E5%8F%AF%E5%86%99%E5%B1%9E%E6%80%A7"><span class="toc-number">1.12.6.</span> <span class="toc-text">1.12.6 删除非授权文件的全局可写属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-7-%E9%99%90%E5%88%B6at%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%E6%9D%83%E9%99%90"><span class="toc-number">1.12.7.</span> <span class="toc-text">1.12.7 限制at命令的使用权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-8-%E9%99%90%E5%88%B6cron%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%E6%9D%83%E9%99%90"><span class="toc-number">1.12.8.</span> <span class="toc-text">1.12.8 限制cron命令的使用权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-9-%E9%99%90%E5%88%B6sudo%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%E6%9D%83%E9%99%90"><span class="toc-number">1.12.9.</span> <span class="toc-text">1.12.9 限制sudo命令的使用权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-13-%E5%8A%A0%E5%9B%BASSH%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.13.</span> <span class="toc-text">1.13 加固SSH服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8"><span class="toc-number">2.</span> <span class="toc-text">0x02 操作系统网络安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 操作系统网络安全概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Netfilter%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Netfilter介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-Netfilter%E7%94%9F%E6%80%81%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 Netfilter生态工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-Netfilter%E7%AE%80%E4%BB%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 Netfilter简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-Netfilter%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 Netfilter原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E6%95%B0%E6%8D%AE%E5%8C%85%E8%BF%87%E6%BB%A4%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 数据包过滤流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Iptables%E8%AF%A6%E8%BF%B0"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Iptables详述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-Iptables%E7%9A%84%E8%A1%A8%E3%80%81%E9%93%BE%E5%92%8C%E8%A7%84%E5%88%99"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 Iptables的表、链和规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-Iptables%E4%B8%AD%E7%9A%84%E4%BA%94%E8%A1%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 Iptables中的五表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-Iptables%E4%B8%AD%E7%9A%84%E4%BA%94%E9%93%BE"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 Iptables中的五链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-Iptables%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 Iptables工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-5-Iptables%E7%9A%84%E8%A1%A8%E9%93%BE%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.5.</span> <span class="toc-text">2.3.5 Iptables的表链关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-6-Iptables%E4%B8%AD%E7%9A%84%E8%BF%9E%E6%8E%A5%E8%BF%BD%E8%B8%AA%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.6.</span> <span class="toc-text">2.3.6 Iptables中的连接追踪机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-7-Iptables%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.7.</span> <span class="toc-text">2.3.7 Iptables中的会话机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-8-Iptables%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="toc-number">2.3.8.</span> <span class="toc-text">2.3.8 Iptables语法规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-8-1-COMMAND"><span class="toc-number">2.3.8.1.</span> <span class="toc-text">2.3.8.1 COMMAND</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-8-2-MATCH"><span class="toc-number">2.3.8.2.</span> <span class="toc-text">2.3.8.2 MATCH</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-8-3-Targets-Jumps"><span class="toc-number">2.3.8.3.</span> <span class="toc-text">2.3.8.3 Targets&#x2F;Jumps</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-9-Iptables%E8%A7%84%E5%88%99%E9%9B%86%E7%9A%84%E4%BF%9D%E5%AD%98%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">2.3.9.</span> <span class="toc-text">2.3.9 Iptables规则集的保存与恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-10-Iptables%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.3.10.</span> <span class="toc-text">2.3.10 Iptables配置案例 - 访问控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-11-Iptables%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B-NAT%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.11.</span> <span class="toc-text">2.3.11 Iptables配置案例 - NAT地址转换</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Firewalld%E8%AF%A6%E8%BF%B0"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Firewalld详述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-Firewalld%E6%9E%B6%E6%9E%84%E7%AE%80%E8%BF%B0"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 Firewalld架构简述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-Firewalld%E7%AD%96%E7%95%A5"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 Firewalld策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-Firewalld%E5%8C%BA%E5%9F%9F%E6%A6%82%E5%BF%B5"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 Firewalld区域概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-Firewalld%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E5%BF%85%E7%9F%A5"><span class="toc-number">2.4.4.</span> <span class="toc-text">2.4.4 Firewalld其他重要必知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-5-Firewalld%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-firewall-cmd"><span class="toc-number">2.4.5.</span> <span class="toc-text">2.4.5 Firewalld配置方法 - firewall-cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-6-Firewalld%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95-xml%E4%BF%AE%E6%94%B9"><span class="toc-number">2.4.6.</span> <span class="toc-text">2.4.6 Firewalld配置方法 - xml修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-7-Firewalld%E5%AF%8C%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.7.</span> <span class="toc-text">2.4.7 Firewalld富规则配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-SELinux%E5%BC%BA%E5%88%B6%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">0x03 SELinux强制访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-SELinux%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 SELinux简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-SELinux%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9F%A5%E7%9C%8B%E5%8F%8A%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 SELinux模式的查看及转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SELinux%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 SELinux的安全上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-SELinux%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E6%9F%A5%E7%9C%8B"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 SELinux的安全上下文查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-SELinux%E4%B8%AD%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 SELinux中文件的安全上下文管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-SELinux%E7%9A%84%E5%B8%83%E5%B0%94%E5%80%BC"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 SELinux的布尔值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-SELinux%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 SELinux日志服务</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IP/07%20openEuler%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7%E5%85%A5%E9%97%A8/" title="无题">无题</a><time datetime="2025-05-18T19:46:45.900Z" title="发表于 2025-05-19 03:46:45">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/%E6%B3%A8%E9%87%8A/shebang/" title="无题">无题</a><time datetime="2025-05-18T19:46:45.880Z" title="发表于 2025-05-19 03:46:45">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/10%20%E5%B8%B8%E7%94%A8%E5%B0%8F%E6%8C%87%E4%BB%A4/" title="无题">无题</a><time datetime="2025-05-18T19:46:45.685Z" title="发表于 2025-05-19 03:46:45">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/09%20Samba%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86/" title="09 Samba文件共享服务器管理">09 Samba文件共享服务器管理</a><time datetime="2025-05-18T19:46:45.684Z" title="发表于 2025-05-19 03:46:45">2025-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/08%20%E4%BD%BF%E7%94%A8shell%E8%84%9A%E6%9C%AC/" title="08 使用shell脚本">08 使用shell脚本</a><time datetime="2025-05-18T19:46:45.683Z" title="发表于 2025-05-19 03:46:45">2025-05-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="XBCID" target="_blank">XBCID</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/HCIA/" style="font-size: 0.88rem;">HCIA<sup>9</sup></a><a href="/tags/HCIP/" style="font-size: 0.88rem;">HCIP<sup>6</sup></a><a href="/tags/Huawei/" style="font-size: 0.88rem;">Huawei<sup>15</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>18</sup></a><a href="/tags/openEuler/" style="font-size: 0.88rem;">openEuler<sup>18</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("01/12/2021 14:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XBCID 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>