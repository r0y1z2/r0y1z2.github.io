<!--
	作者：Sariay
	时间：2018-08-26
	描述：There may be a bug, but don't worry, Qiling(器灵) says that it can work normally! aha!
-->
<!DOCTYPE html>
<html class="html-loading">
		

<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <title>
    
      04 自动化管理 | XBCID&#39;s BLOG
    
  </title>
  <meta name="author" content="XBCID">
  <meta name="keywords" content="" />
  <meta name="description" content="" />
	<!-- favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico">

  <!-- css -->
  
<link rel="stylesheet" href="/css/Annie.css">

  
  <!-- jquery -->
	
<script src="/plugin/jquery/jquery.min.js"></script>


<script>
    const CONFIG_BGIMAGE = {
      mode: 'normal',
      normalSrc: '/img/header-bg.jpg',
      randomYouMax: 110,
      randomYouSrc: 'https://sariay.github.io/Random-img/',
	  randomOtherSrc: 'https://api.berryapi.net/?service=App.Bing.Images&day=-0',
	  preloaderEnable: true
    }
	
    const CONFIG_LEACLOUD_COUNT = {
      enable: false,
	  appId: 'AU8...',
	  appKey: '4cU...',
	  serverURLs: 'http' || ' '
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>
	<body>
		<!-- Preloader -->

	<div id="preloader">
		<div class="pre-container">
			
				<div class="spinner">
					<div class="double-bounce1"></div>
					<div class="double-bounce2"></div>
				</div>
						
		</div>
	</div>


<!-- header -->
<header class="fixbackground bg-pan-br">
	<div class="mask">
		<!-- motto -->
		<div class="h-body">	
			
				<div class="motto text-shadow-pop-left">
					<p class="content" id="motto-content">获取中...</p>
					<p>-<p>
					<p class="author" id="motto-author">Just a minute...</p>
				</div>
			
		</div>
		
		<!-- others: such as time... -->			
		<div class="h-footer">
			<a href="javascript:;" id="read-more" class="scroll-down">
				<span class="icon-anchor1 animation-scroll-down"></span>
			</a>
		</div>
	</div>
</header>

<div id="navigation-hide">
	<!-- Progress bar -->
	<div id="progress-bar"></div>

	<!-- Progress percent -->
	<div id="progress-percentage"><span>0.0%</span></div>

	<div class="toc-switch"><span class="switch-button">目录</span></div>

	<!-- Page title -->
	<p>
		
			「04 自动化管理」
		
	</p>

	
	

	<!-- Nav trigger for navigation-H-->
	<a class="nav-trigger"><span></span></a>
</div>

<!-- Navigation in div(id="navigation-H") -->
<nav class="nav-container" id="cd-nav">
	<div class="nav-header">
		<span class="logo"> 
			<img src="/img/logo.png">
		</span>
		<a href="javascript:;" class="nav-close"></a>
	</div>
	
	<div class="nav-body">
		<ul id="global-nav">
	
		<li class="menu-home">
			<a href="/" class="menu-item-home" target="_blank">主页</a>
		</li>
		
	
		<li class="menu-archive">
			<a href="/archives" class="menu-item-archive" target="_blank">归档</a>
		</li>
		
	
		<li class="menu-categories">
			<a href="/categories" class="menu-item-categories" target="_blank">分类</a>
		</li>
		
	
		<li class="menu-tags">
			<a href="/tags" class="menu-item-tags" target="_blank">标签</a>
		</li>
		
	
		<li class="menu-about">
			<a href="/about" class="menu-item-about" target="_blank">关于</a>
		</li>
		
	
		<li class="menu-gallery">
			<a href="/gallery" class="menu-item-gallery" target="_blank">相册</a>
		</li>
		
	

	
</ul>
	</div>
	
	<div class="nav-footer">
		<ul id="global-social">
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-one"><span class="path1"></span><span class="path2"></span></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-zhihu"></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-github"></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-sina-weibo "></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-pinterest2"></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-instagram"></span>
			</a>
		</li>
	
		<li>
			<a href="http://github.com/" target="_blank">
				<span class="icon-twitter"></span>
			</a>
		</li>
	
		<li>
			<a href="/atom.xml" target="_blank">
				<span class="icon-rss"></span>
			</a>
		</li>
			
</ul>

	</div>
</nav>
			
		<!--main-->
		<main>
			<!--
	时间：2018-11-17
	描述：
		插件名称：katelog.min.js
		插件作者：KELEN
		插件来源: https://github.com/KELEN/katelog
-->

	
		<div class="layout-toc">
			<div id="layout-toc">
				<div class="k-catelog-list" id="catelog-list" data-title="文章目录"></div>
			</div>
		</div>

		
<script src="/plugin/toc/katelog.min.js"></script>


		
	 

<div class="layout-post">
	<div id="layout-post">
		<div class="article-title">
			
	<a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IP/04%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/" itemprop="url">
		04 自动化管理
	</a>

		</div>

		<div class="article-meta">
			<span>
				<i class="icon-calendar1"></i>
				
				




	更新于

	<a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IP/04%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/" itemprop="url">
		<time datetime="2025-02-14T09:22:46.000Z" itemprop="dateUpdated">
	  		2025-05-19
	  </time>
	</a> 



			</span>
			<span>
				
	<i class="icon-price-tags"></i>
	
		<a href="/tags/Linux/" class=" ">
			Linux
		</a>
	
		<a href="/tags/openEuler/" class=" ">
			openEuler
		</a>
	
		<a href="/tags/HCIP/" class=" ">
			HCIP
		</a>
	
		<a href="/tags/Huawei/" class=" ">
			Huawei
		</a>
	
		
			</span>
			
			



		</div>

		<div class="article-content" id="article-content">
			<ul>
<li>在大量服务器同时上线及维护的场景中，人工手动对业务进行部署和上线已经不再适用，因此，自动化运维成为了每个工程师必备的技能，本章将介绍最主流的两款自动化运维工具——Ansible和SaltStack。</li>
</ul>
<p><strong>目标</strong></p>
<ul>
<li>学完本课程后，您将能够：<ul>
<li>掌握Ansible常用功能模块的使用</li>
<li>掌握Ansible playbook的开发</li>
<li>掌握SaltStack远程管理功能</li>
<li>掌握SaltStack配置管理功能</li>
</ul>
</li>
</ul>
<h2 id="0x01-自动化运维简介"><a href="#0x01-自动化运维简介" class="headerlink" title="0x01 自动化运维简介"></a>0x01 自动化运维简介</h2><p>应用从开发到上线，需运维的对象剧增<br><img src="/file-20250510174947717.png"></p>
<h3 id="1-1-自动化运维的优势"><a href="#1-1-自动化运维的优势" class="headerlink" title="1.1 自动化运维的优势"></a>1.1 自动化运维的优势</h3><p><img src="/file-20250510175035085.png"></p>
<h3 id="1-2-自动化运维场景"><a href="#1-2-自动化运维场景" class="headerlink" title="1.2 自动化运维场景"></a>1.2 自动化运维场景</h3><ul>
<li>应用部署</li>
<li>文件传输</li>
<li>配置管理</li>
<li>任务流编排</li>
</ul>
<h3 id="1-3-常见自动化运维工具"><a href="#1-3-常见自动化运维工具" class="headerlink" title="1.3 常见自动化运维工具"></a>1.3 常见自动化运维工具</h3><ul>
<li>Ansible<ul>
<li>基于python开发，无需部署代理，基于SSH实现客户端管理，适用于中小型环境</li>
</ul>
</li>
<li>SaltStack<ul>
<li>基于python开发，需要在客户端部署代理，因此执行效率较高</li>
</ul>
</li>
<li>一般情况上，Ansible在少于1000台服务器的场景中使用，超过1000台的服务器场景建议使用SaltStack</li>
</ul>
<h2 id="0x02-Ansible"><a href="#0x02-Ansible" class="headerlink" title="0x02. Ansible"></a>0x02. Ansible</h2><p>Ansible权威中文站 <a target="_blank" rel="noopener" href="http://www.ansible.com.cn/docs/modules_core.html">http://www.ansible.com.cn/docs/modules_core.html</a></p>
<h3 id="2-1-Ansible简介及基本操作"><a href="#2-1-Ansible简介及基本操作" class="headerlink" title="2.1 Ansible简介及基本操作"></a>2.1 Ansible简介及基本操作</h3><h4 id="2-1-1-概要"><a href="#2-1-1-概要" class="headerlink" title="2.1.1 概要"></a>2.1.1 概要</h4><ul>
<li>Ansible自动化平台可提供一个企业框架，用于从混合云到边缘大规模构建和运维IT自动化。Ansible自动化平台使整个企业的用户（从开发、运维到安全和网络团队）能够创建、共享和管理自动化</li>
<li>Ansible由Michael DeHaan开发，与2012年发布，并于2015年被红帽收购</li>
<li>Paramike、PyYAML、Jinja2是Ansible实现自动化运维的三个关键模块</li>
</ul>
<h4 id="2-1-2-Ansible的功能和优势"><a href="#2-1-2-Ansible的功能和优势" class="headerlink" title="2.1.2 Ansible的功能和优势"></a>2.1.2 Ansible的功能和优势</h4><ul>
<li>自动化执行环境<ul>
<li>自动化执行环境是用于执行Ansible Playbook和角色的容器镜像。自动化执行环境提供了一种确定、一致和可移植的方式，在开发和生产之间构建和分发您的自动化环境</li>
</ul>
</li>
<li>实现自动化的标准化和规模化<ul>
<li>标准化部署、启动、授权和审核的自动化方式。自动化控制器允许用户在企业中定义、操作和扩展自动化。用户可通过集中式用户界面和REST API来完成管理清单、启动和调度工作流、跟踪更改，以及整合成报告等一系列工作。现在，自动化控制器带有自动化拓扑查看器功能，可以跨多个站点以图形方式可视化最复杂的自动化拓扑，包括跳跃、执行、混合和控制节点</li>
</ul>
</li>
<li>自动化网格<ul>
<li>自动化网格提供了一种简单、灵活且可靠的方法，以跨越多种网络拓扑、平台和区域扩展大型库存的自动化。自动化网格提供灵活的设计选项，以构建弹性和容错架构，同时增强安全性，从而从核心数据中心到边缘标准化和规范化整个 IT 资产的自动化</li>
</ul>
</li>
</ul>
<h4 id="2-1-3-Ansible功能组件和架构"><a href="#2-1-3-Ansible功能组件和架构" class="headerlink" title="2.1.3 Ansible功能组件和架构"></a>2.1.3 Ansible功能组件和架构</h4><p><img src="/file-20250510192342529.png"></p>
<ul>
<li>Ansible的管理对象是可以是linux的主机，也可以是windows的主机，或者是各种网络设备</li>
<li>Inventory是Ansible管理对象的清单，加入Inventory的对象才能被Ansible管理到</li>
<li>Ansible内置了很多功能模块供管理员使用，也可以自定义新的功能模块</li>
<li>管理员可直接通过Ansible命令行对被管理对象进行操作</li>
<li>Playbook是Ansible的核心功能之一，管理员可以将Ansible的任务写成yaml格式的文件，然后由其自动执行</li>
</ul>
<h4 id="2-1-4-Ansible的安装方式"><a href="#2-1-4-Ansible的安装方式" class="headerlink" title="2.1.4 Ansible的安装方式"></a>2.1.4 Ansible的安装方式</h4><ul>
<li>yum安装<ul>
<li><code>yum install -y ansible</code></li>
</ul>
</li>
<li>源码编译安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y phthon-jinja2 PyYAML python-paramiko python-babel python-crypto</span><br><span class="line">tar –xzvf ansible-xxxxx.tar.gz</span><br><span class="line">cd ansibel-xxxx</span><br><span class="line">python setup.py build</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></li>
<li>git方式安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/ansible/ansible/git --recusive</span><br><span class="line">cd ./ansible</span><br><span class="line">source ./hacking/env-setup</span><br></pre></td></tr></table></figure></li>
<li>pip安装<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ansible --upgrade</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-1-5-Ansible配置文件重要配置项说明"><a href="#2-1-5-Ansible配置文件重要配置项说明" class="headerlink" title="2.1.5 Ansible配置文件重要配置项说明"></a>2.1.5 Ansible配置文件重要配置项说明</h4><p>Ansible的配置文件默认位于&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span>defaults<span class="punctuation">]</span></span><br><span class="line"># some basic default values...</span><br><span class="line">#inventory = /etc/ansible/hosts             ##主机列表配置文件，用于添加被管理对象</span><br><span class="line">#library = /usr/share/my_modules/           ##ansible库文件存放目录</span><br><span class="line">#module_utils = /usr/share/my_module_utils/ ##ansible模块文件存放目录</span><br><span class="line">#remote_tmp = ~/.ansible/tmp                ##指定临时命令在远程主机存放的路径</span><br><span class="line">#local_tmp = ~/.ansible/tmp                 ##指定临时命令在本地存放的路径</span><br><span class="line">#plugin_filters_cfg = /etc/ansible/plugin_filters.yml ##插件相关配置</span><br><span class="line">#forks = <span class="number">5</span>                                  ##并发数，默认为<span class="number">5</span>，可根据控制器性能修改</span><br><span class="line">#poll_interval = <span class="number">15</span>                         ##时间间隔，默认问<span class="number">15</span>秒</span><br><span class="line">#sudo_user = root                           ##默认提权用户</span><br><span class="line">#ask_sudo_pass = True                       ##执行ansible命令时是否询问提权密码，                                                建议修改为False</span><br><span class="line">#ask_pass = True                            ##执行ansible命令时是否询问ssh密码                                                   建议修改为False</span><br><span class="line">#transport = smart                          ##命令传输方式</span><br><span class="line">#remote_port = <span class="number">22</span>                           ##连接被控制对象的端口号</span><br><span class="line">host_key_checking = False                   ##是否校验SSH key，建议设置为False</span><br></pre></td></tr></table></figure>

<h5 id="2-1-5-1-Ansible主机清单配置文件"><a href="#2-1-5-1-Ansible主机清单配置文件" class="headerlink" title="2.1.5.1 Ansible主机清单配置文件"></a>2.1.5.1 Ansible主机清单配置文件</h5><ul>
<li>Ansible主机清单有多种书写方式，官方提供了三种案例</li>
<li>未分组的主机，可直接放置到hosts文件中<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ex 1: Ungrouped hosts, specify before any group headers.</span></span><br><span class="line">green.example.com</span><br><span class="line">blue.example.com</span><br><span class="line">192.168.100.1</span><br><span class="line">192.168.100.10</span><br></pre></td></tr></table></figure></li>
<li>分组的主机以组名作为标签，后面跟随主机信息<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Ex 2: A collection of hosts belonging to the &#x27;webservers&#x27; group</span></span><br><span class="line">[webservers]</span><br><span class="line">alpha.example.org</span><br><span class="line">beta.example.org</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.110</span><br></pre></td></tr></table></figure></li>
<li>如果同组下的主机遵循某个规律，也可以直接合并成一条<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Ex 3: A collection of database servers in the &#x27;dbservers&#x27; group</span></span><br><span class="line">[dbserver]</span><br><span class="line">db-[99:101]-node.example.com</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-1-6-Ansible常用命令"><a href="#2-1-6-Ansible常用命令" class="headerlink" title="2.1.6 Ansible常用命令"></a>2.1.6 Ansible常用命令</h4><ul>
<li><code>ansible</code><ul>
<li>主命令，是管理员临时命令的执行工具</li>
</ul>
</li>
<li><code>ansible-doc</code><ul>
<li>用于查看配置文档</li>
</ul>
</li>
<li><code>ansible-playbook</code><ul>
<li>用于编排playbook的工具，可定制自动化任务</li>
</ul>
</li>
<li><code>ansible-pull</code><ul>
<li>用于远程执行命令</li>
</ul>
</li>
<li><code>ansible-vault</code><ul>
<li>用于文件加密</li>
</ul>
</li>
<li><code>ansible-console</code><ul>
<li>基于Console界面的交互式命令执行工具</li>
</ul>
</li>
</ul>
<h4 id="2-1-7-Ansible的基本用法"><a href="#2-1-7-Ansible的基本用法" class="headerlink" title="2.1.7 Ansible的基本用法"></a>2.1.7 Ansible的基本用法</h4><ul>
<li><p>Ansible的基本语法格式：<br><code>ansible &lt;host-pattern&gt; [-m module_name] [-a args]</code></p>
</li>
<li><p>Ansible的常用参数：</p>
<ul>
<li>-v 显示执行过程，-vv和-vvv显示更详细的执行过程</li>
<li>–list-hosts 显示主机列表，可简写为–list</li>
<li>-k 交互方式输入ssh密码</li>
<li>-C 仅检查，不执行</li>
<li>-T 设置命令的超时时间</li>
<li>-u 设置执行远程命令的用户</li>
<li>-K 交互方式输入sudo密码</li>
</ul>
</li>
</ul>
<h4 id="2-1-8-Ansible的逻辑关系"><a href="#2-1-8-Ansible的逻辑关系" class="headerlink" title="2.1.8 Ansible的逻辑关系"></a>2.1.8 Ansible的逻辑关系</h4><ul>
<li>逻辑或<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#主机192.168.1.10或者192.168.1.11</span></span></span><br><span class="line">ansible &quot;192.168.1.10:192.168.1.11&quot; -m ping</span><br></pre></td></tr></table></figure></li>
<li>逻辑与<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#主机组Zabix和Nginx共同的主机</span></span></span><br><span class="line">ansible &quot;Zabbix:&amp;Nginx&quot; -m ping</span><br></pre></td></tr></table></figure></li>
<li>逻辑非<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#不属于主机组Nginx的主机</span></span></span><br><span class="line">ansible &#x27;:!Nginx&#x27; -m ping</span><br></pre></td></tr></table></figure></li>
<li>正则表达式<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#192.168.1.0网段的主机</span></span></span><br><span class="line">ansible &#x27;192.168.1.*&#x27; -m ping</span><br></pre></td></tr></table></figure>
逻辑关系可以多次使用，例如查看主机组A和主机组B共有的，但不属于主机组C的主机可以使用<code>&quot;A:&amp;B:!C&quot;</code></li>
</ul>
<h3 id="2-2-Ansible常用模块"><a href="#2-2-Ansible常用模块" class="headerlink" title="2.2 Ansible常用模块"></a>2.2 Ansible常用模块</h3><p>有一些常用的模块比如yum，service在实验中多次出现，但教程里没有说明，请参考官方github <a target="_blank" rel="noopener" href="https://github.com/ansible/ansible-modules-core">https://github.com/ansible/ansible-modules-core</a><br>然后直接搜索模块名，如yum即可<br><img src="/assets/04%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/file-20250518152246766.png"><br>阅读原生注释吧！<br><img src="/assets/04%20%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86/file-20250518152326380.png"></p>
<h4 id="2-2-1-Ansible常用功能模块-Command"><a href="#2-2-1-Ansible常用功能模块-Command" class="headerlink" title="2.2.1 Ansible常用功能模块 - Command"></a>2.2.1 Ansible常用功能模块 - Command</h4><h5 id="2-2-1-1-Command介绍"><a href="#2-2-1-1-Command介绍" class="headerlink" title="2.2.1.1 Command介绍"></a>2.2.1.1 Command介绍</h5><ul>
<li>Command模块是ansible的默认模块，用于在被控制对象进行远程执行命令</li>
<li>使用Command模块执行命令时，不可以使用“&lt;”、“&gt;”或者“|”等特殊符号</li>
<li>该模块的常见选项有：<ul>
<li>chdir：在执行命令前，进入指定目录</li>
<li>cmd：要执行的命令</li>
<li>creates：根据某个文件状态来检查是否执行对应命令，如果存在则不执行对应命令</li>
<li>removes：和creates相反，也是根据文件是否存在来判断是否执行命令，如果存在，则执行对应命令</li>
<li>warn：开启告警</li>
</ul>
</li>
</ul>
<h5 id="2-2-1-2-Command实践"><a href="#2-2-1-2-Command实践" class="headerlink" title="2.2.1.2 Command实践"></a>2.2.1.2 Command实践</h5><p>需求：检查主机192.168.1.4是否存在目录&#x2F;data，如果不存在则创建，并将&#x2F;etc&#x2F;resolv.conf复制到&#x2F;data中，然后检查复制是否成功</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m command -a <span class="string">&quot;chdir=/ ls&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">afs</span><br><span class="line">bin</span><br><span class="line">Boot</span><br><span class="line">……</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m command -a <span class="string">&quot;chdir=/ mkdir data&quot;</span></span><br><span class="line">[WARNING]: Consider using the file <span class="keyword">module</span> with state=directory rather than running <span class="string">&#x27;mkdir&#x27;</span>. If you need to use command because file is insufficient you can</span><br><span class="line">add <span class="string">&#x27;warn: false&#x27;</span> to <span class="built_in">this</span> command task or set <span class="string">&#x27;command_warnings=False&#x27;</span> in ansible.cfg to get rid of <span class="built_in">this</span> message.</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m command -a <span class="string">&quot;cp /etc/resolv.conf /data&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m command -a <span class="string">&quot;creates=/data/resolv.conf cat /data/resolv.conf&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | SUCCESS | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">skipped, since /data/resolv.conf exists</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m command -a <span class="string">&quot;removes=/data/resolv.conf cat /data/resolv.conf&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>胶片中的执行过程是为了体现各个参数的用途，实际工作中不需要如此操作</li>
<li>在执行过程中，使用了mkdir命令来创建一个目录，系统会有告警，原因是Ansible有专门的模块来创建目录</li>
</ul>
<h4 id="2-2-2-Ansible常用功能模块-Shell及相关案例"><a href="#2-2-2-Ansible常用功能模块-Shell及相关案例" class="headerlink" title="2.2.2 Ansible常用功能模块 - Shell及相关案例"></a>2.2.2 Ansible常用功能模块 - Shell及相关案例</h4><p>Shell模块和Command使用方式基本一致，但支持“&lt;”、“&gt;”或者“|”等特殊符号<br>Shell模块无法处理类似<code>cat /etc/passwd | awk ‘&#123;print $1&#125;’ &gt; /dev/null</code>的复杂命令<br>需求：在主机192.168.1.4创建用户test，并将密码设置为“openEuler@123”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -a <span class="string">&quot;adduser test&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m shell -a <span class="string">&quot;echo openEuler@123 | passwd --stdin test&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">Changing password <span class="keyword">for</span> user test.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>


<h4 id="2-2-3-Ansible常用功能模块-Script及相关案例"><a href="#2-2-3-Ansible常用功能模块-Script及相关案例" class="headerlink" title="2.2.3 Ansible常用功能模块 - Script及相关案例"></a>2.2.3 Ansible常用功能模块 - Script及相关案例</h4><p>Script用于将控制器上的脚本发送到被控制主机上执行<br>需求：查找出主机名为Zabbix的虚拟机对应的IP地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#####在控制上创建以下内容的shell脚本</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# cat host-ip.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"><span class="keyword">if</span> [ $HOSTNAME = <span class="string">&quot;Zabbix&quot;</span> ]; then</span><br><span class="line">hostname -i</span><br><span class="line">fi</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible all -m script -a <span class="string">&quot;~/host-ip.sh&quot;</span> | grep <span class="string">&quot;stdout&quot;</span></span><br><span class="line"><span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;stdout_lines&quot;</span>: []</span><br><span class="line"><span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;192.168.1.4\r\n&quot;</span>,</span><br><span class="line"><span class="string">&quot;stdout_lines&quot;</span>: [</span><br><span class="line"><span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;stdout_lines&quot;</span>: []</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-Ansible常用功能模块-Copy和Fetch"><a href="#2-2-4-Ansible常用功能模块-Copy和Fetch" class="headerlink" title="2.2.4 Ansible常用功能模块 - Copy和Fetch"></a>2.2.4 Ansible常用功能模块 - Copy和Fetch</h4><h5 id="2-2-4-1-Copy和Fetch介绍"><a href="#2-2-4-1-Copy和Fetch介绍" class="headerlink" title="2.2.4.1 Copy和Fetch介绍"></a>2.2.4.1 Copy和Fetch介绍</h5><ul>
<li>Copy和Fetch用于控制器和被控制主机之间传输数据</li>
<li><strong>Copy用于将控制器数据复制到被控制主机，Fetch用于将被控制主机文件复制到控制器</strong>，<strong>Copy可用于传输目录，而Fetch仅支持传输文件</strong></li>
<li>Copy和Fetch常用选项有：<ul>
<li>src：用于指定源文件，如果目录为空，则不进行复制</li>
<li>dest：用于指定目的目录</li>
<li>content：copy模块参数，和“src”不能同时使用。用于将具体内容复制到被控制主机文件中</li>
<li>owner、group和mode：copy模块参数。用于指定目的文件的所属用户、所属组和权限</li>
<li>force：copy模块参数，如果在拷贝时，源文件内容和目的文件不一致，将force设为yes则覆盖目的文件，如果设为no则不覆盖。不使用force选项时，目的文件也会被覆盖</li>
</ul>
</li>
<li>Copy模块的dest选项需注意：需使用绝对路径；如果src是目录，dest也必须是目录；如果dest指定的路径不存在，并且路径是以“&#x2F;”结尾或者源是目录时，该路径会被自动创建；如果dest使用的是相对路径，那么其该路径的起点取决于被控制主机；如果src和dest是一个文件，且dest指定的目的路径不存在，该路径中的所有父路径不会被创建，此操作会失败</li>
<li>Fetch模块的dest选项需注意：ansible会将文件存放在指定目录中，并重新创建一个被控制主机IP地址或主机名开头与src路径拼接成的路径，如src为&#x2F;test，被控制节点IP为192.168.1.4，目的路径为&#x2F;tmp，最终文件会被保存在控制器的&#x2F;tmp&#x2F;192.168.1.4&#x2F;test中</li>
</ul>
<h5 id="2-2-4-2-Copy和Fetch实践"><a href="#2-2-4-2-Copy和Fetch实践" class="headerlink" title="2.2.4.2 Copy和Fetch实践"></a>2.2.4.2 Copy和Fetch实践</h5><p>需求一：将控制器中的文件 root&#x2F;data&#x2F;test复制到192.168.1.4&#x2F;tmp中，在复制的过程中将其所属指定为“root:root”，将权限设置为755，然后为test输入“hello，openEuler1”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# mkdir data</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# touch data/test</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m copy -a <span class="string">&quot;src=/root/data/ dest=/tmp/data/ owner=root group=root mode=755&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line">…….</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m copy -a <span class="string">&quot;content=&#x27;hello,openEuler1&#x27; dest=/tmp/data/test&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line">……</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -a <span class="string">&quot;cat /tmp/data/test&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED | rc=<span class="number">0</span> &gt;&gt;</span><br><span class="line">hello,openEuler1</span><br></pre></td></tr></table></figure>
<p>需求二：将被控制主机192.168.1.4上的&#x2F;tmp&#x2F;data&#x2F;test拷贝到控制器中&#x2F;tmp目录下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m fetch -a <span class="string">&quot;src=/tmp/data/test dest=/tmp“</span></span><br><span class="line"><span class="string">[root@Ansible ~]# ls /tmp/192.168.1.4/tmp/data/</span></span><br><span class="line"><span class="string">test</span></span><br><span class="line"><span class="string">[root@Ansible ~]# cat /tmp/192.168.1.4/tmp/data/test</span></span><br><span class="line"><span class="string">hello,openEuler1</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-Ansible常用功能模块-File"><a href="#2-2-5-Ansible常用功能模块-File" class="headerlink" title="2.2.5 Ansible常用功能模块 - File"></a>2.2.5 Ansible常用功能模块 - File</h4><h5 id="2-2-5-1-File介绍"><a href="#2-2-5-1-File介绍" class="headerlink" title="2.2.5.1 File介绍"></a>2.2.5.1 File介绍</h5><ul>
<li>File模块用于文件及文件属性管理</li>
<li>File模块常用选项有：<ul>
<li>force：在两种情况下强制创建软链接，一种是源文件不存在，但随后会创建；另外一种是目标软链接已存在，会强制取消，创建新的</li>
<li>owner、group和mode：设置所属用户、所属组和权限</li>
<li><strong>path：必选，指定被管理文件的路径</strong></li>
<li>recurse：递归设置目录属性</li>
<li>src、dest：当state&#x3D;link时，用来指定被链接的源文件和目的文件路径</li>
<li>state：重要选项，有多种配置，具体为：<ul>
<li>touch：创建文件，如果文件或目录已存在，则更新其最后修改时间</li>
<li>directory：创建目录，同时具备mkdir -p的递归创建功能</li>
<li>link和hard：创建软链接和硬链接</li>
<li>absent：删除指定目录，或解除链接</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-2-5-2-FIle实践"><a href="#2-2-5-2-FIle实践" class="headerlink" title="2.2.5.2  FIle实践"></a>2.2.5.2  FIle实践</h5><ul>
<li>需求：在被控制主机192.168.1.4中创建目录&#x2F;tmp&#x2F;file&#x2F;data，归属用户和组指定为test:test，权限设置为755，然后在该目录下创建文件test，并为test创建软链接指向&#x2F;tmp&#x2F;link，最后删除目录&#x2F;tmp&#x2F;file<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m file -a <span class="string">&quot;path=/tmp/file/data owner=test group=test mode=755 state=directory&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line">….</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m file -a <span class="string">&quot;path=/tmp/file/data/test state=touch&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line">…..</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m file -a <span class="string">&quot;src=/tmp/file/data/test dest=/tmp/link state=link&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line">……</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m file -a <span class="string">&quot;path=/tmp/file state=absent&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line"><span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;path&quot;</span>: <span class="string">&quot;/tmp/file&quot;</span>,</span><br><span class="line"><span class="string">&quot;state&quot;</span>: <span class="string">&quot;absent&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m shell -a <span class="string">&quot;ls /tmp | grep file&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | FAILED | rc=<span class="number">1</span> &gt;&gt;</span><br><span class="line">non-zero <span class="keyword">return</span> code</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-6-Ansible常用功能模块-Archive和Unarchive"><a href="#2-2-6-Ansible常用功能模块-Archive和Unarchive" class="headerlink" title="2.2.6 Ansible常用功能模块 - Archive和Unarchive"></a>2.2.6 Ansible常用功能模块 - Archive和Unarchive</h4><h5 id="2-2-6-1-Archive和Unarchive介绍"><a href="#2-2-6-1-Archive和Unarchive介绍" class="headerlink" title="2.2.6.1 Archive和Unarchive介绍"></a>2.2.6.1 Archive和Unarchive介绍</h5><ul>
<li>Archive模块用于文件的打包压缩，Unarchive模块用于压缩包的解压</li>
<li>Archive模块常用选项有：<ul>
<li>owner、group和mode：设置所属用户、所属组和权限</li>
<li>format：设置打包格式，支持bz2、gz、tar、xz、zip，默认为gz</li>
<li>path：指定需打包文件的绝对路径，可指定一个或多个文件</li>
<li>exclude_path：排除不需要打包的文件</li>
<li>remove：打包完成后，删除源文件</li>
</ul>
</li>
<li>Unarchive模块常用选项：<ul>
<li>copy：默认参数为copy&#x3D;yes，表示解压的压缩包来自于控制器，如果设置为copy&#x3D;no时，表示被解压的文件在被控制节点上</li>
<li>src、dest：设置压缩包的源路径和解压后存放的路径，src指定的可以是控制器上的路径，在copy&#x3D;no时，也可以是被控制主机上的路径</li>
<li>mode：解压后文件的权限</li>
<li>remote_src：和copy不能使用，设置为yes时表示压缩包来自被控制节点，设置为no时表示压缩包来自控制器</li>
</ul>
</li>
</ul>
<h5 id="2-2-6-2-Archive和Unarchive实践"><a href="#2-2-6-2-Archive和Unarchive实践" class="headerlink" title="2.2.6.2 Archive和Unarchive实践"></a>2.2.6.2 Archive和Unarchive实践</h5><ul>
<li>需求：在主机192.168.1.4中&#x2F;tmp中创建文件test、test1，将它们打包为test.zip，同时删除test和test1，再将其解压至&#x2F;tmp&#x2F;file目录中<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m file -a <span class="string">&quot;path=/tmp/test state=touch“</span></span><br><span class="line"><span class="string">….</span></span><br><span class="line"><span class="string">[root@Ansible ~]# ansible 192.168.1.4 -m file -a &quot;</span>path=/tmp/test1 state=touch“</span><br><span class="line">…..</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m archive -a <span class="string">&quot;path=/tmp/test,/tmp/test1 format=zip remove=yes dest=/tmp/test.zip&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line"><span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;archived&quot;</span>: [</span><br><span class="line"><span class="string">&quot;/tmp/test&quot;</span>,</span><br><span class="line"><span class="string">&quot;/tmp/test1&quot;</span></span><br><span class="line">],</span><br><span class="line">……</span><br><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m unarchive -a <span class="string">&quot;copy=no src=/tmp/test.zip dest=/tmp/file/&quot;</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | CHANGED =&gt; &#123;</span><br><span class="line"><span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>,</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-7-Ansible常用功能模块-Setup及使用案例"><a href="#2-2-7-Ansible常用功能模块-Setup及使用案例" class="headerlink" title="2.2.7 Ansible常用功能模块 - Setup及使用案例"></a>2.2.7 Ansible常用功能模块 - Setup及使用案例</h4><ul>
<li>Setup用于收集被控制节点的信息</li>
<li>需求：收集主机192.168.1.4的信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@Ansible</span> ~]# ansible <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> -m setup</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span> | SUCCESS =&gt; &#123;</span><br><span class="line"><span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;ansible_all_ipv4_addresses&quot;</span>: [</span><br><span class="line"><span class="string">&quot;192.168.1.4&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;ansible_all_ipv6_addresses&quot;</span>: [],</span><br><span class="line"><span class="string">&quot;ansible_apparmor&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;status&quot;</span>: <span class="string">&quot;disabled&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;ansible_architecture&quot;</span>: <span class="string">&quot;x86_64&quot;</span>,</span><br><span class="line"><span class="string">&quot;ansible_bios_date&quot;</span>: <span class="string">&quot;12/12/2018&quot;</span>,</span><br><span class="line"><span class="string">&quot;ansible_bios_version&quot;</span>: <span class="string">&quot;6.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;ansible_cmdline&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;BOOT_IMAGE&quot;</span>: <span class="string">&quot;/vmlinuz-5.10.0-60.18</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-8-Ansible常用功能模块-Lineinfile和Replace"><a href="#2-2-8-Ansible常用功能模块-Lineinfile和Replace" class="headerlink" title="2.2.8 Ansible常用功能模块 - Lineinfile和Replace"></a>2.2.8 Ansible常用功能模块 - Lineinfile和Replace</h4><ul>
<li>Lineinfile和Replace用于修改文件内容，功能和sed类似</li>
<li>Lineinfile常用选项有：<ul>
<li>path：指定被修改文件的绝对路径</li>
<li>line：替换或插入的内容</li>
<li>regexp：使用正则表达式匹配内容</li>
<li>insertbefore和insertafter：在匹配行前面和后面插入</li>
</ul>
</li>
<li>Replace常用选项有：<ul>
<li>path：指定被修改文件的绝对路径</li>
<li>regexp：使用正则表达式匹配内容</li>
<li>replace：替换正则表达式匹配到的内容</li>
<li>before和after：修改正则表达式匹配到的内容之前或之后的内容</li>
<li>owner、group和mode：修改文件所属用户、所属组和权限</li>
</ul>
</li>
</ul>
<h4 id="2-2-9-Ansible常用功能模块-User和Group"><a href="#2-2-9-Ansible常用功能模块-User和Group" class="headerlink" title="2.2.9 Ansible常用功能模块 - User和Group"></a>2.2.9 Ansible常用功能模块 - User和Group</h4><ul>
<li>User模块用于用户管理，其常用选项有：<ul>
<li>name：指定用户名</li>
<li>group和groups：group用于设置用户的主组，group用于将用户添加至其他组</li>
<li>password：用于设置用户密码</li>
<li>shell：设置用户shell</li>
<li>home：设置用户家目录</li>
<li>comment：设置用户描述信息</li>
<li>uid：设置用户ID</li>
</ul>
</li>
<li>Group模块用于组管理，其常用选项有：<ul>
<li>gid：用户设置组ID</li>
<li>name：指定组名称</li>
</ul>
</li>
</ul>
<h4 id="2-2-10-Ansible常用功能模块-Hostname、Cron、yum和Service"><a href="#2-2-10-Ansible常用功能模块-Hostname、Cron、yum和Service" class="headerlink" title="2.2.10 Ansible常用功能模块 - Hostname、Cron、yum和Service"></a>2.2.10 Ansible常用功能模块 - Hostname、Cron、yum和Service</h4><ul>
<li>Hostname模块用于修改被控制主机的主机名，使用选项“name”可指定需设置的主机名</li>
<li>Cron模块用于设置计划任务，其常用选项有：<ul>
<li>minute、hour、day、month和weekday：分别对应crontab文件中的分钟、小时、日期、月份和星期</li>
<li>job：指定执行的任务，可以是shell命令，也可以是脚本</li>
<li>name：用于设置任务名称</li>
<li>state：设置任务的状态，absent可用于删除任务</li>
<li>disable：启用或禁用任务，yes表示禁用，no表示启用</li>
</ul>
</li>
<li>Yum模块用于管理软件包，其常用选项有：<ul>
<li>name：需要安装的软件包名称</li>
<li>state：设置为absent表示卸载软件，设置为present表示安装软件，设置为lates表示安装最新版本</li>
</ul>
</li>
<li>Service模块用于服务管理，其常用选项有：<ul>
<li>name：指定服务名称</li>
<li>enabled：将服务设置为开机启动</li>
<li>state：设置服务状态，started表示开启，stopped表示关闭，reload表示重启</li>
</ul>
</li>
</ul>
<h3 id="2-3-Playbook简介"><a href="#2-3-Playbook简介" class="headerlink" title="2.3 Playbook简介"></a>2.3 Playbook简介</h3><ul>
<li>Playbook是由多个”play“组成，每一个”play“都对应一个任务，任务通过调用ansible的功能模块，按照事先设置好的机制执行预定义的动作</li>
<li>Playbook由YAML编写<br><img src="/file-20250511160428698.png"></li>
</ul>
<h4 id="2-3-1-YAML的特点"><a href="#2-3-1-YAML的特点" class="headerlink" title="2.3.1 YAML的特点"></a>2.3.1 YAML的特点</h4><ul>
<li>YAML具有很高的可读性</li>
<li>YAML和脚本语言之间有较好的交互性</li>
<li>YAML具有较强的易用行</li>
<li>YAML可以基于流来处理</li>
<li>YAML具有极强的扩展性</li>
<li>YAML对语法有较严格的要求</li>
</ul>
<h4 id="2-3-2-YAML文件的基本语法"><a href="#2-3-2-YAML文件的基本语法" class="headerlink" title="2.3.2 YAML文件的基本语法"></a>2.3.2 YAML文件的基本语法</h4><ul>
<li>使用缩进表示层级关系，左侧对齐的数据表示同一层级</li>
<li>缩进<strong>必须使用空格</strong>，不可使用tab</li>
<li>以”-“开头，代表是一个列表，需执行顺序</li>
<li>不以‘”-“开头，代表是一个字典，无执行顺序</li>
<li>YAML对大小敏感</li>
</ul>
<h4 id="2-3-3-Playbook的核心元素"><a href="#2-3-3-Playbook的核心元素" class="headerlink" title="2.3.3 Playbook的核心元素"></a>2.3.3 Playbook的核心元素</h4><ul>
<li>Hosts：用于指定被控制主机的列表</li>
<li>Tasks：用于指定被执行的任务</li>
<li>Variables：在playbook中调用的变量，可以是内置变量，也可以是自定义变量</li>
<li>Templates：模板，内部嵌套</li>
<li>Handlers和Notify：一般配合使用，用于为任务配置触发条件</li>
<li>Tags：标签，用于选择性的运行任务的部分代码</li>
</ul>
<h4 id="2-3-4-Playbook相关命令"><a href="#2-3-4-Playbook相关命令" class="headerlink" title="2.3.4 Playbook相关命令"></a>2.3.4 Playbook相关命令</h4><ul>
<li>命令”ansible-playbook“用于运行playbook，常用选项有：<ul>
<li>–list-hosts：列出相关主机</li>
<li>–list-tags：列出所有标签</li>
<li>–list-tasks：列出所有任务</li>
<li>–syntax-check：不执行playbook</li>
<li>-C，–check：不执行playbook，只对可能发生的变更进行检测，常用于检测playbook能否正常运行</li>
<li>–start-at-task START_AT_TASK：从指定的任务开始</li>
<li>-t：指定执行特定tags对应任务</li>
<li>–limit：排除不需要运行playbook的主机</li>
<li>-v，-vv，-vvv：查看详情</li>
</ul>
</li>
</ul>
<h4 id="2-3-5-Playbook的基本用法-Hosts和Tasks"><a href="#2-3-5-Playbook的基本用法-Hosts和Tasks" class="headerlink" title="2.3.5 Playbook的基本用法 -  Hosts和Tasks"></a>2.3.5 Playbook的基本用法 -  Hosts和Tasks</h4><ul>
<li>需求：在Nginx主机组中安装zabbix-agent2，并将zabbix-server地址设置为192.168.1.4，同时保证开机自启<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">下载并安装Zabbix</span> <span class="string">yum源</span></span><br><span class="line"><span class="attr">shell:</span> <span class="string">rpm</span> <span class="string">-Uvh</span> <span class="string">https://repo.zabbix.com/zabbix/6.2/rhel/8/x86_64/zabbix-release-6.2-3.el8.noarch.rpm</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装zabbix-agent</span></span><br><span class="line"><span class="attr">yum:</span></span><br><span class="line"><span class="string">name=zabbix-agent2</span></span><br><span class="line"><span class="string">state=present</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">修改zabbix-agent2配置文件，将server地址设置为192.168.1.4</span></span><br><span class="line"><span class="attr">replace:</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">/etc/zabbix/zabbix_agent2.conf</span></span><br><span class="line"><span class="attr">regexp:</span> <span class="string">&#x27;^Server=127.0.0.1$&#x27;</span></span><br><span class="line"><span class="attr">replace:</span> <span class="string">&#x27;Server=192.168.1.4&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">设置zabbix-agent2开机启动</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zabbix-agent2</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure></li>
<li>Yaml文件一般命名为“.yaml”或者“.yml”，开头第一行一般是“—”，hosts和tasks之间建议空一行，使playbook可读性更强</li>
<li>Hosts可以使用逻辑关系表示，例如“test1:test2”、“test1::&amp;test2”等</li>
<li>Remote_user可以在hosts中使用，也可以在tasks中使用，表示执行操作的用户</li>
<li>Gather_facts表示是否收集主机信息，和setup模块功能一致，如果不需要根据主机信息进行判断，建议设置为no，可提升playbook效率</li>
</ul>
<p><img src="/file-20250512151012155.png"><br>来看下正确的格式</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Zabbix</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">hostname</span> <span class="string">for</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">      <span class="attr">hostname:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; new_hostname &#125;&#125;</span>&quot;</span>  <span class="comment"># 替换为实际变量名，如 inventory_hostname_short</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">hostname</span> <span class="string">for</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.14</span> <span class="string">and</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.15</span></span><br><span class="line">      <span class="attr">hostname:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_hostname &#125;&#125;</span>-<span class="template-variable">&#123;&#123; inventory_hostname_short &#125;&#125;</span>&quot;</span>  <span class="comment"># 示例：使用内置变量组合</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-6-Playbook的基本用法-Handlers和Notify"><a href="#2-3-6-Playbook的基本用法-Handlers和Notify" class="headerlink" title="2.3.6 Playbook的基本用法 - Handlers和Notify"></a>2.3.6 Playbook的基本用法 - Handlers和Notify</h4><ul>
<li><p>需求：在Nginx主机组中安装zabbix-agent2，每次修改zabbix-server地址后，自动重启zabbix-agent2</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="string">…….</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">修改zabbix-agent2配置文件，将server地址设置为192.168.1.4</span></span><br><span class="line"><span class="attr">replace:</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">/etc/zabbix/zabbix_agent2.conf</span></span><br><span class="line"><span class="attr">regexp:</span> <span class="string">&#x27;^Server=127.0.0.1$&#x27;</span></span><br><span class="line"><span class="attr">replace:</span> <span class="string">&#x27;Server=192.168.1.4&#x27;</span></span><br><span class="line"><span class="attr">notity:</span> <span class="string">restart</span> <span class="string">agent2</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">设置zabbix-agent2开机启动</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zabbix-agent2</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">handlers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">agent2</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zabbix-agent2</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在一个任务中可以设置多个notify，以触发多个handler</p>
</li>
</ul>
<h4 id="2-3-7-Playbook的基本用法-Tags"><a href="#2-3-7-Playbook的基本用法-Tags" class="headerlink" title="2.3.7 Playbook的基本用法 - Tags"></a>2.3.7 Playbook的基本用法 - Tags</h4><p>需求：在Nginx主机组中安装zabbix-agent2 ，为修改zabbix-server地址的动作定义标签，后续zabbix-server地址发生变化，仅需执行该操作即可</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">修改zabbix-agent2配置文件，将server地址设置为192.168.1.4</span></span><br><span class="line"><span class="attr">tags:</span> <span class="string">modify-server-IP</span></span><br><span class="line"><span class="attr">replace:</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">/etc/zabbix/zabbix_agent2.conf</span></span><br><span class="line"><span class="attr">regexp:</span> <span class="string">&#x27;^Server=127.0.0.1$&#x27;</span></span><br><span class="line"><span class="attr">replace:</span> <span class="string">&#x27;Server=192.168.1.4&#x27;</span></span><br><span class="line"><span class="attr">notity:</span> <span class="string">restart</span> <span class="string">agent2</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">设置zabbix-agent2开机启动</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zabbix-agent2</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<p>如果仅需执行修改地址的操作，可使用命令<code>ansible-playbook -t modify-server-IP zabbix-agent2.yml</code></p>
<h4 id="2-3-8-Playbook的基本用法-Variables"><a href="#2-3-8-Playbook的基本用法-Variables" class="headerlink" title="2.3.8 Playbook的基本用法 - Variables"></a>2.3.8 Playbook的基本用法 - Variables</h4><ul>
<li><strong>需求：在主机组Nginx中创建用户和组Nginx</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="comment">#####现实方式一：playbook定义变量，执行命令时设置值</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建组</span></span><br><span class="line"><span class="attr">group:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">group_name</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建用户</span></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">user_name</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">然后执行命令：</span></span><br><span class="line"><span class="string">ansible-playbook</span> <span class="string">-e</span> <span class="string">group_name=nginx</span> <span class="string">-e</span> <span class="string">user_name=nginx</span> <span class="string">var.yaml</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###实现方式二：playbook定义</span></span><br><span class="line"><span class="string">变量并赋值</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">vars:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">group_name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">user_name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建组</span></span><br><span class="line"><span class="attr">group:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">group_name</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建用户</span></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">user_name</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###实现方式三：单独创建变量文件，然后在</span></span><br><span class="line"><span class="string">playbook中调用</span></span><br><span class="line"><span class="comment">###变量文件vars.yml内容如下：</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">group_name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">user_name:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="comment">###playbook内容如下：</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">vars_files:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">vars.yml</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建组</span></span><br><span class="line"><span class="attr">group:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">group_name</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">创建用户</span></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line"><span class="string">name=&#123;&#123;</span> <span class="string">user_name</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>Variables是ansible中的变量，使用来自定义变量，或者通过setup中定义好的定了，然后在命令中或者playbook中或者特定的文件中指定变量的值</p>
<ul>
<li><strong>需求：将Nginx主机组中主机的主机名统一修改为格式为Nginx-num</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###将主机组配置文件修改为以下内容：</span></span><br><span class="line">[<span class="string">Nginx</span>]</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.14</span> <span class="string">host=01</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.15</span> <span class="string">host=02</span></span><br><span class="line">[<span class="string">Nginx:vars</span>]</span><br><span class="line"><span class="string">group=Nginx</span></span><br><span class="line"><span class="comment">###使用hostname模块进行主机名统一修改</span></span><br><span class="line"><span class="string">ansible</span> <span class="string">Nginx</span> <span class="string">-m</span> <span class="string">hostname</span> <span class="string">-a</span> <span class="string">&quot;name=<span class="template-variable">&#123;&#123; group &#125;&#125;</span>-<span class="template-variable">&#123;&#123; host &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-9-Playbook的基本用法-Templates"><a href="#2-3-9-Playbook的基本用法-Templates" class="headerlink" title="2.3.9 Playbook的基本用法 - Templates"></a>2.3.9 Playbook的基本用法 - Templates</h4><ul>
<li>Templates可以参考ansible的模块文件，动态的生成配置文件，供playbook调用。Templates文件需放在固定的目录中，且以“.j2”结尾</li>
<li>需求：在Nginx主机组的主机上安装zabbix-agent2，并将配置文件统一使用zabbix_agent2.conf.j2<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">Nginx</span></span><br><span class="line"><span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">下载并安装Zabbix</span> <span class="string">yum源</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">修改zabbix-agent2配置文件，使用同一模板</span></span><br><span class="line"><span class="attr">template:</span> <span class="string">src=/root/template/zabbix_agent2.conf.j2</span> <span class="string">dest=/etc/zabbix/zabbix_agent2.conf</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">设置zabbix-agent2开机启动</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">zabbix-agent2</span></span><br><span class="line"><span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-10-Playbook的基本用法-Role"><a href="#2-3-10-Playbook的基本用法-Role" class="headerlink" title="2.3.10 Playbook的基本用法 - Role"></a>2.3.10 Playbook的基本用法 - Role</h4><ul>
<li><p>Role用 于层 次性 、结 构性 较强 的playbook， 可以 根据 已定 义好 的、 层次 性较 高的 目录 ，自 动装 载变 量文 件、 任务及handler等，批量的完成较复杂的运维任务</p>
</li>
<li><p>Role的目录常见目录结构如下：<img src="/file-20250511163659429.png"></p>
</li>
<li><p>需求：集群部署WordPress，数据库基于MySQL，http服务器使用apache实现</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WordPress</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">apache</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">	<span class="bullet">-</span> <span class="string">wordpress</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="0x03-SaltStack"><a href="#0x03-SaltStack" class="headerlink" title="0x03 SaltStack"></a>0x03 SaltStack</h2><ul>
<li>SaltStack以Salt项目为核心，主要包含两大功能模块：<ul>
<li>配置管理系统</li>
<li>分布式远程命令执行系统</li>
</ul>
</li>
<li>SaltStack具备六大特性：<ul>
<li>易用性</li>
<li>并行执行</li>
<li>成熟稳定</li>
<li>易集成</li>
<li>高性能</li>
<li>开源</li>
</ul>
</li>
</ul>
<h3 id="3-1-SaltStack逻辑架构"><a href="#3-1-SaltStack逻辑架构" class="headerlink" title="3.1 SaltStack逻辑架构"></a>3.1 SaltStack逻辑架构</h3><ul>
<li>Salt master和salt minion<ul>
<li>SaltStack采用的是C&#x2F;S架构，服务器是运行了salt-master服务的salt master，客户端是运行了salt-minion服务的salt minion。Master向minion发送命令，minion向特定的master注册</li>
<li>SaltStack还采用了发布&#x2F;订阅的模式，master是任务的发布者，minion则通过订阅的方式获取master发布的任务</li>
</ul>
</li>
<li>Targets<ul>
<li>Master将应当执行任务的一组minion定义为target</li>
</ul>
</li>
<li>开放的事件系统<ul>
<li>Eve</li>
<li>nt bus用于事件管理系统中master和minion之间的内部通信</li>
<li>zeroMQ和Tornado用于minion从事件管理系统订阅job及执行结果的可插拔组件</li>
</ul>
</li>
<li>Grains和pillar<ul>
<li>Grains运行在minion中，用来收集该minion的信息，如OS、域名、IP地址等。Grains是静态数据，仅系统信息发生变化或用户自定义了某个参数后才会刷新</li>
<li>Pillar存放着由master定义的动态数据，当需要时，再推送到minion</li>
</ul>
</li>
<li>Beacons和reactors<ul>
<li>Beacons和reactors用于监控。Beacons运行在minion中，当故障出现时，它会触发reactors来提供故障处理的帮助信息</li>
</ul>
</li>
<li><img src="/file-20250511164416286.png"></li>
<li>架构图来源：<ul>
<li><a target="_blank" rel="noopener" href="https://docs.saltproject.io/en/latest/topics/salt_system_architecture.html#salt-masters-and-salt-minions">https://docs.saltproject.io/en/latest/topics/salt_system_architecture.html#salt-masters-and-salt-minions</a></li>
</ul>
</li>
<li>Pillar和grains都是用来存放数据的，其中pillar用来存放一些私密数据，如用户名密码等，pillar中的数据仅有特定的minion才能查看到</li>
<li>除了运行salt-minion服务，master还可以通过proxy和ssh来对客户端进行命令下发，其中proxy中不允许运行salt-minon</li>
<li>使用命令“salt * grains.ls”可查看所有主机的grains项，查看详细值使用命令“salt grains.items”</li>
</ul>
<h3 id="3-2-Master与Minion的认证和通信"><a href="#3-2-Master与Minion的认证和通信" class="headerlink" title="3.2 Master与Minion的认证和通信"></a>3.2 Master与Minion的认证和通信</h3><ul>
<li>Master与Minion之间通过公钥私钥进行认证<br><img src="/file-20250511164541231.png"></li>
<li>Master与Minion之间通过4505和4506进行通信<br><img src="/file-20250511164554899.png"></li>
<li>Minion在第一次启动时，会在&#x2F;etc&#x2F;salt&#x2F;pki&#x2F;minion下自动生成私钥minion.key和公钥minion.pub，并将公钥发送给master</li>
<li>Master收到minion发送的公钥后，并不会自动接收，需要管理员使用“salt-key”进行手动接收，并将其保存到&#x2F;etc&#x2F;salt&#x2F;pki&#x2F;masker&#x2F;minions中</li>
</ul>
<h3 id="3-3-SaltStack的安装部署"><a href="#3-3-SaltStack的安装部署" class="headerlink" title="3.3 SaltStack的安装部署"></a>3.3 SaltStack的安装部署</h3><ul>
<li>安装前检查</li>
<li>安装salt-master和salt-minion<ul>
<li>Bootstrap安装：使用SaltStack提供的脚本进行安装</li>
<li>手动安装：使用yum源进行安装</li>
</ul>
</li>
<li>安装后配置<ul>
<li>在minion中配置要注册的master</li>
</ul>
</li>
<li>启动服务</li>
<li>配置master和minion之间的认证</li>
<li>配置后检查</li>
</ul>
<h3 id="3-4-Master和Minion重要配置"><a href="#3-4-Master和Minion重要配置" class="headerlink" title="3.4 Master和Minion重要配置"></a>3.4 Master和Minion重要配置</h3><ul>
<li><p>Master配置文件默认为&#x2F;etc&#x2F;salt&#x2F;master，同时包含了&#x2F;etc&#x2F;salt&#x2F;master.d下所有.conf文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The address of the interface to bind to:</span></span><br><span class="line"><span class="attr">interface:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># The tcp port used by the publisher:</span></span><br><span class="line"><span class="attr">publish_port:</span> <span class="number">4505</span></span><br><span class="line"><span class="comment"># The port used by the communication interface. The ret (return) port is the</span></span><br><span class="line"><span class="comment"># interface used for the file server, authentication, job returns, etc.</span></span><br><span class="line"><span class="attr">ret_port:</span> <span class="number">4506</span></span><br><span class="line"><span class="comment"># Directory used to store public key data:</span></span><br><span class="line"><span class="attr">pki_dir:</span> <span class="string">/etc/salt/pki/master</span></span><br><span class="line"><span class="attr">file_roots:</span></span><br><span class="line"><span class="attr">base:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">/srv/salt/</span></span><br><span class="line"><span class="attr">pillar_roots:</span></span><br><span class="line"><span class="attr">base:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">/srv/pillar</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Minion中关于master的配置文件默认为&#x2F;etc&#x2F;salt&#x2F;master，同时包含了&#x2F;etc&#x2F;salt&#x2F;master.d下所有.conf文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the location of the salt master server. If the master server cannot be</span></span><br><span class="line"><span class="comment"># resolved, then the minion will fail to start.</span></span><br><span class="line"><span class="attr">master:</span> <span class="string">salt</span></span><br><span class="line"><span class="string">id</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>file_roots设置的目录用于存放任务执行脚本</p>
</li>
<li><p>pillar_roots用于设置pillar数据存放目录</p>
</li>
</ul>
<h3 id="3-5-Master和Minion的互信认证配置"><a href="#3-5-Master和Minion的互信认证配置" class="headerlink" title="3.5 Master和Minion的互信认证配置"></a>3.5 Master和Minion的互信认证配置</h3><ul>
<li>在master上使用命令salt-key接收minion发来的密钥，以下为常用选项：<ul>
<li>-A：接受全部密钥</li>
<li>-D：删除全部密钥</li>
<li>-L ：列出全部密钥</li>
<li>-a ：接受指定密钥</li>
<li>-j  ：拒绝指定密钥</li>
<li>-d： 删除指定密钥</li>
</ul>
</li>
</ul>
<h3 id="3-6-SaltStack的基本操作-Grains"><a href="#3-6-SaltStack的基本操作-Grains" class="headerlink" title="3.6 SaltStack的基本操作 - Grains"></a>3.6 SaltStack的基本操作 - Grains</h3><ul>
<li><p>Grains用于存放minion的静态数据，管理员可以通过grains自带item或自定义item定义targets</p>
<ul>
<li>使用命令<code>salt &#39;*&#39; grains.items</code>查看系统自带的所有item<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@SaltStack</span> ~]# salt <span class="string">&#x27;*&#x27;</span> grains.items</span><br><span class="line">Nginx1:</span><br><span class="line">----------</span><br><span class="line">biosreleasedate:</span><br><span class="line"><span class="number">12</span>/<span class="number">12</span>/<span class="number">2018</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用命令<code>salt &#39;*&#39; grains.item item_name</code>可查看指定的item对应的具体值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@SaltStack</span> ~]# salt <span class="string">&#x27;*&#x27;</span> grains.item os</span><br><span class="line">Nginx2:</span><br><span class="line">----------</span><br><span class="line">os:</span><br><span class="line">openEuler</span><br><span class="line">Nginx1:</span><br><span class="line">----------</span><br><span class="line">os:</span><br><span class="line">openEuler</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命令“<code>salt -G &#39;item_name:item_value&#39; test.ping </code>”可根据item的值来指定主机进行命令执行</p>
</li>
<li><p>命令中的<code>*</code>表示所有主机，可以指定主机进行查看</p>
</li>
<li><p>修改minion配置文件中关于grains部分可进行item的自定义</p>
<ul>
<li>在minion节点上&#x2F;etc&#x2F;salt&#x2F;minion.d目录中创建关于grains的配置文件，并输入以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rains:</span></span><br><span class="line"><span class="attr">role:</span> <span class="string">Nginx</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>重启salt-minion服务后，在master节点即可查看到自定义的item</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@SaltStack</span> <span class="string">~</span>]<span class="comment"># salt &#x27;*&#x27; grains.item role</span></span><br><span class="line"><span class="attr">Nginx2:</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="attr">role:</span></span><br><span class="line"><span class="attr">Nginx1:</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="attr">role:</span></span><br><span class="line"><span class="string">Nginx</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>除了目录&#x2F;etc&#x2F;salt&#x2F;minion.d中可自定义grains的item，在&#x2F;etc&#x2F;salt目录中创建文件grains，也可以自定义item。在grains中直接以“item: value”的格式定义item，SaltStack可自定识别到相关内容</p>
</li>
<li><p>修改grains后，master需要同步变更，有两方式：</p>
<ul>
<li>重启salt-minion服务</li>
<li>在master上执行命令<code>salt &#39;*&#39; saltutil.sync_grains</code></li>
</ul>
</li>
</ul>
<h3 id="3-7-SaltStack的基本操作-Pillar"><a href="#3-7-SaltStack的基本操作-Pillar" class="headerlink" title="3.7 SaltStack的基本操作 - Pillar"></a>3.7 SaltStack的基本操作 - Pillar</h3><ul>
<li>Pillar用于存放动态数据，仅对指定minion有效</li>
<li>Pillar通过在指定目录中创建配置文件来自定义，如在&#x2F;srv&#x2F;pillar目录中创建pillar的配置文件，并输入以下内容：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@SaltStack</span> pillar]#cat test.sls</span><br><span class="line">test: Nginx1</span><br><span class="line">[root<span class="meta">@SaltStack</span> pillar]# cat top.sls</span><br><span class="line">base:</span><br><span class="line"><span class="string">&#x27;Nginx1&#x27;</span>:</span><br><span class="line">- test</span><br></pre></td></tr></table></figure></li>
<li>完成配置后，使用以下命令查看自定义的pillar是否生效<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@SaltStack</span> pillar]# salt <span class="string">&#x27;*&#x27;</span> saltutil.refresh_pillar</span><br><span class="line">….</span><br><span class="line">[root<span class="meta">@SaltStack</span> pillar]# salt <span class="string">&#x27;*&#x27;</span> pillar.items test</span><br><span class="line">Nginx2:</span><br><span class="line">----------</span><br><span class="line">test:</span><br><span class="line">Nginx1:</span><br><span class="line">----------</span><br><span class="line">test:</span><br><span class="line">Nginx1</span><br></pre></td></tr></table></figure></li>
<li>Pillar的配置文件存放目录在master的配置文件中指定，本课程指定在&#x2F;srv&#x2F;pillar目录中</li>
</ul>
<h3 id="3-8-SaltStack的远程执行功能"><a href="#3-8-SaltStack的远程执行功能" class="headerlink" title="3.8 SaltStack的远程执行功能"></a>3.8 SaltStack的远程执行功能</h3><ul>
<li>SaltStack远程执行的命令格式为：&#96;salt [options] ‘<target>‘ <function> [arguments<ul>
<li>options：表示设置target的方式</li>
<li>target：表示需执行远程命令的客户端</li>
<li>function：表示功能模块</li>
<li>arguments：表示具体执行的命令<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@SaltStack</span> ~]# salt -L <span class="string">&#x27;Nginx1,Nginx2&#x27;</span> cmd.run <span class="string">&#x27;ip addr&#x27;</span></span><br><span class="line">Nginx1:</span><br><span class="line">………</span><br><span class="line"><span class="number">2</span>: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc mq state UP group <span class="keyword">default</span> qlen <span class="number">1000</span></span><br><span class="line">link/ether <span class="number">00</span>:0c:<span class="number">29</span>:<span class="number">88</span>:a6:a9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">altname enp11s0</span><br><span class="line">inet <span class="number">192.168</span><span class="number">.1</span><span class="number">.14</span>/<span class="number">24</span> brd <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span> scope global noprefixroute ens192</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line">……..</span><br><span class="line">Nginx2:</span><br><span class="line">……..</span><br><span class="line"><span class="number">2</span>: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="number">1500</span> qdisc mq state UP group <span class="keyword">default</span> qlen <span class="number">1000</span></span><br><span class="line">link/ether <span class="number">00</span>:0c:<span class="number">29</span>:a8:db:<span class="number">82</span> brd ff:ff:ff:ff:ff:ff</span><br><span class="line">altname enp11s0</span><br><span class="line">inet <span class="number">192.168</span><span class="number">.1</span><span class="number">.15</span>/<span class="number">24</span> brd <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span> scope global noprefixroute ens192</span><br><span class="line">valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="3-8-1-SaltStack的远程执行功能-Target指定"><a href="#3-8-1-SaltStack的远程执行功能-Target指定" class="headerlink" title="3.8.1 SaltStack的远程执行功能 - Target指定"></a>3.8.1 SaltStack的远程执行功能 - Target指定</h4><ul>
<li>SaltStack支持多种方式进行target指定，常见方式有：<ul>
<li>通配符方式，如：<code>salt &#39;*&#39; test.ping、salt ‘Nginx*&#39; test.ping、salt &#39;Nginx[1|2]&#39; test.ping、salt &#39;Nginx[!1]&#39; test.ping</code>等</li>
<li><code>-L</code>：列表方式，如：<code>salt -L &#39;Nginx1,Nginx2&#39; test.ping</code></li>
<li><code>-E</code>：正则表达方式，如：<code>salt -E &#39;^N&#39; test.ping</code></li>
<li><code>-I</code>：通过<code>pillar</code>指定主机，如：<code>salt -I &#39;test:Nginx1&#39; test.ping</code></li>
<li><code>-G</code>：通过grains指定主机，如： <code>salt -G &#39;ipv4:192.168.1.14&#39; test.ping</code></li>
<li><code>-C</code>：混合方式指定主机，如：<code>salt -C &#39;I@test:Nginx1 or G@ipv4:192.168.1.15&#39; test.ping</code></li>
<li><code>-S</code>：通过网络信息指定主机，如：<code>salt -S &#39;192.168.1.0/24&#39; test.ping，salt -S &#39;192.168.1.15&#39; test.ping</code></li>
<li><code>-H</code>：通过主机组方式指定主机，需先在配置文件中设置主机组，如：<code>salt -N test test.ping</code></li>
</ul>
</li>
</ul>
<h4 id="3-8-2-SaltStack的远程执行功能-功能模块"><a href="#3-8-2-SaltStack的远程执行功能-功能模块" class="headerlink" title="3.8.2 SaltStack的远程执行功能 - 功能模块"></a>3.8.2 SaltStack的远程执行功能 - 功能模块</h4><ul>
<li>SaltStack的功能模块有python开发，用于批量任务执行</li>
<li>SaltStack支持的功能模块列表可查看官方文档：<ul>
<li><a target="_blank" rel="noopener" href="https://docs.saltproject.io/en/latest/ref/modules/all/index.html#all-salt-modules">https://docs.saltproject.io/en/latest/ref/modules/all/index.html#all-salt-modules</a></li>
</ul>
</li>
<li>使用命令<code>salt &#39;minion_name&#39; sys.list_modules</code>可列出minion所安装的模块</li>
<li>使用命令<code>salt &#39;minion_name&#39; sys.doc &#39;module_name&#39;</code>可查看模块使用文档</li>
<li>使用命令<code>salt &#39;minion_name&#39; sys.list_functions &#39;module_name&#39;</code>可查看模块支持功能</li>
<li>SaltStack常用模块有:<ul>
<li>pkg</li>
<li>network</li>
<li>service</li>
<li>status</li>
<li>file</li>
<li>user和group</li>
</ul>
</li>
</ul>
<h5 id="3-8-2-1-SaltStack常用模块简介-Pkg"><a href="#3-8-2-1-SaltStack常用模块简介-Pkg" class="headerlink" title="3.8.2.1 SaltStack常用模块简介 - Pkg"></a>3.8.2.1 SaltStack常用模块简介 - Pkg</h5><ul>
<li>Pkg模块用于包管理，常用功能有：<ul>
<li>pkg.avaliable_version：查看软件包最新版本</li>
<li>pkg.download：仅下载安装包，但不安装，下载完成后会返回安装包存放目录</li>
<li>pkg.list_repos：列出yum源相关信息</li>
<li>pkg.install：安装指定软件包，pkg.group_install安装指定软件组</li>
<li>pkg.remove：卸载指定软件包</li>
<li>pkg.owner：查看某个文件输入哪个软件包</li>
<li>pkg.list_pkgs：列出全部已安装软件包</li>
<li>pkg.mod_repo：修改yum源某些参数</li>
</ul>
</li>
</ul>
<h5 id="3-8-2-2-SaltStack常用功能模块简介-Network"><a href="#3-8-2-2-SaltStack常用功能模块简介-Network" class="headerlink" title="3.8.2.2 SaltStack常用功能模块简介 - Network"></a>3.8.2.2 SaltStack常用功能模块简介 - Network</h5><ul>
<li>Network模块用于收集和管理网络信息，常用功能有：<ul>
<li>network.active_tcp：返回字典形式的活动的TCP连接</li>
<li>network.connect：通过minion的指定端口测试与某个host之间的连通性</li>
<li>network.default_route：查看minion的指定网段路由明细</li>
<li>network.dig：使用dig对minion进行DNS测试</li>
<li>network.interface：查看minion指定端口的地址</li>
<li>network.ping：指定minion对某个地址进行ping测试</li>
<li>network.routes：查看指定minion的路由表</li>
<li>network.traceout：指定minion对某个地址进行路由追踪</li>
</ul>
</li>
</ul>
<h5 id="3-8-2-3-SaltStack常用功能模块简介-Service"><a href="#3-8-2-3-SaltStack常用功能模块简介-Service" class="headerlink" title="3.8.2.3 SaltStack常用功能模块简介 - Service"></a>3.8.2.3 SaltStack常用功能模块简介 - Service</h5><ul>
<li>Service模块用于服务管理，常用功能有：<ul>
<li>service.available：查看某个服务是否可用，如果可用返回值为“True”，反之则为”False”</li>
<li>service.disable：将服务设置为开机不自启</li>
<li>service.disabled：查看服务是否在开机不自启清单中，如果在返回值为“False”，反之则为“True”</li>
<li>service.enable：将服务设置为开机自启</li>
<li>service.enabled：查看服务是否在开机自启清单中，如果在返回值为“True”，反之则为“False”</li>
<li>service.get_all：列出全部已安装可用的服务</li>
<li>service.start：启动某个服务</li>
<li>service.stop：关闭某个服务</li>
<li>service.restart：重启某个服务</li>
<li>service.reload：重新加载某个服务配置</li>
</ul>
</li>
</ul>
<h5 id="3-8-2-4-SaltStack常用功能模块简介-File"><a href="#3-8-2-4-SaltStack常用功能模块简介-File" class="headerlink" title="3.8.2.4 SaltStack常用功能模块简介 - File"></a>3.8.2.4 SaltStack常用功能模块简介 - File</h5><ul>
<li>File模块用于常规与非常规文件及目录的管理，如设置文件的用户、组、权限等，常用功能有：<ul>
<li>file. access：测试SaltStack对文件或目录是否具备某项权限，“f”查看所查询对象是否存在，“r”、“w”和“x”本别用于查看是否具备读写和执行权限</li>
<li>file.append：用于在文件里追加内容，如果文件不存在，则系统会报错</li>
<li>file.basename和file.dirname：通过路径指定某个文件，SaltStack分别返回最后一部分和目录部分</li>
<li>file.touch：创建文件，如果文件已存在则更新该文件的访问时间或修改时间</li>
<li>file.chgrp和file.chown：分别用于修改文件或目录的所属组或者所属用户和所属组</li>
<li>file.find：搜索文件</li>
<li>file.diskusage：计算目录所占空间，返回值的单位为字节</li>
<li>file.get_gid、file.get_group、file.get_uid和file.get_user：用于获取文件的所属组ID、所属组、所属用户ID和所属用户</li>
<li>file.grep：在某个文件中查找指定内容</li>
<li>file.makdirs和file.mkdir：创建目录。二者有一定的区别，例如，如果创建目录&#x2F;tmp&#x2F;test，使用file.makdirs后面需输入&#x2F;tmp&#x2F;test&#x2F;，如果使用file.mkdir后面输入&#x2F;tmp&#x2F;test即可。同时filemakdirs不支持同时创建多个目录，file.mkdir则支持</li>
<li>file.move：移动文件或目录</li>
<li>file.remove和file.rename：删除文件及重命名文件</li>
<li>file.rmdir：删除空目录</li>
</ul>
</li>
</ul>
<h5 id="3-8-2-5-SaltStack常用功能模块简介-Status"><a href="#3-8-2-5-SaltStack常用功能模块简介-Status" class="headerlink" title="3.8.2.5 SaltStack常用功能模块简介 - Status"></a>3.8.2.5 SaltStack常用功能模块简介 - Status</h5><ul>
<li>Status模块用于查看minion的状态，常用功能有：<ul>
<li>status.cpuinfo：查看minion的cpu信息</li>
<li>status.cpustats：查看minion的cpu状态</li>
<li>status.diskstats：查看minion的磁盘状态</li>
<li>status.diskusage：查看minion某块磁盘的使用率</li>
<li>status.meminfo：查看minion的内存信息</li>
<li>status.netstats：查看minion的网络状态</li>
</ul>
</li>
</ul>
<h3 id="3-9-SaltStack的配置管理功能"><a href="#3-9-SaltStack的配置管理功能" class="headerlink" title="3.9 SaltStack的配置管理功能"></a>3.9 SaltStack的配置管理功能</h3><ul>
<li>SaltStack的配置管理依赖<strong>state功能模块</strong>实现</li>
<li>SaltStack的配置文件使用<strong>yaml语法</strong>，文件后缀需以<code>.sls</code>结尾</li>
<li>SaltStack的配置文件需存放在master指定目录中，该目录由参数“file_roots”指定</li>
<li>当定制了多个配置文件后，可使用top.sls作为所有配置和文件的入口，自动运行所有的sls文件</li>
<li>Top文件的名称默认为top.sls，可以在master配置文件中修改</li>
<li>Top文件的存放位置由file_roots参数中的Base配置</li>
<li>为了使目录结构清晰，在Base的目录中，top.sls放在一级目录下，其他sls文件建议存放在二级目录下</li>
</ul>
<h4 id="3-9-1-配置文件编写"><a href="#3-9-1-配置文件编写" class="headerlink" title="3.9.1 配置文件编写"></a>3.9.1 配置文件编写</h4><p>需求：通过SaltStack配置管理功能为Nginx1安装nginx服务，并设置为开机自启</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@SaltStack</span> <span class="string">nginx</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/srv/salt/nginx</span></span><br><span class="line">[<span class="string">root@SaltStack</span> <span class="string">nginx</span>]<span class="comment"># cat nginx.sls</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">nginx_install:</span></span><br><span class="line"> <span class="attr">pkg.installed:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">enable_nginx:</span></span><br><span class="line"> <span class="attr">service.running:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">enable:</span> <span class="literal">True</span></span><br><span class="line">[<span class="string">root@SaltStack</span> <span class="string">nginx</span>]<span class="comment"># salt &#x27;Nginx1&#x27; state.sls nginx</span></span><br></pre></td></tr></table></figure>


<h4 id="3-9-2-Top文件编写"><a href="#3-9-2-Top文件编写" class="headerlink" title="3.9.2 Top文件编写"></a>3.9.2 Top文件编写</h4><p>需求：在上页胶片的基础上，另外给Nginx2安装httpd服务，并设置为开机启动，并使用top文件通过执行两个sls配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@SaltStack</span> <span class="string">salt</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/srv/salt</span></span><br><span class="line">[<span class="string">root@SaltStack</span> <span class="string">salt</span>]<span class="comment"># ls</span></span><br><span class="line"><span class="string">httpd.sls</span> <span class="string">Nginx.sls</span> <span class="string">top.sls</span></span><br><span class="line">[<span class="string">root@SaltStack</span> <span class="string">salt</span>]<span class="comment"># cat top.sls</span></span><br><span class="line"><span class="attr">base:</span></span><br><span class="line"><span class="attr">&#x27;Nginx1&#x27;:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">&#x27;Nginx2&#x27;:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">httpd</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@SaltStack</span> <span class="string">httpd</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/srv/salt/httpd</span></span><br><span class="line">[<span class="string">root@SaltStack</span> <span class="string">httpd</span>]<span class="comment"># cat httpd.sls</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">httpd_install:</span></span><br><span class="line"><span class="attr">pkg.installed:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line"><span class="attr">enable_httpd:</span></span><br><span class="line"><span class="attr">service.running:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">enable:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用top文件前，在配置文件中，取消关于top文件配置的注释</li>
<li>编写完成top文件后，使用命令“<code>salt &#39;*&#39; state.highstate</code>对所有minion执行top文件中的任务</li>
<li>建议在正式执行top文件前，使用命令<code>salt &#39;*&#39; state.highstate test=True</code>测试top文件是否能够正确执行</li>
</ul>
	
		</div>
		
		<div id="current-post-cover" data-scr="/img/cart_cover.jpg"></div>

		<!-- relate post, comment...-->
		<div class="investment-container">
			<div class="investment-header">
				<div class="investment-title-1">
					<div class="on">相关文章</div>
					<div>评论</div>
					<div>分享</div>
				</div>
				<div class="investment-title-2">	            
					
	<span>
		<a id="totop-post-page">返回顶部</a>
		
			<a href="/2025/02/28/openEuler/%E5%AE%9E%E9%AA%8C/IA/08%20shell%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/" title="08 shell脚本语言基础" rel="prev">
				&laquo;上一篇
			</a>
		
		
			<a href="/2025/02/14/openEuler/%E7%AC%94%E8%AE%B0/IA/01%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8/" title="01 openEuler操作系统入门" rel="next">
				下一篇&raquo;
			</a>
			
	</span>


      		
				</div>	
			</div>
			
			<div class="investment-content">
				<div class="investment-content-list">
					

<div class="relate-post">
	
		<ul>
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/09%20Samba%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86/" title="09 Samba文件共享服务器管理">
								09 Samba文件共享服务器管理			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								五月 19日, 2025				
							</p>
							<p class="relate-post-content">
								完成openEuler系统基础命令操作后，可以基于openEuler及软件搭建各类服务，应用到各个IT系统中，基于openEuler及Samba可以完成文件共享服务器的搭建。
学完本课程后，你将能够:

基于openEuler系统文件...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/09%20Samba%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86/" title="09 Samba文件共享服务器管理">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="09 Samba文件共享服务器管理"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/08%20%E4%BD%BF%E7%94%A8shell%E8%84%9A%E6%9C%AC/" title="08 使用shell脚本">
								08 使用shell脚本			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								五月 19日, 2025				
							</p>
							<p class="relate-post-content">
								
本课程基于 openEuler
介绍关于 Shell 的基础知识
结合实际案例展示 Shell 脚本编写的最佳实践

学完本课程后，您应该能：

熟悉 Shell 基础知识
掌握 Shell 编程基础
能够编写常用的 Shell 脚...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/08%20%E4%BD%BF%E7%94%A8shell%E8%84%9A%E6%9C%AC/" title="08 使用shell脚本">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="08 使用shell脚本"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/06%20%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%8F%8A%E5%AD%98%E5%82%A8/" title="06 管理文件系统及存储">
								06 管理文件系统及存储			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								五月 19日, 2025				
							</p>
							<p class="relate-post-content">
								本章主要讲述文件系统、磁盘存储、逻辑卷存储的基础概念以及如何管理、使用文件系统和存储，以及对一些常用操作命令的介绍。
学完本课程后，您将能够：

了解文件系统及存储的基本概念
掌握磁盘存储的挂载和使用方法
掌握逻辑卷的管理方法


0...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/06%20%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%8F%8A%E5%AD%98%E5%82%A8/" title="06 管理文件系统及存储">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="06 管理文件系统及存储"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/05%20%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%B9%B6%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1/" title="05 安装软件并管理服务">
								05 安装软件并管理服务			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								五月 19日, 2025				
							</p>
							<p class="relate-post-content">
								本章节主要讲述openEuler中安装软件包三种方式：rpm安装、源码安装以及yum安装的相关概念以及具体的操作命令，并且介绍了systemd管理服务的概念以及操作方式。
0x01 RPM管理软件包1.1 RPM软件包Linux软件包...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IA/05%20%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%B9%B6%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1/" title="05 安装软件并管理服务">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="05 安装软件并管理服务"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IP/03%20openEuler%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" title="03 openEuler存储管理">
								03 openEuler存储管理			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								五月 19日, 2025				
							</p>
							<p class="relate-post-content">
								存储是计算机系统中非常重要的概念，它负责存储和管理数据。随着IT技术的不断发展和企业对存储需求的不断变化，存储技术和架构也在不断革新。本章我们将从存储的基本概念开始了解不同存储类型的区别及使用方法。
学完本课程后，您将能够:

了解存...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/05/19/openEuler/%E7%AC%94%E8%AE%B0/IP/03%20openEuler%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/" title="03 openEuler存储管理">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="03 openEuler存储管理"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/" title="06 openEuler操作系统安全加固">
								06 openEuler操作系统安全加固			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								三月 8日, 2025				
							</p>
							<p class="relate-post-content">
								操作系统是互联网不可或缺的基础设施之一，也是生产、处理和存储价值数据的实体。同时openEuler作为Linux发行版系统，具有开源、免费的特点，拥有丰富健康的生态环境和社区支持。正因如此，保障其安全的重要性不言而喻。本章节以操作系统...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/03/08/openEuler/%E7%AC%94%E8%AE%B0/IP/06%20openEuler%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/" title="06 openEuler操作系统安全加固">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="06 openEuler操作系统安全加固"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/03/06/openEuler/%E7%AC%94%E8%AE%B0/IP/05%20shell%E8%84%9A%E6%9C%AC%E8%BF%9B%E9%98%B6/" title="05 shell脚本进阶">
								05 shell脚本进阶			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								三月 6日, 2025				
							</p>
							<p class="relate-post-content">
								前言本章主要讲述Shell脚本的进阶功能，包括条件判断、函数、正则表达式、grep、sed、awk命令。

掌握条件判断的使用
掌握函数的常见操作
掌握grep语法与常见操作
掌握正则表达式的基本用法
掌握sed语法与常见操作
掌握a...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/03/06/openEuler/%E7%AC%94%E8%AE%B0/IP/05%20shell%E8%84%9A%E6%9C%AC%E8%BF%9B%E9%98%B6/" title="05 shell脚本进阶">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="05 shell脚本进阶"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/03/04/openEuler/%E7%AC%94%E8%AE%B0/IP/02%20openEuler%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/" title="02 openEuler集群架构介绍">
								02 openEuler集群架构介绍			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								三月 4日, 2025				
							</p>
							<p class="relate-post-content">
								前言随着互联网的发展，单机应用已经无法满足用户的需求，因此集群应用而生本章将主要介绍高可用集群与负载均衡集群的实现工具的配置，包括LVS、HAProxy、Nginx和Keepalived 。目标

熟悉LVS的搭建和配置
熟悉Ngin...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/03/04/openEuler/%E7%AC%94%E8%AE%B0/IP/02%20openEuler%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/" title="02 openEuler集群架构介绍">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="02 openEuler集群架构介绍"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/03/04/openEuler/%E5%AE%9E%E9%AA%8C/IP/02%20openEuler%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/01%20LVS%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/" title="01 LVS配置实践">
								01 LVS配置实践			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								三月 4日, 2025				
							</p>
							<p class="relate-post-content">
								1.1 LVS&#x2F;NAT 模式配置1.1.1 实验介绍本实验将通过 LVS 负载均衡的方式访问一个 Nginx 集群。在实际工作场景中，集群向外提供服务时显示的内容是一致的，但在本实验中为了将 LVS 的算法体现的比较明显，N...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/03/04/openEuler/%E5%AE%9E%E9%AA%8C/IP/02%20openEuler%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/01%20LVS%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/" title="01 LVS配置实践">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="01 LVS配置实践"/>
							</a>
						</div>
					</li>												
			
					<li>
						<div class="relate-post-text">
							<a class="relate-post-title" href="/2025/03/02/openEuler/%E5%AE%9E%E9%AA%8C/IP/01%20openEuler%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/03%20DNS%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/" title="03 DNS相关配置">
								03 DNS相关配置			
							</a>
							<p class="relate-post-date">
								<i class="fa fa-calendar"></i>
								三月 2日, 2025				
							</p>
							<p class="relate-post-content">
								3.1 实验介绍3.1.1 关于本实验本实验基于《3.3.2 Nginx 负载均衡配置》进行，将使用 DNS 服务器代替原先的静态 DNS 为用户端提供对应服务。
3.2 安装 DNS 软件3.2.1 资源准备按照实验组网介绍和实验设...
							</p>
						</div>

						<div class="relate-post-cover">
							<a href="/2025/03/02/openEuler/%E5%AE%9E%E9%AA%8C/IP/01%20openEuler%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/03%20DNS%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/" title="03 DNS相关配置">				
								
								<img class="lazy" src="/img/lazy.gif" data-src="/img/cart_cover.jpg" alt="03 DNS相关配置"/>
							</a>
						</div>
					</li>												
			
		</ul>
	
</div>	
				</div>
				<div class="investment-content-list">
					<div class="layout-comment">

	
		<div class="config-info">
			Please check the parameter of <b>comment</b> in config.yml of hexo-theme-Annie!
		</div>	
	

</div>
				</div>
				<div class="investment-content-list">
					<div class="layout-share">
	
	

		
			
			<!-- socialShare share -->
			<div class="social-share"></div>

<!--  css & js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
			
		
		
	
</div>


				</div>
			</div>	
		</div>
	</div>
</div>

<!-- show math formula -->



	





<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">


<script src="/plugin/fancybox/jquery.fancybox.js"></script>


<script type="text/javascript">
	(function gallerySet(){
		let titleID = $('.article-title a'),
			imageID = $('.article-content img'),
			videoID = $('.article-content video');
		
		let postTitle = titleID.text() ? titleID.text() : "No post title!";
		
		imageID.each(function() {
			let imgPath = $(this).attr('src'),
				imgTitle = $(this).attr('alt') ? $(this).attr('alt') : "No image description!";
		
			//给每个匹配的<img>元素打包, 即添加父元素<a>
			$(this).wrap('<a data-fancybox="gallery" data-caption="《 ' + postTitle + ' 》' + imgTitle + '"href="' + imgPath + '"> </a>');
		});
		
		videoID.each(function() {
			let videoPath = $(this).attr('src');
		
			//给每个匹配的<img>元素打包, 即添加父元素<a>
			$(this).wrap('<a data-fancybox href=" ' + videoPath + ' "> </a>');
		});
		
		//TODO：支持html5 video

		if($('#layout-post').length) {
			$('[data-fancybox="gallery"]').fancybox({
				loop: true,
				buttons: [
					"zoom",
					"share",
					"slideShow",
					"fullScreen",
					//"download",
					"thumbs",
					"close"
				],
				protect: true
			});
		}
	})();
</script>
		</main>

		<!--footer-->
		<footer>
	<div id="navigation-show">
		<ul id="global-nav">
	
		<li class="menu-home">
			<a href="/" class="menu-item-home" target="_blank">主页</a>
		</li>
		
	
		<li class="menu-archive">
			<a href="/archives" class="menu-item-archive" target="_blank">归档</a>
		</li>
		
	
		<li class="menu-categories">
			<a href="/categories" class="menu-item-categories" target="_blank">分类</a>
		</li>
		
	
		<li class="menu-tags">
			<a href="/tags" class="menu-item-tags" target="_blank">标签</a>
		</li>
		
	
		<li class="menu-about">
			<a href="/about" class="menu-item-about" target="_blank">关于</a>
		</li>
		
	
		<li class="menu-gallery">
			<a href="/gallery" class="menu-item-gallery" target="_blank">相册</a>
		</li>
		
	

	
</ul>
	</div>

	<div class="copyright">
		<p>
			 
				&copy;2017 - 2025, content by Sariay. All Rights Reserved.
			
			
				<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay.
			
		</p>
		<p>
			

	<!-- busuanzi -->
	<!-- busuanzi -->



			<a href="javascript:zh_tran('s');" class="zh_click" id="zh_click_s">简体</a> 
			<a href="javascript:zh_tran('t');" class="zh_click" id="zh_click_t">繁體</a>				
		</p>
	</div>		
</footer>
		
	<!-- Local or hitokoto! -->

	
<script src="/plugin/motto/motto.js"></script>

	
	<script type="text/javascript">
		(function motto(){
			let mottoText = getMingYanContent().split('</br> - </br>'),
			
			mottoTextContent = mottoText[0]?mottoText[0]:'请刷新...',
			
			mottoTextFrom = mottoText[1]?mottoText[1]:'one/一个';
			
			mottoTextContent = mottoTextContent.trim().substring(0, 100);
		
			$("#motto-content").html( mottoTextContent);
			$("#motto-author").html( mottoTextFrom  );
		})();	
	</script>	



<!-- love effect -->


<!-- back to top -->

	<div id="totop">
	<span class="icon-circle-up"></span>
</div>



<!-- site analysis -->


	<!-- site-analysis -->
	
	
	
	
	
 

<!-- leancloud -->


	<!-- leancloud -->
	<!--
	时间：2018-11-27
	描述：
		文章访问量：visitors
		文章喜欢量：likes	
		文章排行榜：topNPost
		其他得说明：
			01-Cookie相关的函数 
				https://blog.csdn.net/somehow1002/article/details/78511541（Author：somehow1002）
			02-visitors相关的函数 
				https://blog.csdn.net/u013553529/article/details/63357382（Author：爱博客大伯）
				https://notes.doublemine.me/2015-10-21-为NexT主题添加文章阅读量统计功能.html（Author：夏末）
			03-topNPost相关的函数
				https://hoxis.github.io/hexo-next-read-rank.html（Author：hoxis）
			04-likes相关的函数，
				参考了01 & 02进行简单的设计与实现
-->


	

  



<script src="/plugin/chinese/chinese.js"></script>
<script src="/plugin/imagelazyloader/yall.min.js"></script>
<script src="/plugin/imageloaded/imagesloaded.pkgd.min.js"></script>
<script src="/plugin/nicescroll/jquery.nicescroll.js"></script>
<script src="/plugin/resizediv/resizediv.js"></script>
<script src="/js/main.js"></script>

	</body>	
</html>